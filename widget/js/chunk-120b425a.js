(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-120b425a"],{"023c":function(t,e,a){"use strict";var s=a("24ea"),r=a.n(s);r.a},"24ea":function(t,e,a){},3654:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("basePage",{ref:"basePage",attrs:{numberCol:t.numberCol,buttons:t.buttons,draggable:!0,footerText:t.footerText,btnMethod:t.btnMethod,selectItems:t.selectItems,fixedQueryConditions:t.fixedQueryConditions,cascadeItems:t.cascadeItems,order:t.order,title:t.$t("rawMaterialStorage.title"),contitle:t.$t("base.contitle"),addcon:t.addcon},on:{buttonsClick:t.buttonsClick,aftercheck:t.aftercheck,afterquery:t.afterquery,aftercheckall:t.aftercheckall,fclick:t.fclick,fblur:t.fblur},scopedSlots:t._u([{key:"over",fn:function(){return[a("van-row",{staticStyle:{"text-align":"center","vertical-align":"middle","align-items":"center","justify-content":"center",display:"flex"}},[a("van-col",{attrs:{span:"4"}},[a("span",{staticClass:"smallfont"},[t._v(t._s(t.$t("rawMaterialStorage.store")))])]),a("van-col",{attrs:{span:"14"}},[a("menuselect",{staticStyle:{width:"100%"},attrs:{showFirstItem:"",options:t.options},model:{value:t.storeId,callback:function(e){t.storeId=e},expression:"storeId"}})],1),a("van-col",{attrs:{span:"6"}},[a("span",{staticClass:"smallfont",staticStyle:{float:"right","margin-right":"10px"}},[t._v(t._s(t.$t("rawMaterialStorage.total")+":"+t.total))])])],1)]},proxy:!0}])}),a("stackSelect",{ref:"stockSelect",attrs:{storeId:t.storeId,options:t.options,show:t.show},on:{closeSelect:t.closeSelect,beforesearch:t.beforesearch,sure:t.sure}})],1)},r=[],i=(a("1c4c"),a("386d"),a("20d6"),a("7514"),a("ac6a"),a("5df3"),a("4f7f"),a("96cf"),a("3b8d")),n=a("d399"),c=a("02df"),o={name:"storage0001",data:function(){return{flag:!1,order:{matPublicTimestamp:"desc",matPublicSort:"asc"},numberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},editBarCode:!1,editObj:{},barCodes:new Set,buttons:[{key:"warehouse",name:this.$t("rawMaterialStorage.warehousing")}],selectobjs:[],show:!1,storeId:"",total:0,options:[],footerText:[{key:"quantity",display:this.$t("rawMaterialStorage.quantity"),value:0},{key:"weight",display:this.$t("rawMaterialStorage.weight"),value:0}],btnMethod:{querymethod:"/wms/wmsmat/checkautopage"},selectItems:{},cascadeItems:{},boindnum:0,unboindnum:0,addcon:[{condisplay:"暂收单号",conexp:"=",conismaster:1,conkey:"trbNo",conlang:"zh_cn",conselectid:"0",contype:"select"}],fixedQueryConditions:[{key:"matPublicStatus",exp:"=",value:"1"},{key:"matInvStatus",exp:"=",value:"0"},{key:"matSheetType",exp:"=",value:"0"}]}},created:function(){this.initselect(),sc.initScan(this.scanning)},destroyed:function(){sc.initScan(void 0)},activated:function(){},methods:{getIndex:function(){var t=this,e=!1,a=0;return this.$refs.basePage.datas.forEach((function(s,r){if(!e){var i=t.$refs.basePage.$refs.baseList.$refs.cards.find((function(t){return t.data.matBarcode===s.matBarcode}));!1===i.checked&&(a=r,e=!0)}})),a},scanning:function(t,e){var a=this;if(n["a"].loading({forbidClick:!0,duration:0}),!1===this.editBarCode){var s=t.data;if(s){var r={current:1,rows:1,value:{matBarcode:s},exp:{matBarcode:"="},slaves:{},order:{}};this.fixedQueryConditions.forEach((function(t){"slaves"!==t.key?(r.value[t.key]=t.value,r.exp[t.key]=t.exp):r.slaves=t.value})),this.$ajax(this.btnMethod.querymethod,"",r,(function(t){var e=a;if(t&&t.data&&t.data.data&&t.data.data.records){var s=t.data.data.records;s.length>0?(s.forEach((function(t){var s=a.$refs.basePage.datas.findIndex((function(e){return e.matBarcode===t.matBarcode}));s>=0&&a.$refs.basePage.datas.splice(s,1);var r=a.getIndex();a.$refs.basePage.datas.splice(r,0,t),a.$nextTick((function(){e.$refs.basePage.$refs.baseList.$refs.cards.forEach((function(e){e.data.matBarcode===t.matBarcode&&(e.$refs.checkbox.toggle(!0),a.aftercheck())}))})),a.barCodes.add(t.matBarcode)})),n["a"].clear()):n["a"].fail(a.$t("rawMaterialArrival.scanFail"))}}))}}else{var i=JSON.parse(JSON.stringify(this.editObj));i.matBarcode=t.data,this.$ajax("/wms/wmsmat/update","",i,(function(t){a.flag=!1;var e=a.$refs.basePage.datas.findIndex((function(t){return t.id===i.id}));e>=0&&a.$refs.basePage.datas.splice(e,1,i),n["a"].clear()}))}},buttonsClick:function(t){if("warehouse"===t){var e=this.$refs.basePage.ischeckall();if(e)this.show=!0;else{var a=this.$refs.basePage.getselected();a&&a.length>0?this.show=!0:this.$toast.fail(this.$t("base.noselect"))}}},warehouseAll:function(t){var e=this,a=this.$refs.basePage.getsearchJson();this.$ajax("/wms/wmsmat/noautopageidlist","",a,(function(a){var s=a.data.data;s.reverse(),e.warehouse(t,s)}))},warehouse:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){var s,r,i,c,o=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s=this,r=n["a"].loading({forbidClick:!0,duration:0}),i=regeneratorRuntime.mark((function t(i){var n,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=a[i],c={id:n,matInvStatus:1,matStoreId:o.storeId,matStackId:e},r.message="".concat(i," / ").concat(a.length),t.next=5,new Promise((function(t){s.$ajax("/wms/wmsmat/instorebyid","",c,(function(){t(!0)}))}));case 5:case"end":return t.stop()}}),t)})),t.t0=regeneratorRuntime.keys(a);case 4:if((t.t1=t.t0()).done){t.next=9;break}return c=t.t1.value,t.delegateYield(i(c),"t2",7);case 7:t.next=4;break;case 9:this.show=!1,n["a"].success(s.$t("rawMaterialStorage.success")),s.$refs.basePage.search();case 12:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}(),beforesearch:function(t){var e=this.$refs.basePage.getselected(),a=new Set;e.forEach((function(t){a.add(t.matCatFathcode)})),t.exp["matMatCatCode"]="=",t.value["matMatCatCode"]=Array.from(a).join(",")},sure:function(t){var e=this.$refs.basePage.ischeckall();if(e)this.warehouseAll(t.stackId);else{var a=this.$refs.basePage.getselected();if(a&&a.length>0){var s=a.map((function(t){return t.id}));s.reverse(),this.warehouse(t.stackId,s)}else this.$toast.fail(this.$t("base.noselect"))}},aftercheck:function(t){if(!1===this.$refs.basePage.checkAll){var e=this.$refs.basePage.getselected(),a=0,s=0;e.forEach((function(t){a+=t.matAuxQuantity,s+=t.matBasicQuantity})),this.footerText[0].value=s,this.footerText[1].value=c["a"].numberFormat(4,a)+"KG"}},aftercheckall:function(){!0===this.$refs.basePage.checkAll&&this.$refs.basePage.extRecords?(this.footerText[0].value=this.$refs.basePage.extRecords.MAT_BASIC_QUANTITY,this.footerText[1].value=c["a"].numberFormat(4,this.$refs.basePage.extRecords.MAT_AUX_QUANTITY)+"KG"):(this.footerText[0].value=0,this.footerText[1].value=0)},fclick:function(t,e,a,s,r){t.flag=!1,this.flag=!0,this.$set(r,"fixed1",!0),this.editBarCode=!0,this.editObj=s},fblur:function(t,e,a){var s=this;if(this.editBarCode=!1,this.$set(a,"fixed1",!1),this.flag){var r=e;n["a"].loading({forbidClick:!0,duration:0}),this.$ajax("/wms/wmsmat/update","",r,(function(t){var e=s.$refs.basePage.datas.findIndex((function(t){return t.id===r.id}));e>=0&&s.$refs.basePage.datas.splice(e,1,r),n["a"].clear()}))}},afterquery:function(t){var e=this;1===t.current&&(this.barCodes=new Set),this.barCodes.forEach((function(e){var a=t.records.findIndex((function(t){return t.matBarcode===e}));a>0&&t.records.splice(a,1)})),t.records.forEach((function(t){})),this.total=t.total;var a=this.$refs.basePage.checkAll;this.$nextTick((function(){a?e.aftercheckall():e.aftercheck()}))},cascadehandler:function(t){var e=this,a=[];return t.forEach((function(t){var s={checkable:t.check,id:t.matCatSyspath,code:t.matCatSyscode,name:t.matCatName};s.children=e.cascadehandler(t.children),a.push(s)})),a},closeSelect:function(t){t&&(t.flag=!1),this.show=!1},initselect:function(){var t=this;this.$ajax("/wms/wmsmatcat/matlisttree","",{matInvStatus:"0",matPublicStatus:"0"},(function(e){t.cascadeItems.matCatSyspath=t.cascadehandler(e.data.data)})),this.$ajax("/wms/wmsmat/getdistinctparams","",{type:"matCarshipno",matInvStatus:"0",matPublicStatus:"0"},(function(e){var a=e.data.data,s=[];a.forEach((function(t){var e={id:t,name:t};s.push(e)})),t.selectItems.matCarshipno=s})),this.$ajax("/wms/wmsmat/getdistinctparams","",{type:"matProjno",matInvStatus:"0",matPublicStatus:"0"},(function(e){var a=e.data.data,s=[];a.forEach((function(t){var e={id:t,name:t};s.push(e)})),t.selectItems.matProjNo=s})),this.$ajax("/wms/wmstrb/list","",{},(function(e){var a=e.data.data,s=[];a.forEach((function(t){var e={id:t.trbNo,name:t.trbNo};s.push(e)})),t.selectItems.trbNo=s})),this.selectItems.matSheetType=c["a"].getDict("SHEET_TYPE"),this.selectItems.matStorageStatus=c["a"].getDict("STORAGE_STATUS"),this.$ajax("/wms/wmsstore/list","",{storeType:1},(function(e){var a=[];e.data.data.forEach((function(t){var e={text:t.storeName,value:t.id};a.push(e)})),t.options=a}))}}},d=o,l=(a("023c"),a("2877")),u=Object(l["a"])(d,s,r,!1,null,"0b99a6d4",null);e["default"]=u.exports}}]);
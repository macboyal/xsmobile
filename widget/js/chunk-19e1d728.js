(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19e1d728"],{"029b":function(t,e,a){},"0a16":function(t,e,a){},"0f1e":function(t,e,a){"use strict";var s=a("029b"),i=a.n(s);i.a},2890:function(t,e,a){},"3dfe":function(t,e,a){"use strict";var s=a("6226"),i=a.n(s);i.a},"3e45":function(t,e,a){"use strict";var s=a("d450"),i=a.n(s);i.a},6226:function(t,e,a){},"6e4e":function(t,e,a){"use strict";var s=a("bd80"),i=a.n(s);i.a},"6f04":function(t,e,a){},"72ff":function(t,e,a){},7454:function(t,e,a){"use strict";var s=a("6f04"),i=a.n(s);i.a},"76c9":function(t,e,a){"use strict";var s=a("c4a4"),i=a.n(s);i.a},"7daf":function(t,e,a){},"85ad":function(t,e,a){},"86bf":function(t,e,a){"use strict";var s=a("72ff"),i=a.n(s);i.a},"92ad":function(t,e,a){},"9dc6":function(t,e,a){"use strict";var s=a("92ad"),i=a.n(s);i.a},a6f0:function(t,e,a){},a7ac:function(t,e,a){"use strict";var s=a("a6f0"),i=a.n(s);i.a},ab51:function(t,e,a){"use strict";var s=a("2890"),i=a.n(s);i.a},bbb0:function(t,e,a){"use strict";var s=a("0a16"),i=a.n(s);i.a},bd80:function(t,e,a){},c4a4:function(t,e,a){},cf1c:function(t,e){t.exports="data:image/gif;base64,R0lGODlhIAAgALMAAP///7Ozs/v7+9bW1uHh4fLy8rq6uoGBgTQ0NAEBARsbG8TExJeXl/39/VRUVAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQAAACwAAAAAIAAgAAAE5xDISSlLrOrNp0pKNRCdFhxVolJLEJQUoSgOpSYT4RowNSsvyW1icA16k8MMMRkCBjskBTFDAZyuAEkqCfxIQ2hgQRFvAQEEIjNxVDW6XNE4YagRjuBCwe60smQUDnd4Rz1ZAQZnFAGDd0hihh12CEE9kjAEVlycXIg7BAsMB6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YEvpJivxNaGmLHT0VnOgGYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHQjYKhKP1oZmADdEAAAh+QQFBQAAACwAAAAAGAAXAAAEchDISasKNeuJFKoHs4mUYlJIkmjIV54Soypsa0wmLSnqoTEtBw52mG0AjhYpBxioEqRNy8V0qFzNw+GGwlJki4lBqx1IBgjMkRIghwjrzcDti2/Gh7D9qN774wQGAYOEfwCChIV/gYmDho+QkZKTR3p7EQAh+QQFBQAAACwBAAAAHQAOAAAEchDISWdANesNHHJZwE2DUSEo5SjKKB2HOKGYFLD1CB/DnEoIlkti2PlyuKGEATMBaAACSyGbEDYD4zN1YIEmh0SCQQgYehNmTNNaKsQJXmBuuEYPi9ECAU/UFnNzeUp9VBQEBoFOLmFxWHNoQw6RWEocEQAh+QQFBQAAACwHAAAAGQARAAAEaRDICdZZNOvNDsvfBhBDdpwZgohBgE3nQaki0AYEjEqOGmqDlkEnAzBUjhrA0CoBYhLVSkm4SaAAWkahCFAWTU0A4RxzFWJnzXFWJJWb9pTihRu5dvghl+/7NQmBggo/fYKHCX8AiAmEEQAh+QQFBQAAACwOAAAAEgAYAAAEZXCwAaq9ODAMDOUAI17McYDhWA3mCYpb1RooXBktmsbt944BU6zCQCBQiwPB4jAihiCK86irTB20qvWp7Xq/FYV4TNWNz4oqWoEIgL0HX/eQSLi69boCikTkE2VVDAp5d1p0CW4RACH5BAUFAAAALA4AAAASAB4AAASAkBgCqr3YBIMXvkEIMsxXhcFFpiZqBaTXisBClibgAnd+ijYGq2I4HAamwXBgNHJ8BEbzgPNNjz7LwpnFDLvgLGJMdnw/5DRCrHaE3xbKm6FQwOt1xDnpwCvcJgcJMgEIeCYOCQlrF4YmBIoJVV2CCXZvCooHbwGRcAiKcmFUJhEAIfkEBQUAAAAsDwABABEAHwAABHsQyAkGoRivELInnOFlBjeM1BCiFBdcbMUtKQdTN0CUJru5NJQrYMh5VIFTTKJcOj2HqJQRhEqvqGuU+uw6AwgEwxkOO55lxIihoDjKY8pBoThPxmpAYi+hKzoeewkTdHkZghMIdCOIhIuHfBMOjxiNLR4KCW1ODAlxSxEAIfkEBQUAAAAsCAAOABgAEgAABGwQyEkrCDgbYvvMoOF5ILaNaIoGKroch9hacD3MFMHUBzMHiBtgwJMBFolDB4GoGGBCACKRcAAUWAmzOWJQExysQsJgWj0KqvKalTiYPhp1LBFTtp10Is6mT5gdVFx1bRN8FTsVCAqDOB9+KhEAIfkEBQUAAAAsAgASAB0ADgAABHgQyEmrBePS4bQdQZBdR5IcHmWEgUFQgWKaKbWwwSIhc4LonsXhBSCsQoOSScGQDJiWwOHQnAxWBIYJNXEoFCiEWDI9jCzESey7GwMM5doEwW4jJoypQQ743u1WcTV0CgFzbhJ5XClfHYd/EwZnHoYVDgiOfHKQNREAIfkEBQUAAAAsAAAPABkAEQAABGeQqUQruDjrW3vaYCZ5X2ie6EkcKaooTAsi7ytnTq046BBsNcTvItz4AotMwKZBIC6H6CVAJaCcT0CUBTgaTg5nTCu9GKiDEMPJg5YBBOpwlnVzLwtqyKnZagZWahoMB2M3GgsHSRsRACH5BAUFAAAALAEACAARABgAAARcMKR0gL34npkUyyCAcAmyhBijkGi2UW02VHFt33iu7yiDIDaD4/erEYGDlu/nuBAOJ9Dvc2EcDgFAYIuaXS3bbOh6MIC5IAP5Eh5fk2exC4tpgwZyiyFgvhEMBBEAIfkEBQUAAAAsAAACAA4AHQAABHMQyAnYoViSlFDGXBJ808Ep5KRwV8qEg+pRCOeoioKMwJK0Ekcu54h9AoghKgXIMZgAApQZcCCu2Ax2O6NUud2pmJcyHA4L0uDM/ljYDCnGfGakJQE5YH0wUBYBAUYfBIFkHwaBgxkDgX5lgXpHAXcpBIsRADs="},d450:function(t,e,a){},dc25:function(t,e,a){"use strict";var s=a("85ad"),i=a.n(s);i.a},df8e:function(t,e,a){},e019:function(t,e,a){"use strict";var s=a("df8e"),i=a.n(s);i.a},e099:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("baseNavigation",{ref:"baseNavigation",attrs:{title:t.title,rightIcon:"search",extIcon:""},on:{rightClick:t.rightClick}}),s("baseQueryConditions",{ref:"baseQueryConditions",attrs:{show:t.showQueryConditions,mdid:"storage_9101",selectItems:t.selectItems,title:"余料盘点查询",tableCondition:t.tableCondition,immediateQuery:!0,xsView:t.xsView},on:{close:t.closeQueryConditions,search:t.search}}),s("addOrEdit",{ref:"addOrEdit",attrs:{show:t.showAddOrEdit,data:t.selectData,selectItems:t.selectItems,type:t.addOrEdit},on:{close:t.closeAddOrEdit}}),t.showRawEnterInventory?s("remEnterInventory",{ref:"remEnterInventory",attrs:{show:t.showRawEnterInventory,selectItems:t.selectItems,wpsOrderId:t.wpsOrderId},on:{close:t.closeRawEnterInventory}}):t._e(),s("div",{ref:"over",staticClass:"over"},[s("van-row",{attrs:{type:"flex",justify:"center"}},[s("van-col",{attrs:{span:"7"}},[s("span",{staticClass:"circle-text",staticStyle:{color:"#1E90FF"}},[t._v("盈")]),s("span",{staticClass:"over-text"},[t._v(t._s(t.sumYNum))])]),s("van-col",{attrs:{span:"8"}},[s("span",{staticClass:"circle-text",staticStyle:{color:"red"}},[t._v("亏")]),s("span",{staticClass:"over-text"},[t._v(t._s(t.sumKNum))])]),s("van-col",{staticStyle:{"text-align":"right"},attrs:{span:"7"}},[s("span",{staticClass:"over-text"},[t._v("数量:")]),s("span",{staticClass:"over-text"},[t._v(t._s(t.sumNum))])])],1)],1),s("div",{staticClass:"body",style:{maxHeight:t.bodyheight-10+"PX",top:t.top+5+"PX",backgroundColor:"#f7f7f7"},attrs:{id:"body"}},[s("bodyList",{ref:"bodyList",attrs:{primaryKey:"wpsOrderId",cardField:t.cardField,height:t.bodyheight,datas:t.datas,total:t.total,size:t.size,current:t.current,pages:t.pages,selectItems:t.selectItems},on:{openDetail:t.openDetail,search:t.search}})],1),s("baseDetail",{attrs:{mdid:"storage_9101",detailtitle:"余料盘点详情",show:t.showDetail,data:t.detaildata,selectItems:t.selectItems,numberCol:t.numberCol,xsView:t.xsView},on:{close:t.closeDetail}}),s("van-image",{ref:"image",staticClass:"img",style:{top:t.imagetop+"px"},attrs:{src:a("cf05"),fit:"contain"}}),s("van-tabbar",{ref:"footer",model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[s("van-tabbar-item",{attrs:{icon:"add"},on:{click:function(e){return t.tabbarClick(t.active)}}},[t._v("发起盘点")]),s("van-tabbar-item",{attrs:{icon:"edit"},on:{click:function(e){return t.tabbarClick(t.active)}}},[t._v("编辑盘点")]),s("van-tabbar-item",{attrs:{icon:"stop-circle"},on:{click:function(e){return t.tabbarClick(t.active)}}},[t._v("结束盘点")]),s("van-tabbar-item",{attrs:{icon:"share"},on:{click:function(e){return t.tabbarClick(t.active)}}},[t._v("进入盘点")])],1)],1)},i=[],n=(a("456d"),a("ac6a"),a("386d"),a("d399")),c=a("2241"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[s("van-list",{directives:[{name:"show",rawName:"v-show",value:!t.isEmpty,expression:"!isEmpty"}],ref:"list",attrs:{"immediate-check":!1,finished:t.finished,"finished-text":t.$t("base.nomore")},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.localdatas,(function(e){return s("card",{key:e[t.primaryKey],ref:"cards",refInFor:!0,attrs:{cardField:t.cardField,selectItems:t.selectItems,primaryKeyValue:e[t.primaryKey],data:e},on:{openDetail:t.openDetail,checkboxclick:t.checkboxclick}})})),1),s("van-empty",{directives:[{name:"show",rawName:"v-show",value:t.isEmpty,expression:"isEmpty"}],attrs:{description:t.$t("base.nodata")},scopedSlots:t._u([{key:"image",fn:function(){return[s("van-image",{attrs:{src:a("1427"),fit:"contain"}})]},proxy:!0}])})],1)],1)},r=[],d=(a("c5f6"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card",style:{"background-color":t.data.color}},[a("van-row",{staticClass:"header",style:{borderBottom:t.data.color?"1px dashed #f7f7f7":"1px dashed #DCDCDC"}},[a("van-checkbox",{ref:"checkbox",staticStyle:{overflow:"auto",float:"bottom","font-size":"0.8rem"},attrs:{"checked-color":"rgb(251, 205, 5)","icon-size":"0.8rem",disabled:t.data.disabled},on:{click:function(e){return t.checkboxclick(t.checked)}},scopedSlots:t._u([{key:"default",fn:function(){return[a("span",{staticClass:"fixed1"},[t._v("\n         盘点单号\n        ")]),a("span",{staticClass:"fixed1text"},[t._v("\n          "+t._s(t.data["wpoOrder"])+"\n        ")]),a("div",{staticClass:"fixed2-circle"},[0===t.data["wpsResult"]?a("div",{staticClass:"circle",staticStyle:{"border-color":"rgb(0, 102, 0)"}},[a("span",{staticClass:"circle-text",staticStyle:{color:"rgb(0, 102, 0)"}},[t._v("无")])]):1===t.data["wpsResult"]?a("div",{staticClass:"circle-1",staticStyle:{"border-color":"rgb(251, 205, 5)"}},[a("span",{staticClass:"circle-text-1",staticStyle:{color:"rgb(251, 205, 5)"}},[t._v("有盈亏")])]):2===t.data["wpsResult"]?a("div",{staticClass:"circle",staticStyle:{"border-color":"#1E90FF"}},[a("span",{staticClass:"circle-text",staticStyle:{color:"#1E90FF"}},[t._v("盈")])]):a("div",{staticClass:"circle",staticStyle:{"border-color":"rgb(204, 51, 0)"}},[a("span",{staticClass:"circle-text",staticStyle:{color:"rgb(204, 51, 0)"}},[t._v("亏")])])]),a("span",{staticClass:"fixed2"},[a("van-tag",{attrs:{color:0===t.data["wpoStaus"]?"#fbcd05":"#006600"}},[t._v("\n           "+t._s(0===t.data["wpoStaus"]?"盘点中":"已更新")+"\n         ")])],1)]},proxy:!0}]),model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}})],1),a("div",{staticClass:"body",on:{click:t.bodyClick}},[a("van-row",{staticStyle:{"vertical-align":"middle","align-items":"center",display:"flex"}},[a("van-col",{attrs:{span:"24"}},t._l(t.cardField,(function(e){return a("van-row",{key:e.key,attrs:{align:"center"}},[a("van-col",{attrs:{span:"7"}},[a("span",{staticClass:"cardtitle"},[t._v(t._s(e.name))])]),a("van-col",{staticStyle:{overflow:"hidden","text-overflow":"ellipsis"},attrs:{span:"17"}},["input"===e.type?a("span",{staticClass:"cardtext"},[t._v(" "+t._s(t.data[e.key]))]):"select"===e.type?a("span",{staticClass:"cardtext"},[t._v("\n              "+t._s(t.tableKV[e.key]?t.tableKV[e.key][t.data[e.key]]:t.data[e.key])+"\n            ")]):"progress"===e.type?a("div",[a("xsProgress",{attrs:{num1:t.data["overStackNum"],num2:t.data["allStackNum"]}})],1):a("span",{staticClass:"cardtext"},[t._v(" "+t._s(t.data[e.key]))])])],1)})),1)],1),a("van-row",{staticClass:"table-h"},[a("van-col",{staticClass:"table-h-text",attrs:{span:"6"}},[t._v("账面数")]),a("van-col",{staticClass:"table-h-text",attrs:{span:"6"}},[t._v("实物数")]),a("van-col",{staticClass:"table-h-text",staticStyle:{color:"#1E90FF"},attrs:{span:"6"}},[t._v("盈")]),a("van-col",{staticClass:"table-h-text",staticStyle:{color:"rgb(204, 51, 0)"},attrs:{span:"6"}},[t._v("亏")])],1),a("van-row",{staticClass:"table-d"},[a("van-col",{staticClass:"table-d-text",attrs:{span:"6"}},[t._v(t._s(t.data["wpsMesNum"]))]),a("van-col",{staticClass:"table-d-text",attrs:{span:"6"}},[t._v(t._s(t.data["wpsActualNum"]))]),a("van-col",{staticClass:"table-d-text",staticStyle:{color:"#1E90FF"},attrs:{span:"6"}},[t._v(t._s(t.data["wpsPyNum"]))]),a("van-col",{staticClass:"table-d-text",staticStyle:{color:"rgb(204, 51, 0)"},attrs:{span:"6"}},[t._v(t._s(t.data["wpsPkNum"]))])],1),a("van-row",{staticClass:"table-d"},[a("van-col",{staticClass:"table-d-text",attrs:{span:"6"}},[t._v(t._s(t.data["wpsMesWeight"]))]),a("van-col",{staticClass:"table-d-text",attrs:{span:"6"}},[t._v(t._s(t.data["wpsActualWeight"]))]),a("van-col",{staticClass:"table-d-text",staticStyle:{color:"#1E90FF"},attrs:{span:"6"}},[t._v(t._s(t.data["wpsPyWeight"]))]),a("van-col",{staticClass:"table-d-text",staticStyle:{color:"rgb(204, 51, 0)"},attrs:{span:"6"}},[t._v(t._s(t.data["wpsPkWeight"]))])],1)],1),a("div",{staticClass:"foot"},[a("van-row",[a("van-col",{staticStyle:{"white-space":"nowrap"},attrs:{span:"4"}},[a("div",{staticClass:"fixed3"},[a("span",{staticClass:"user"},[t._v(t._s(t.data.createUser))]),a("span",{staticClass:"date"},[t._v(t._s(t.data.createTime))])])]),a("van-col",{attrs:{span:"20"}},[a("van-button",{staticClass:"detailbutton",attrs:{size:"small",plain:""},on:{click:t.openDetail}},[t._v("查看详情\n        ")])],1)],1)],1)],1)}),l=[],h=(a("7f7f"),a("7618")),u=a("02df"),f={name:"card",props:{baseUrl:{type:String,default:function(){return""}},showDetailTitle:{type:String,default:function(){return this.$t("base.showdetail")}},fixed1Tip:{type:String,default:function(){return""}},numberCol:{type:Object,default:function(){return{}}},primaryKeyValue:{type:String,default:function(){return""}},cardbuttons:{type:Array,default:function(){return[]}},selectItems:{type:Object,default:function(){return{}}},cardField:{type:Array,default:function(){return[]}},data:{type:Object,default:function(){return{}}}},data:function(){return{checked:!1}},methods:{fomatFloat:function(t,e){if(void 0!==e&&""!==e&&null!==e){var a=2;return a=this.numberCol[t]?this.numberCol[t]:u["a"].getAccuracy("4"),"string"==typeof a?u["a"].formTime(a,e):Math.round(e*Math.pow(10,a))/Math.pow(10,a)}},footIconClick:function(){this.$emit("footIconClick",this.data)},getPrimaryKeyValue:function(){return this.primaryKeyValue},btnclick:function(t){this.$emit("cardbtnclick",t,this.data)},openDetail:function(){this.$emit("openDetail",this.data)},checkboxclick:function(t){this.$emit("checkboxclick",t,this.primaryKeyValue,this.data)},bodyClick:function(){this.checked=!this.checked,this.$emit("checkboxclick",this.checked,this.primaryKeyValue,this.data)}},computed:{tableKV:function(){var t=this,e={};return Object.keys(this.selectItems).forEach((function(a){if(t.selectItems[a]&&"object"==Object(h["a"])(t.selectItems[a])){var s={};t.selectItems[a].forEach((function(t){s[t.id]=t.name})),e[a]=s}})),e}},created:function(){var t=this.data.checked;t&&(this.checked=!0)}},p=f,m=(a("ab51"),a("2877")),v=Object(m["a"])(p,d,l,!1,null,"60cbf62a",null),k=v.exports,g={components:{card:k},name:"bodyList",props:{primaryKey:{type:String,default:function(){return"id"}},height:{type:Number,default:function(){return 0}},selectItems:{type:Object,default:function(){return{}}},datas:{type:Array,default:function(){return[]}},cardField:{type:Array},total:{type:Number,default:function(){return 0}},isEmpty:{type:Boolean,default:function(){return!1}},size:{type:Number,default:function(){return 0}},current:{type:Number,default:function(){return 0}},pages:{type:Number,default:function(){return 0}}},data:function(){return{checked:!1,loading:!1,finished:!1,refreshing:!1,localdatas:[]}},methods:{checkboxclick:function(t,e,a){this.$refs.cards.forEach((function(t){e!==t.getPrimaryKeyValue()&&(t.checked=!1)}))},getselected:function(){if(this.$refs.cards){var t={};return this.$refs.cards.forEach((function(e){!0===e.checked&&(t=e.data)})),t}},openDetail:function(t){this.$emit("openDetail",t)},cardclick:function(){},onRefresh:function(){this.finished=!1,this.onLoad(0)},onLoad:function(t){var e=this,a=0;a=0===t?1:this.current+1,this.$emit("search",a,(function(t,a){e.refreshing&&(e.refreshing=!1),e.loading=!1}))}},watch:{datas:{handler:function(t){this.localdatas=t},immediate:!0}},created:function(){}},w=g,y=(a("7454"),Object(m["a"])(w,o,r,!1,null,"b028ee0c",null)),b=y.exports,S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#F7F7F7"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("blankPage",{attrs:{title:1===t.type?"发起盘点":"编辑盘点"},on:{onClickLeft:t.close},scopedSlots:t._u([{key:"body",fn:function(){return[a("div",{staticStyle:{height:"100%"}},[a("div",{staticStyle:{height:"100%"}},[a("van-cell-group",[a("van-field",{attrs:{label:"盘点单号",placeholder:"请输入盘点单号",disabled:2===t.type},model:{value:t.wpoOrder,callback:function(e){t.wpoOrder=e},expression:"wpoOrder"}}),a("singleSelect",{attrs:{title:"库房类型",readonly:!0,disabled:2===t.type,selectItems:t.selectItems["wpoStoreType"],placeholder:"请选择库房类型",inputAlign:"left"},model:{value:t.wpoStoreType,callback:function(e){t.wpoStoreType=e},expression:"wpoStoreType"}}),a("singleSelect",{attrs:{title:"盘点策略",selectItems:t.selectItems["wpoPdType"],placeholder:"请选择盘点策略",inputAlign:"left",disabled:2===t.type},model:{value:t.wpoPdType,callback:function(e){t.wpoPdType=e},expression:"wpoPdType"}}),a("singleSelect",{directives:[{name:"show",rawName:"v-show",value:"1"===t.wpoPdType||"2"===t.wpoPdType,expression:"wpoPdType==='1'||wpoPdType==='2'"}],attrs:{title:"盘点库房",selectItems:t.selectItems["wpoStoreId"],placeholder:"请选择盘点库房",inputAlign:"left",disabled:2===t.type},model:{value:t.wpoStoreId,callback:function(e){t.wpoStoreId=e},expression:"wpoStoreId"}}),a("pdStackSelect",{directives:[{name:"show",rawName:"v-show",value:"2"===t.wpoPdType,expression:"wpoPdType==='2'"}],attrs:{title:"盘点库位",disabled:!t.wpoStoreId,storeId:t.wpoStoreId,stores:t.selectItems["wpoStoreId"],wpsOrderId:t.wpsOrderId,placeholder:"请选择盘点库位",inputAlign:"left"},model:{value:t.wpoLocation,callback:function(e){t.wpoLocation=e},expression:"wpoLocation"}})],1),a("van-button",{staticClass:"button",attrs:{color:"#fbce08"},on:{click:t.submit}},[t._v("确定")])],1)])]},proxy:!0}])})],1)],1)},I=[],C=(a("6b54"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("van-field",{attrs:{label:t.title,"is-link":"",value:t.displayText,placeholder:t.placeholder,readonly:"","input-align":"left"},on:{click:t.open}})],1),t.show?a("pdStackSelect",{ref:"stockSelect",attrs:{wpsOrderId:t.wpsOrderId,show:t.show,storeId:t.storeId,stores:t.stores},on:{closeSelect:t.onClickLeft,sure:t.sure}}):t._e()],1)}),x=[],A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#f7f7f7"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("blankPage",{ref:"blankPage",attrs:{title:"选择盘点库位"},on:{onClickLeft:t.close},scopedSlots:t._u([{key:"body",fn:function(){return[a("div",{ref:"storebox",staticClass:"storebox"},[a("menuselect",{staticStyle:{width:"48vw",float:"left"},attrs:{options:t.storeOption,disabled:"",defVal:t.storeId},model:{value:t.localstoreId,callback:function(e){t.localstoreId=e},expression:"localstoreId"}}),a("van-search",{staticClass:"van-search-xs",attrs:{placeholder:t.$t("rawMaterialStorage.placeholder")},on:{blur:t.onBlur},model:{value:t.stackName,callback:function(e){t.stackName=e},expression:"stackName"}})],1),a("van-row",{ref:"headInfo",staticClass:"headInfo",attrs:{type:"flex",justify:"space-between"}},[a("van-col",{staticClass:"headInfo-v",attrs:{span:"8"}},[t._v("\n            "+t._s("库位:"+t.total)+"\n          ")]),a("van-col",{staticClass:"headInfo-v",staticStyle:{"text-align":"center"},attrs:{span:"8"}},[t._v(t._s("数量:"+t.sumMes))]),a("van-col",{staticClass:"headInfo-v",staticStyle:{"text-align":"right"},attrs:{span:"8"}},[t._v(t._s("重量:"+t.sumWeight))])],1),a("div",{staticClass:"list",style:{height:t.listheight-5+"px"}},[a("pdStackList",{ref:"stackList",attrs:{stackList:t.stackList},on:{search:t.search,onchecked:t.onchecked,changed:t.changed}})],1)]},proxy:!0},{key:"foot",fn:function(){return[a("div",{staticClass:"foot"},[a("van-row",{attrs:{align:"center",type:"flex"}},[a("van-col",{staticClass:"checkAll",attrs:{span:"5"}},[a("van-checkbox",{attrs:{"checked-color":"rgb(251, 205, 5)","icon-size":"0.8rem"},on:{change:t.checkall},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("\n                "+t._s(t.$t("base.checkAll"))+"\n              ")])],1),a("van-col",{staticClass:"checkAll",attrs:{span:"19"}},[a("span",{staticClass:"footerSpan"},[t._v("\n                "+t._s("库位:"+t.selectedNum)+"\n              ")]),a("span",{staticClass:"footerSpan"},[t._v("\n                "+t._s("库存:"+t.selectedMesNum)+"\n              ")]),a("van-button",{staticClass:"footbtn",staticStyle:{display:"inline-block"},attrs:{size:"small",color:"#FBCF09"},on:{click:t.sure}},[t._v("\n                "+t._s(t.$t("base.sure"))+"\n              ")])],1)],1)],1)]},proxy:!0}])})],1)],1)},E=[],_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"stackBlock",attrs:{id:"stackBlock"}},[a("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[a("van-list",{ref:"list",attrs:{"immediate-check":!1,"loading-text":"",finished:t.finished,"finished-text":t.$t("base.nomore")},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.stackList,(function(e,s){return a("van-row",{key:s,staticClass:"stackBlockBody"},[a("van-sidebar",[a("van-sidebar-item",{attrs:{title:e.pathName}})],1),a("van-row",[a("van-grid",{staticClass:"iconCenter",attrs:{clickable:"","column-num":4,border:!1}},t._l(e.pdStackVoList,(function(e){return a("van-grid-item",{key:e.wpsStackId,attrs:{text:e.stackName}},[a("pdStackone",{ref:"stackone",refInFor:!0,attrs:{stackEntity:e},on:{changed:t.changed}})],1)})),1)],1)],1)})),1)],1)],1)},O=[],$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"stack"},[a("div",{staticClass:"stackBody",style:{"background-color":t.stackEntity.backgroundColor},on:{click:function(e){return t.click(!t.checked,t.stackEntity.checkAble)}}},[t.stackEntity.showCheck?a("van-checkbox",{ref:"checkbox",staticClass:"checkbox",attrs:{"icon-size":"0.8rem","checked-color":t.stackEntity.checkColor},on:{click:function(e){return t.checkboxClick(t.stackEntity.checkAble)}},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}}):t._e(),a("div",{staticClass:"stack-message"},[a("span",[t._v(t._s(t.stackEntity["wpsMesNum"]))]),a("span",[t._v(t._s(t.stackEntity["matThickNess"]))])]),a("div",{staticClass:"progress-location"},[a("van-progress",{attrs:{percentage:t.matPercentage,color:"#61408c","stroke-width":"12","show-pivot":!0,"pivot-text":t.percentageText}})],1)],1),a("span",{staticClass:"mat-instock-title mat-instock-name "},[t._v(t._s(t.stackEntity.stackName))])])},B=[],N={name:"pdStackone",components:{},props:{stackEntity:{type:Object},fixedField:{type:Array},maxHeight:{type:Number,default:function(){return 2e3}}},data:function(){return{checked:!1,messageOne:"",messageTwo:""}},computed:{oriPercentage:function(){return this.stackEntity.matThickNess?this.stackEntity.matThickNess/this.maxHeight*100:0},matPercentage:function(){var t=this.oriPercentage;return t>100&&(t=100),t?t.toFixed(1):0},percentageText:function(){var t=this.oriPercentage;return t?"".concat(t.toFixed(1),"%"):"0%"}},watch:{checked:{handler:function(t){this.$emit("changed",this.stackEntity)},immediate:!0}},methods:{click:function(t,e){if(!e)return!1;this.$refs.checkbox.toggle()},checkboxClick:function(t){t||this.$refs.checkbox.toggle(!0)}},created:function(){this.stackEntity.checked&&(this.checked=!0)},mounted:function(){}},F=N,T=(a("bbb0"),Object(m["a"])(F,$,B,!1,null,"7b9fd776",null)),P=T.exports,L={name:"pdStackList",components:{pdStackone:P},data:function(){return{refreshing:!1,loading:!1,finished:!1}},props:{storeId:{type:String,default:function(){return""}},stackList:{type:Array,default:function(){return[]}}},methods:{changed:function(t){this.$emit("changed",t)},checkAll:function(t){this.$refs.stackone&&this.$refs.stackone.forEach((function(e){e.stackEntity.checkAble&&e.$refs.checkbox.toggle(t)}))},getselecte:function(){var t=[];return this.$refs.stackone&&this.$refs.stackone.forEach((function(e){!0===e.checked&&t.push(e.stackEntity)})),t},checked:function(t){},cleanchecked:function(){this.$refs.stackone&&this.$refs.stackone.forEach((function(t){t.$refs.checkbox.toggle(!1)}))},onRefresh:function(){this.finished=!1,this.loading=!0,this.onLoad(0)},onLoad:function(){var t=this;this.$emit("search",(function(){t.refreshing&&(t.refreshing=!1),t.loading=!1}))},openDetail:function(t,e){this.$emit("openDetail",t,e)}}},D=L,M=(a("0f1e"),Object(m["a"])(D,_,O,!1,null,"798897c1",null)),H=M.exports,j={name:"pdStackSelect",components:{pdStackList:H},props:{show:{type:Boolean,default:function(){return!1}},wpsOrderId:{type:String},storeId:{type:String,default:function(){return""}},storeName:{type:String,default:function(){return""}},stores:{type:Array}},data:function(){return{checkAll:!1,localstoreId:"",storeOption:[],listheight:10,stackName:"",stackList:[],total:0,sumWeight:0,sumMes:0,searchJson:{},selectedNum:0,selectedMesNum:0}},computed:{},methods:{checkall:function(t){this.$refs.stackList.checkAll(t)},getNameById:function(t){for(var e in this.storeOption){var a=this.storeOption[e];if(a.value===t)return a.text}return""},onchecked:function(t){this.$emit("onchecked",t)},changeStore:function(t){this.stackList.splice(0);var e=this.$toast.loading({message:"加载中...",overlay:!0,forbidClick:!0}),a=this,s=function(){a.$nextTick((function(){e.clear()}))};this.search(s)},changed:function(t){var e=this.getselecte(),a=0,s=0;e.forEach((function(t){a+=1,s+=t.wpsMesNum})),this.selectedNum=a,this.selectedMesNum=s},sure:function(){var t=this.getselecte();this.$emit("sure",this.storeId,t)},getselecte:function(){return this.$refs.stackList.getselecte()},cleanchecked:function(){this.$refs.stackList.cleanchecked()},close:function(t){this.$emit("closeSelect",t)},init:function(){var t=[];this.stores.forEach((function(e){t.push({text:e.name,value:e.id})})),this.storeOption=t},onBlur:function(){this.search()},search:function(t){var e=this;this.stackList.splice(0),this.searchJson={wpoStoreId:this.storeId,wpoPdType:2,stackName:this.stackName,wpsOrderId:this.wpsOrderId,wpoStoreType:8},this.$ajax("/wms/wmsPdStack/getmcheckstack","",this.searchJson,(function(a){var s=a.data.data[0].pdParentStackList;e.stackList=s;var i=0,n=0,c=0;s.forEach((function(t){t.pdStackVoList.forEach((function(t){i+=1,n+=t.matWeight,c+=t.wpsMesNum,"0"===t["selType"]?(t["showCheck"]=!0,t["checkAble"]=!0,t["checkColor"]="#fbcd05",t["backgroundColor"]=""):"1"===t["selType"]?0===t["wpsStatus"]?(t["checked"]=!0,t["showCheck"]=!0,t["checkAble"]=!0,t["checkColor"]="#fbcd05",t["backgroundColor"]="rgba(97, 64, 141, 0.39)"):(t["checked"]=!0,t["showCheck"]=!0,t["checkAble"]=!1,t["checkColor"]="#c296b4",t["backgroundColor"]="rgba(97, 64, 141, 0.39)"):(t["showCheck"]=!1,t["checkAble"]=!1,t["checkColor"]="#c296b4",t["backgroundColor"]="#a4e4ee")}))})),e.total=i,e.sumWeight=n,e.sumMes=c,e.$refs.stackList.finished=!0,e.$refs.stackList.$refs.list.check(),"undefined"!=typeof t&&t()}))}},created:function(){this.init()},mounted:function(){},watch:{show:{handler:function(t){if(!0===t){var e=this;this.$refs.stackList&&(this.$refs.stackList.loading=!1,this.$refs.stackList.finished=!1),this.$nextTick((function(){e.search()}))}},immediate:!0},stackList:{handler:function(){var t=this;this.$nextTick((function(){t.$refs.blankPage&&(t.listheight=t.$refs.blankPage.bodyheight-t.$refs.storebox.offsetHeight-t.$refs.headInfo.$el.offsetHeight)}))},immediate:!0}}},U=j,Q=(a("3e45"),Object(m["a"])(U,A,E,!1,null,"1723d469",null)),R=Q.exports,K={name:"pdSelectMain",components:{pdStackSelect:R},data:function(){return{buttons:[{key:"clean",display:this.$t("base.clean")}],displayText:"",stacks:[],show:!1}},props:{stores:{type:Array},storeId:{type:String},placeholder:{type:String,default:function(){return""}},value:{type:Array,default:function(){return[]}},title:{type:String,default:function(){return""}},disabled:{type:Boolean,default:function(){return!1}},wpsOrderId:{type:String}},methods:{open:function(){this.disabled||(this.show=!0)},onClickLeft:function(t){t.flag=!1,this.show=!1},sure:function(t,e){var a=[];e&&(a=e.map((function(t){return{wpsStackId:t.wpsStackId,wpsStatus:t.wpsStatus}}))),this.$emit("input",a),this.show=!1}},created:function(){},watch:{value:{handler:function(t){var e=this;if(this.displayText="",t)if(this.stacks&&0!==this.stacks.length){if(1===t.length){var a=t[0];this.stacks.forEach((function(t){a.wpsStackId===t.id&&(e.displayText=t.name)}))}else if(t.length>1){var s="",i=t[0];this.stacks.forEach((function(t){i.wpsStackId===t.id&&(s=t.name)})),this.displayText=s+"等"+t.length+"个库"}}else this.$ajax("/wms/wmsstack/listbystore","",{matStoreId:this.storeId},(function(a){var s=[];if(a.data.data.forEach((function(t){var e={id:t.id,name:t.stackName};s.push(e)})),e.stacks=s,1===t.length){var i=t[0];e.stacks.forEach((function(t){i.wpsStackId===t.id&&(e.displayText=t.name)}))}else if(t.length>1){var n="",c=t[0];e.stacks.forEach((function(t){c.wpsStackId===t.id&&(n=t.name)})),e.displayText=n+"等"+t.length+"个库"}}))},immediate:!0},storeId:{handler:function(t){var e=this;this.$emit("input",[]),t?this.$ajax("/wms/wmsstack/listbystore","",{matStoreId:t},(function(t){var a=[];t.data.data.forEach((function(t){var e={id:t.id,name:t.stackName};a.push(e)})),e.stacks=a})):this.stacks=[]},immediate:!0}}},V=K,J=Object(m["a"])(V,C,x,!1,null,"49afbf72",null),Y=J.exports,W={name:"addOrEdit",components:{pdStackSelect:Y},props:{selectItems:{type:Object,default:function(){return{}}},show:{type:Boolean,default:function(){return!1}},type:{type:Number},data:{type:Object}},data:function(){return{height:0,wpoOrder:"",wpoStoreType:"",wpoPdType:"",wpoStoreId:"",wpsOrderId:"",wpoLocation:[]}},methods:{close:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(t.flag=!1),this.$emit("close",a),setTimeout((function(){e.wpoStoreId=""}),300)},submit:function(){var t=this,e={wpoOrder:this.wpoOrder,wpoStoreType:8,wpoPdType:this.wpoPdType,wpoStoreId:this.wpoStoreId,wpsOrderId:this.wpsOrderId};if("1"!==this.wpoPdType||this.wpoStoreId){if("2"===this.wpoPdType){if(!this.wpoLocation)return void n["a"].fail({message:"未选择库位!"});var a=[];this.wpoLocation.forEach((function(e){e&&0==e.wpsStatus&&a.push({wpsStoreId:t.wpoStoreId,wpsStackId:e.wpsStackId})})),e["stackList"]=a}this.$ajax("/wms/wmsPdOrder/startcheckinv","",e,(function(){n["a"].success({message:"成功!"}),t.close({},!0)}))}else n["a"].fail({message:"未选择库房!"})},generateCode:function(){var t=this;this.$ajax("/common/comrulecfg/createcodebyruleconfig","",{businessType:"PD"},(function(e){t.wpoOrder=e.data.data}),(function(t){}))}},created:function(){this.height=window.innerHeight},watch:{show:{handler:function(t){!0===t&&(2===this.type?(this.wpsOrderId=this.data.wpsOrderId,this.wpoOrder=this.data.wpoOrder,this.wpoStoreType="8",this.wpoPdType=this.data.wpoPdType.toString(),this.wpoStoreId=this.data.wpoStoreId,this.wpoLocation=this.data.stackList):(this.wpsOrderId="",this.wpoStoreType="8",this.wpoPdType="",this.wpoStoreId="",this.wpoLocation=[],this.generateCode()))},immediate:!0}}},q=W,X=(a("3dfe"),Object(m["a"])(q,S,I,!1,null,"28f94175",null)),G=X.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#f7f7f7"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("blankPage",{ref:"blankPage",attrs:{title:"盘点库位"},on:{onClickLeft:t.close},scopedSlots:t._u([{key:"body",fn:function(){return[a("div",{ref:"storebox",staticClass:"storebox"},[a("menuselect",{staticStyle:{width:"48vw",float:"left"},attrs:{options:t.storeOption,showFirstItem:""},on:{change:t.changeStore},model:{value:t.wpsStoreId,callback:function(e){t.wpsStoreId=e},expression:"wpsStoreId"}}),a("van-search",{staticClass:"van-search-xs",attrs:{placeholder:t.$t("rawMaterialStorage.placeholder")},on:{blur:t.onBlur},model:{value:t.stackName,callback:function(e){t.stackName=e},expression:"stackName"}})],1),a("van-row",{ref:"headInfo",staticClass:"headInfo",attrs:{type:"flex",justify:"space-between"}},[a("van-col",{staticClass:"headInfo-v",attrs:{span:"8"}},[t._v("\n            "+t._s("盘点进度: "+t.process)+"\n          ")]),a("van-col",{staticClass:"headInfo-v",staticStyle:{"text-align":"center"},attrs:{span:"8"}},[t._v(t._s("计划库位: "+t.sumMes))]),a("van-col",{staticClass:"headInfo-v",staticStyle:{"text-align":"right"},attrs:{span:"8"}},[t._v(t._s("已盘库位: "+t.sumPd))])],1),a("div",{staticClass:"list",style:{height:t.listheight-5+"px"}},[a("REIstackList",{ref:"stackList",attrs:{stackList:t.stackList},on:{search:t.search,click:t.click}})],1)]},proxy:!0},{key:"foot",fn:function(){return[a("div",{staticClass:"foot"},[a("van-row",{staticStyle:{"text-align":"center"}},[a("van-col",{attrs:{span:"8"}},[a("span",{staticClass:"footerSpan"},[a("span",{staticClass:"box0"}),t._v("\n                未盘点\n              ")])]),a("van-col",{attrs:{span:"8"}},[a("span",{staticClass:"footerSpan"},[a("span",{staticClass:"box1"}),t._v("\n                盘点中\n              ")])]),a("van-col",{attrs:{span:"8"}},[a("span",{staticClass:"footerSpan"},[a("span",{staticClass:"box2"}),t._v("\n                已盘点\n              ")])])],1)],1)]},proxy:!0}])})],1),t.showInventoryMain?a("inventoryMain",{attrs:{stack:t.stack,status:t.status,wpsOrderId:t.wpsOrderId},on:{close:t.closeInventoryMain,completePd:t.completePd}}):t._e()],1)},Z=[],tt=(a("7514"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"stackBlock",attrs:{id:"stackBlock"}},[a("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[a("van-list",{ref:"list",attrs:{"immediate-check":!1,"loading-text":"",finished:t.finished,"finished-text":t.$t("base.nomore")},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.stackList,(function(e,s){return a("van-row",{key:s,staticClass:"stackBlockBody"},[a("van-sidebar",[a("van-sidebar-item",{attrs:{title:e.pathName}})],1),a("van-row",[a("van-grid",{staticClass:"iconCenter",attrs:{clickable:"","column-num":4,border:!1}},t._l(e.pdStackVoList,(function(e){return a("van-grid-item",{key:e.wpsStackId,attrs:{text:e.stackName}},[a("REIStackone",{ref:"stackone",refInFor:!0,attrs:{stackEntity:e},on:{click:t.click}})],1)})),1)],1)],1)})),1)],1)],1)}),et=[],at=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"stack"},[a("div",{staticClass:"stackBody",style:{"background-color":t.stackEntity.backgroundColor},on:{click:t.click}},[a("div",{staticStyle:{width:"100%","text-align":"right"}},[a("span",{staticClass:"tag",style:{backgroundColor:t.tagColor}},[t._v(t._s(t.tagValue))])]),a("div",{staticClass:"stack-message"},[a("span",[t._v(t._s(t.stackEntity["wpsMesNum"]))]),a("span",[t._v(t._s(t.stackEntity["matThickNess"]))])]),a("div",{staticClass:"progress-location"},[a("van-progress",{attrs:{percentage:t.matPercentage,color:"#61408c","stroke-width":"12","show-pivot":!0,"pivot-text":t.percentageText}})],1)]),a("span",{staticClass:"mat-instock-title mat-instock-name "},[t._v(t._s(t.stackEntity.stackName))])])},st=[],it={name:"REIStackone",components:{},props:{stackEntity:{type:Object},maxHeight:{type:Number,default:function(){return 2e3}}},data:function(){return{checked:!1,messageOne:"",messageTwo:""}},computed:{oriPercentage:function(){return this.stackEntity.matSumThickness?this.stackEntity.matSumThickness/this.maxHeight*100:0},tagValue:function(){return 0===this.stackEntity.wpsResult?"无盈亏":1===this.stackEntity.wpsResult?"有盈亏":2===this.stackEntity.wpsResult?"盘盈":3===this.stackEntity.wpsResult?"盘亏":void 0},tagColor:function(){return 0===this.stackEntity.wpsResult?"#009933":1===this.stackEntity.wpsResult?"#09c":2===this.stackEntity.wpsResult?"#fc0":"#c30"},matPercentage:function(){var t=this.oriPercentage;return t>100&&(t=100),t?t.toFixed(1):0},percentageText:function(){var t=this.oriPercentage;return t?"".concat(t.toFixed(1),"%"):"0%"}},watch:{checked:{handler:function(t){this.$emit("changed",this.stackEntity)},immediate:!0}},methods:{click:function(){this.$emit("click",this.stackEntity)}},created:function(){this.stackEntity.checked&&(this.checked=!0)},mounted:function(){}},nt=it,ct=(a("9dc6"),Object(m["a"])(nt,at,st,!1,null,"67c55739",null)),ot=ct.exports,rt={name:"REIstackList",components:{REIStackone:ot},data:function(){return{refreshing:!1,loading:!1,finished:!1}},props:{storeId:{type:String,default:function(){return""}},stackList:{type:Array,default:function(){return[]}}},methods:{onRefresh:function(){this.finished=!1,this.loading=!0,this.onLoad(0)},onLoad:function(){var t=this;this.$emit("search",(function(){t.refreshing&&(t.refreshing=!1),t.loading=!1}))},click:function(t){this.$emit("click",t)}}},dt=rt,lt=(a("e291"),Object(m["a"])(dt,tt,et,!1,null,"091c7451",null)),ht=lt.exports,ut=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#f7f7f7"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("van-popup",{style:{height:t.headerheight+t.titleheight-t.titleBH+"px",top:t.baseNavigationh+"px"},attrs:{position:"top"},model:{value:t.showSearch,callback:function(e){t.showSearch=e},expression:"showSearch"}},[s("van-search",{staticClass:"vsearch",attrs:{"show-action":"",placeholder:"请录入条码"},on:{search:t.searchByCode},scopedSlots:t._u([{key:"action",fn:function(){return[s("div",{on:{click:function(e){return t.searchByCode(t.matBarcode)}}},[t._v("确认")])]},proxy:!0}]),model:{value:t.matBarcode,callback:function(e){t.matBarcode=e},expression:"matBarcode"}})],1),s("van-popup",{style:{height:t.footheight+"px",bottom:0,width:"100%"},attrs:{position:"bottom"},model:{value:t.showButtons,callback:function(e){t.showButtons=e},expression:"showButtons"}},[s("van-row",{staticClass:"row1",attrs:{type:"flex",align:"center"}},[s("van-col",{staticClass:"col1",attrs:{span:"12"},on:{click:t.openCamera}},[t._v("摄像头")]),s("van-col",{staticClass:"col2",attrs:{span:"12"},on:{click:t.openUHF}},[t._v("UHF")])],1)],1),s("div",{staticStyle:{height:"100%"}},[s("baseNavigation",{ref:"baseNavigation",attrs:{title:"实物盘点",rightIcon:"delete"},on:{onClickLeft:t.onClickLeft,rightClick:t.rightClick}}),s("div",{ref:"header",staticClass:"header"},[s("van-row",{staticClass:"header-text",attrs:{type:"flex"}},[s("van-col",{attrs:{span:"14"}},[t._v("库位:"+t._s(t.stack.pathName+" "+t.stack.stackName)+">")]),s("van-col",{attrs:{span:"5"}},[s("span",{staticClass:"circle-text",staticStyle:{color:"#1E90FF"}},[t._v("盈")]),s("span",{staticClass:"over-text"},[t._v(t._s(t.numY))])]),s("van-col",{attrs:{span:"5"}},[s("span",{staticClass:"circle-text",staticStyle:{color:"red"}},[t._v("亏")]),s("span",{staticClass:"over-text"},[t._v(t._s(t.numK))])])],1)],1),s("div",{ref:"title",staticClass:"title"},[s("van-row",{staticClass:"header-text",attrs:{type:"flex"}},[s("van-col",{attrs:{span:"12"}},[s("div",{staticClass:"box-container"},[s("span",{staticClass:"titleNumber-left"},[t._v(t._s(t.mesdatas.length))]),s("div",{staticClass:"border-right"},[t._v("账目")])])]),s("van-col",{attrs:{span:"12"}},[s("div",{staticClass:"box-container"},[s("span",{staticClass:"titleNumber-right"},[t._v(t._s(t.localdatas.length))]),s("div",{staticClass:"border-left"},[t._v("实物")])])])],1)],1),s("van-row",{attrs:{gutter:"5"}},[s("van-col",{attrs:{span:"12"}},[s("div",{ref:"left",style:{height:t.bodyheight+"PX",top:t.bodytop+"PX","background-color":"#f7f7f7 transparent",overflow:"auto"}},[s("div",{staticStyle:{"background-color":"#f7f7f7"}},[s("draggable",{attrs:{element:"div",chosenClass:"chosenClass",options:{group:{name:"itxst",pull:"clone",put:!1},sort:!1},delay:"300",animation:"300",disabled:1===t.status,move:t.onMove,clone:t.clone},model:{value:t.mesdatas,callback:function(e){t.mesdatas=e},expression:"mesdatas"}},[s("transition-group",{staticStyle:{width:"100%"}},t._l(t.mesdatas,(function(e,a){return s("card",{key:e.wpdMatId,attrs:{data:e,index:a+1,cardField:t.cardField}})})),1)],1)],1)])]),s("van-col",{attrs:{span:"12"}},[s("div",{ref:"right",style:{height:t.bodyheight+"PX",top:t.bodytop+"PX","background-color":"#f7f7f7 transparent",overflow:"auto"}},[s("div",{staticStyle:{"background-color":"#f7f7f7"}},[s("draggable",{style:{minHeight:t.bodyheight-60+"PX"},attrs:{disabled:1===t.status,element:"div",delay:"300",animation:"300",group:"itxst",chosenClass:"chosenClass",filter:".forbid"},on:{sort:t.sort,choose:t.choose,unchoose:t.unchoose},model:{value:t.localdatas,callback:function(e){t.localdatas=e},expression:"localdatas"}},t._l(t.localdatas,(function(e,a){return s("swipeCard",{key:e.matBarcode,attrs:{data:e,index:a+1,cardField:t.cardField,disabled:t.disabled},on:{del:t.del}})})),1)],1)])])],1),s("van-image",{ref:"image",staticClass:"img",style:{top:t.imagetop+"px"},attrs:{src:a("cf05"),fit:"contain"}}),s("van-tabbar",{ref:"foot",model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[s("van-tabbar-item",{attrs:{icon:"column"},on:{click:t.copy}},[t._v("无码复制")]),s("van-tabbar-item",{attrs:{icon:"records"},on:{click:t.search}},[t._v("码损录入")]),s("van-tabbar-item",{attrs:{name:"QRcode"},on:{click:t.scanner},scopedSlots:t._u([{key:"icon",fn:function(e){return[s("img",{directives:[{name:"show",rawName:"v-show",value:!t.UHFopened,expression:"!UHFopened"}],staticClass:"imgClass1",attrs:{src:t.QRCodeImg}}),s("img",{directives:[{name:"show",rawName:"v-show",value:t.UHFopened,expression:"UHFopened"}],staticClass:"imgClass2",attrs:{src:a("cf1c")}})]}}])}),s("van-tabbar-item",{attrs:{icon:"add"},on:{click:t.openAdd}},[t._v("盘盈新增")]),s("van-tabbar-item",{attrs:{icon:"checked"},on:{click:t.completePd}},[t._v("完成盘点")])],1)],1),t.showAdd?s("addMat",{attrs:{show:t.showAdd},on:{close:t.closeAdd,sure:t.sure,checkCode:t.checkCode}}):t._e()],1)},ft=[],pt=(a("20d6"),a("b76a")),mt=a.n(pt),vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card"},[a("van-swipe-cell",{attrs:{disabled:t.disabled},scopedSlots:t._u([{key:"right",fn:function(){return[a("van-button",{staticClass:"delete",attrs:{square:"",color:"#e25f34",text:"删除"},on:{click:t.del}})]},proxy:!0}])},[a("van-row",{attrs:{gutter:"5"}},[a("van-col",{staticClass:"left",attrs:{span:"5"}},[a("van-row",{staticClass:"num"},[t._v(t._s(t.index))]),0===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"#006600"}},[t._v("一致")]):t._e(),1===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(255,204,0)"}},[t._v("层号")]):t._e(),2===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(255,102,0)"}},[t._v("库位")]):t._e(),3===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(0,0,255)"}},[t._v("盘盈")]):t._e()],1),a("van-col",{attrs:{span:"19"}},[a("van-row",{staticClass:"brow"},[a("van-col",{attrs:{span:"12"}},[a("span",{staticClass:"barcode"},[t._v(t._s(t.data.matBarcode))])]),a("van-col",{directives:[{name:"show",rawName:"v-show",value:t.data.matName,expression:"data.matName"}],staticStyle:{"padding-top":"2px","text-align":"right"},attrs:{span:"12"},on:{click:t.viewPic}},[a("van-icon",{attrs:{name:"photo",color:"gray"}})],1)],1),t._l(t.cardField,(function(e){return a("van-row",{key:e.key},[a("span",{staticClass:"cardField"},[t._v("\n            "+t._s(t.data[e.key])+"\n          ")])])}))],2)],1)],1)],1)},kt=[],gt=a("28a2"),wt={name:"swipeCard",props:{primaryKeyValue:{type:String,default:function(){return""}},selectItems:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},fixedField:{type:String,default:function(){return""}},cardField:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:function(){return!1}},index:{type:Number}},data:function(){return{checked:!1,baseUrl:""}},methods:{viewPic:function(){var t=this;this.$ajax("/wms/wmsPdDetail/getWmsSpicAddr","",{id:this.data.matName},(function(e){var a=e.data.data;a?Object(gt["a"])({images:[t.baseUrl+a],showIndex:!1}):n["a"].fail("未找到匹配图纸!")}))},del:function(){this.$emit("del",this.index-1)},getPrimaryKeyValue:function(){return this.primaryKeyValue},click:function(){this.$emit("click")}},computed:{tableKV:function(){var t=this,e={};return Object.keys(this.selectItems).forEach((function(a){if(t.selectItems[a]&&"object"==Object(h["a"])(t.selectItems[a])){var s={};t.selectItems[a].forEach((function(t){s[t.id]=t.name})),e[a]=s}})),e}},created:function(){var t=this.data.checked;if(t&&(this.checked=!0),this.data){var e=this.data["matMataId"]?this.data["matMataId"]:"N/A",a=this.data["matLength"]?this.data["matLength"]:"0",s=this.data["matWidth"]?this.data["matWidth"]:"0",i=this.data["matThickness"]?this.data["matThickness"]:"0";this.data["zhzd"]=e+"*"+a+"*"+s+"*"+i}this.baseUrl=this.getBaseUrl()}},yt=wt,bt=(a("76c9"),Object(m["a"])(yt,vt,kt,!1,null,"9325c9e4",null)),St=bt.exports,It=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card"},[a("van-row",{attrs:{gutter:"5"}},[a("van-col",{staticClass:"left",attrs:{span:"5"}},[a("van-row",{staticClass:"num"},[t._v(t._s(t.index))]),0===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"#006600"}},[t._v("一致")]):t._e(),1===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(255,204,0)"}},[t._v("层号")]):t._e(),2===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(255,102,0)"}},[t._v("库位")]):t._e(),4===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(255,0,255)"}},[t._v("疑亏")]):t._e(),5===t.data.wpdStatus?a("van-row",{staticClass:"status",staticStyle:{"background-color":"rgb(255,0,0)"}},[t._v("盘亏")]):t._e()],1),a("van-col",{attrs:{span:"19"}},[a("van-row",{staticClass:"brow"},[a("van-col",{attrs:{span:"12"}},[a("span",{staticClass:"barcode"},[t._v(t._s(t.data.matBarcode))])]),a("van-col",{directives:[{name:"show",rawName:"v-show",value:t.data.matName,expression:"data.matName"}],staticStyle:{"padding-top":"2px","text-align":"right"},attrs:{span:"12"},on:{click:t.viewPic}},[a("van-icon",{attrs:{name:"photo",color:"gray"}})],1)],1),t._l(t.cardField,(function(e){return a("van-row",{key:e.key,staticStyle:{height:"100%"}},[a("span",{staticClass:"cardField"},[t._v("\n            "+t._s(t.data[e.key])+"\n          ")])])}))],2)],1)],1)},Ct=[],xt={name:"card",props:{checkable:{type:Boolean,default:function(){return!0}},primaryKeyValue:{type:String,default:function(){return""}},selectItems:{type:Object,default:function(){return{}}},data:{type:Object,default:function(){return{}}},fixedField:{type:String,default:function(){return""}},cardField:{type:Array,default:function(){return[]}},index:{type:Number}},data:function(){return{baseUrl:""}},methods:{getPrimaryKeyValue:function(){return this.primaryKeyValue},click:function(){this.$emit("click")},viewPic:function(){var t=this;this.$ajax("/wms/wmsPdDetail/getWmsSpicAddr","",{id:this.data.matName},(function(e){var a=e.data.data;a?Object(gt["a"])({images:[t.baseUrl+a],showIndex:!1}):n["a"].fail("未找到匹配图纸!")}))}},computed:{tableKV:function(){var t=this,e={};return Object.keys(this.selectItems).forEach((function(a){if(t.selectItems[a]&&"object"==Object(h["a"])(t.selectItems[a])){var s={};t.selectItems[a].forEach((function(t){s[t.id]=t.name})),e[a]=s}})),e}},created:function(){var t=this.data.checked;if(t&&(this.checked=!0),this.data){var e=this.data["matMataId"]?this.data["matMataId"]:"N/A",a=this.data["matLength"]?this.data["matLength"]:"0",s=this.data["matWidth"]?this.data["matWidth"]:"0",i=this.data["matThickness"]?this.data["matThickness"]:"0";this.data["zhzd"]=e+"*"+a+"*"+s+"*"+i}this.baseUrl=this.getBaseUrl()}},At=xt,Et=(a("dc25"),Object(m["a"])(At,It,Ct,!1,null,"d5ab3e96",null)),_t=Et.exports,Ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#F7F7F7"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("blankPage",{ref:"blankPage",attrs:{title:"盘盈新增"},on:{onClickLeft:t.close},scopedSlots:t._u([{key:"body",fn:function(){return[a("div",{staticStyle:{height:"100%"}},[a("div",{style:{maxHeight:t.maxHeight+"px",overflow:"auto"}},[a("van-cell-group",t._l(t.fields,(function(e){return a("div",{key:e.key},["input"===e.contype?a("van-field",{attrs:{label:e.name,required:e.isMust,placeholder:t.$t("base.placeholder")+e.name},model:{value:t.values[e.key],callback:function(a){t.$set(t.values,e.key,a)},expression:"values[item.key]"}}):"select"===e.contype?a("singleSelect",{attrs:{title:e.name,readonly:e.readonly,selectItems:t.selectItems[e.key],disabled:e.condisabled,placeholder:t.$t("base.placeholder")+e.name,inputAlign:"left"},model:{value:t.values[e.key],callback:function(a){t.$set(t.values,e.key,a)},expression:"values[item.key]"}}):"number"===e.contype?a("van-field",{attrs:{type:"number",label:e.name,required:e.isMust,placeholder:t.$t("base.placeholder")+e.name,readonly:e.readonly},model:{value:t.values[e.key],callback:function(a){t.$set(t.values,e.key,a)},expression:"values[item.key]"}}):"date"===e.contype?a("singleDatetimePicker",{attrs:{title:e.name,conexp:e.conexp,placeholder:t.$t("base.selectplaceholder")+e.name,inputAlign:"left"},model:{value:t.values[e.key],callback:function(a){t.$set(t.values,e.key,a)},expression:"values[item.key]"}}):t._e()],1)})),0)],1)])]},proxy:!0},{key:"foot",fn:function(){return[a("van-button",{staticStyle:{width:"100%"},attrs:{color:"#fbce08"},on:{click:t.sure}},[t._v("确认")])]},proxy:!0}])})],1)],1)},$t=[],Bt={name:"addMat",props:{show:{type:Boolean,default:function(){return!1}}},data:function(){return{height:0,values:{matSheetType:"1",matBasicQuantity:1},fields:[],maxHeight:0,selectItems:{}}},methods:{close:function(t){t.flag=!1,this.$emit("close")},initcol:function(){var t=this;this.$ajax("/common/sysfieldcfg/getfieldcfgbytype","",{fieldCfgType:"WMS-REM-IMPORT"},(function(e){var a=e.data.data.filter((function(t){return"1"==t.fieldCfgIscheck}));t.$ajax("/auth/res/getcol","",{moduleid:"storage_7001"},(function(e){var s=e.data.data;t.fields.push({key:"matBarcode",conexp:"=",name:"条码号",readonly:!0,contype:"input",condisabled:!1,isMust:!0}),a.map((function(e){var a=s.find((function(t){return t.colkey==e.fieldCfgKey}));e.fieldCfgType=a?a.coltype:"input","mbomName"==e.fieldCfgKey&&"edit"==t.editType?e.fieldDisabled=!0:e.fieldDisabled=!1;var i=!1;"matSheetType"!=e.fieldCfgKey&&"matBasicQuantity"!=e.fieldCfgKey||(i=!0),"matBarcode"!=e.fieldCfgKey&&t.fields.push({name:e.fieldCfgName,conexp:"=",key:e.fieldCfgKey,readonly:i,contype:e.fieldCfgType,condisabled:e.fieldDisabled,isMust:1==e.fieldCfgIsmust})}))}))}))},initDist:function(){var t=this;this.selectItems.matStorageStatus=u["a"].getDict("STORAGE_STATUS"),this.selectItems.matInvStatus=u["a"].getDict("MAT_STATUS"),this.selectItems.matSheetType=u["a"].getDict("SHEET_TYPE"),this.selectItems.wmsPicStatus=[{id:"0",name:"未检查",icon:"ios-image",color:"#666"},{id:"1",name:"有图",icon:"md-images",color:"#42CE6C"},{id:"2",name:"缺图",icon:"md-image",color:"#F7434D"}],this.selectItems.ifHasPar=[{id:"1",name:"已匹配",icon:"tag",color:"#42CE6C"},{id:"0",name:"未匹配",icon:"tag",color:"#F7434D"}],this.selectItems.wmsDataSource=[{id:"0",name:"套料提取"},{id:"1",name:"Excel导入"},{id:"2",name:"新增"},{id:"3",name:"盘盈"}],this.$ajax("/auth/user/listuser","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.userRealname};a.push(e)})),t.selectItems.matInstoreUserid=a}))},sure:function(){for(var t=0;t<this.fields.length;t++){var e=this.fields[t];if(e.isMust&&!this.values[e.key])return void this.$toast.fail(e.name+"不允许为空")}var a={flag:!0},s=this;this.$ajax("/wms/wmsmat/checkrepeatbarcode","",this.values["matBarcode"],(function(){s.$emit("checkCode",s.values["matBarcode"],a),a.flag?s.$emit("sure",s.values):s.$toast.fail("条码重复")}))}},created:function(){var t=window.innerHeight;this.height=t,this.initDist(),this.initcol()},mounted:function(){var t=this;this.$nextTick((function(){t.maxHeight=t.$refs.blankPage.imagetop-t.$refs.blankPage.baseNavigationh-10}))}},Nt=Bt,Ft=(a("86bf"),Object(m["a"])(Nt,Ot,$t,!1,null,"2429262b",null)),Tt=Ft.exports,Pt={name:"blankPage",components:{draggable:mt.a,swipeCard:St,card:_t,addMat:Tt},props:{status:{type:Number},stack:{type:Object},wpsOrderId:{type:String}},data:function(){return{showAdd:!1,UHFlist:[],barcodeLength:5,radio:1,active:0,actions:[{text:"摄像头"},{text:"UHF"}],UHFopened:!1,showButtons:!1,showSearch:!1,matBarcode:"",show:!0,baseNavigationh:0,bodyheight:0,bodytop:0,imagetop:0,foottop:0,height:0,footheight:0,imageheight:0,headerheight:0,titleheight:0,titleBH:0,localdatas:[],mesdatas:[],cardField:[],disabled:!1,QRCodeImg:a("29f5")}},methods:{searchByCode:function(t){var e=this,a={wpdOrderId:this.wpsOrderId,matBarcode:t,wpdStoreId:this.stack.wpsStoreId,wpdStackId:this.stack.wpsStackId};this.showSearch=!1,this.$ajax("/wms/wmsPdDetail/getmatbybarcode","",a,(function(a){var s=a.data.data;e.localdatas.findIndex((function(e){return e.matBarcode===t}))>=0||(s&&Object.keys(s).length>0?(e.localdatas.push(s),e.checkStatus()):e.$toast("已锁定库房中,未查到该条码绑定的物资"))}))},closeAdd:function(){this.showAdd=!1},sure:function(t){this.localdatas.findIndex((function(e){return e.matBarcode===t.matBarcode}))>=0?this.$toast.fail("条码重复"):(this.showAdd=!1,this.localdatas.push(t),this.checkStatus())},checkCode:function(t,e){this.localdatas.findIndex((function(e){return e.matBarcode===t}))>=0&&(e.flag=!1)},openAdd:function(){1!==this.status&&(this.showAdd=!0)},completePd:function(){var t=this;if(1!==this.status){var e=this.$toast.loading({message:"加载中...",overlay:!0,forbidClick:!0}),a={orderId:this.wpsOrderId,stackId:this.stack.wpsStackId,list:[]},s=[];this.mesdatas.forEach((function(e,a){var i={id:e.wpdDetailId,wpdOrderId:t.wpsOrderId,wpdStoreId:t.stack.wpsStoreId,wpdStackId:t.stack.wpsStackId,wpdType:0,wpdStatus:e.wpdStatus,wpdMatId:e.wpdMatId,wpdPyData:"",wpdLayer:a+1};s.push(i)})),this.localdatas.forEach((function(e,a){var i={id:e.wpdDetailId,wpdOrderId:t.wpsOrderId,wpdStoreId:t.stack.wpsStoreId,wpdStackId:t.stack.wpsStackId,wpdType:1,wpdStatus:e.wpdStatus,wpdMatId:e.wpdMatId,wpdPyData:"",wpdLayer:a+1};3===e.wpdStatus&&(i["wpdPyData"]=e),s.push(i)})),a["list"]=s,this.$ajax("/wms/wmsPdDetail/completePd","",a,(function(e){t.$toast.success("盘点完成"),t.$emit("completePd")}),(function(){return e.clear()}))}else this.$toast.fail("当前盘点单已更新，无法继续操作")},scanner:function(){1!==this.status&&(this.UHFopened?this.stopUHF():this.showButtons=!0)},stopUHF:function(){this.UHFopened=!1;var t=localStorage.getItem("equipmentType");t&&"XUESI2"==t?(sc.UHFStopUt(),sc.UHFOnDestroyUt()):(sc.UHFStop(),sc.UHFOnDestroy()),this.checkStatus()},openCamera:function(){this.showButtons=!1;var t="html/fnscanner_frm.html";api.openWin({name:"fnscanner_frm",url:t,slidBackEnabled:!1})},openUHF:function(){this.UHFlist=[],this.showButtons=!1;var t=localStorage.getItem("equipmentType");t&&"XUESI2"==t?(sc.initUtUHF(this.UHFscanning),sc.UHFStartUt()):(sc.initUHF(this.UHFscanning),sc.UHFStart()),this.UHFopened=!0},checkStatus:function(){var t=this;this.mesdatas.forEach((function(e,a){if(2!==e.wpdStatus){var s=t.localdatas.findIndex((function(t){return t.wpdMatId===e.wpdMatId}));if(a===s)e["wpdStatus"]=0;else if(s>=0)e["wpdStatus"]=1;else{if(4===e.wpdStatus||5===e.wpdStatus)return;e["wpdStatus"]=9}}})),this.localdatas.forEach((function(e,a){if(2!==e.wpdStatus){var s=t.mesdatas.findIndex((function(t){return t.wpdMatId===e.wpdMatId}));e["wpdStatus"]=a===s?0:s>=0?1:3}}))},copy:function(){if(1!==this.status){var t=this,e=[];this.mesdatas.forEach((function(a){2!==a.wpdStatus&&(!a.matBarcode&&-1===t.localdatas.findIndex((function(t){return t.wpdMatId===a.wpdMatId}))||a.matBarcode&&-1===t.localdatas.findIndex((function(t){return t.matBarcode===a.matBarcode})))&&e.push(a)})),e.forEach((function(e){var a=JSON.parse(JSON.stringify(e));a["wpdDetailId"]=null,t.localdatas.push(a)})),e.length>0&&this.checkStatus()}},search:function(){1!==this.status&&(this.showSearch=!this.showSearch)},clone:function(t){var e=JSON.parse(JSON.stringify(t));return e.wpdDetailId=null,e},onMove:function(t){var e=t.draggedContext.element;return 2===e.wpdStatus?(this.$toast("库位状态无法复制"),!1):!(this.localdatas.findIndex((function(t){return t.wpdMatId===e.wpdMatId}))>=0)||(this.$toast("重复物资"),!1)},del:function(t){this.localdatas.splice(t,1),this.checkStatus()},choose:function(){this.disabled=!0},unchoose:function(){this.disabled=!1},sort:function(t){this.checkStatus()},rightClick:function(){if(1!==this.status){var t=this;c["a"].confirm({title:"提示",message:"确定要清除辛苦盘点的数据吗？"}).then((function(){t.localdatas.splice(0,t.localdatas.length),t.checkStatus()})).catch((function(){}))}},onClickLeft:function(t){t&&(t.flag=!1),this.$emit("close")},blankPageMounted:function(){var t=window.innerHeight,e=this;this.$nextTick((function(){e.baseNavigationh=e.$refs.baseNavigation.$el.offsetHeight,e.imageheight=e.$refs.image.$el.offsetHeight,e.headerheight=e.$refs.header.offsetHeight,e.titleheight=e.$refs.title.offsetHeight,e.titleBH=(e.$refs.title.offsetHeight-e.$refs.title.clientHeight)/2,e.height=t,e.footheight=e.$refs.foot.$el.offsetHeight,e.bodyheight=t-e.baseNavigationh-e.footheight-e.headerheight-e.titleheight,e.bodytop=e.baseNavigationh,e.imagetop=e.baseNavigationh+e.bodyheight+e.headerheight+e.titleheight-e.imageheight,e.foottop=e.baseNavigationh+e.bodyheight}))},scanning:function(t){var e=this,a=t.data,s={wpdOrderId:this.wpsOrderId,matBarcode:a,wpdStoreId:this.stack.wpsStoreId,wpdStackId:this.stack.wpsStackId};this.$ajax("/wms/wmsPdDetail/getmatbybarcode","",s,(function(t){var s=t.data.data;e.localdatas.findIndex((function(t){return t.matBarcode===a}))>=0||s&&Object.keys(s).length>0&&(e.localdatas.push(s),e.checkStatus())}))},UHFscanning:function(t){var e=this,a=t.data,s=this;if(!(this.UHFlist.findIndex((function(t){return t.matBarcode===a}))>=0)){s.UHFlist.push({matBarcode:a});var i={wpdOrderId:this.wpsOrderId,matBarcode:a,wpdStoreId:this.stack.wpsStoreId,wpdStackId:this.stack.wpsStackId};this.$ajax("/wms/wmsPdDetail/getmatbybarcode","",i,(function(t){var s=t.data.data;e.localdatas.findIndex((function(t){return t.matBarcode===a}))>=0||s&&Object.keys(s).length>0&&e.localdatas.push(s)}))}}},mounted:function(){this.blankPageMounted()},updated:function(){},created:function(){var t=this,e=this.$toast.loading({message:"加载中...",overlay:!0,forbidClick:!0});1===this.status&&(this.disabled=!0);var a=localStorage.getItem("UHFLength");this.barcodeLength=a||5;var s=localStorage.getItem("radio");this.radio=s||1,this.$ajax("/auth/mres/getcardcol","",{moduleid:"storage_0017",pcmoduleid:"storage_1016"},(function(e){var a=e.data.data,s=[];a.forEach((function(t){0===t.position&&s.push(t)})),t.cardField=s})),this.$ajax("/wms/wmsPdDetail/startpddetail","",{wpdOrderId:this.wpsOrderId,wpdStoreId:this.stack.wpsStoreId,wpdStackId:this.stack.wpsStackId},(function(a){var s=a.data.data;s.mesDetailList?t.mesdatas=s.mesDetailList:t.mesdatas=[],s.actDetailList?t.localdatas=s.actDetailList:t.localdatas=[],t.$nextTick((function(){e.clear()}))}),(function(){return e.clear()}));var i=this;api.addEventListener({name:"closeScranner"},(function(t){if(t.value&&t.value.content){var e=t.value.content;i.scanning({data:e})}}));var n=localStorage.getItem("equipmentType");n&&"XUESI2"==n?sc.initUTScan(this.scanning):sc.initScan(this.scanning)},computed:{numY:function(){var t=0;return this.localdatas.forEach((function(e){3===e.wpdStatus&&t++})),t},numK:function(){var t=0;return this.mesdatas.forEach((function(e){4!==e.wpdStatus&&5!==e.wpdStatus||t++})),t}},destroyed:function(){api.removeEventListener({name:"closeScranner"});var t=localStorage.getItem("equipmentType");t&&"XUESI2"==t?(sc.initUTScan(void 0),sc.UHFStopUt(),sc.UHFOnDestroyUt()):(sc.initScan(void 0),sc.UHFStop(),sc.UHFOnDestroy())}},Lt=Pt,Dt=(a("6e4e"),Object(m["a"])(Lt,ut,ft,!1,null,"0975f3b8",null)),Mt=Dt.exports,Ht={name:"remEnterInventory",components:{REIstackList:ht,inventoryMain:Mt},props:{show:{type:Boolean,default:function(){return!1}},wpsOrderId:{type:String},storeName:{type:String,default:function(){return""}},stores:{type:Array}},data:function(){return{status:1,showInventoryMain:!1,wpsStoreId:"",storeOption:[],listheight:10,stackName:"",stackList:[],process:0,sumPd:0,sumMes:0,searchJson:{},selectedNum:0,selectedMesNum:0,stack:{}}},computed:{},methods:{closeInventoryMain:function(){this.showInventoryMain=!1,this.search()},completePd:function(){this.showInventoryMain=!1,this.search()},click:function(t){var e=this,a=t.wpsStoreId,s=this.storeOption.find((function(t){return t.value===a})).text;1===this.status?(this.stack=t,this.showInventoryMain=!0):0===t.wpsStatus?c["a"].confirm({title:"提示",message:"您即将盘点"+s+"库房"+t.stackName+"库位，请注意从下往上进行盘点"}).then((function(){e.stack=t,e.showInventoryMain=!0})).catch((function(){})):1===t.wpsStatus?c["a"].confirm({title:"提示",message:"您即将盘点"+s+"库房"+t.stackName+"库位，请注意从下往上进行盘点"}).then((function(){e.stack=t,e.showInventoryMain=!0})).catch((function(){})):c["a"].confirm({title:"提示",message:"您即将再次确认"+s+"库房"+t.stackName+"库位，完成后，需要您进行完成盘点确认，请注意从下往上进行盘点"}).then((function(){e.stack=t,e.showInventoryMain=!0})).catch((function(){}))},changeStore:function(){this.stackList.splice(0);var t=this.$toast.loading({message:"加载中...",overlay:!0,forbidClick:!0}),e=this,a=function(){e.$nextTick((function(){t.clear()}))};this.search(a)},close:function(t){t&&(t.flag=!1),this.$emit("close")},init:function(){var t=this;this.$ajax("/wms/wmsPdOrder/getpdorderbyid","",{id:this.wpsOrderId},(function(e){e&&e.data&&e.data.data&&(t.status=e.data.data.wpoStaus)})),this.$ajax("/wms/wmsPdStack/getcheckingprocess","",{wpsOrderId:this.wpsOrderId,wpoStoreType:8},(function(e){var a=e.data.data,s=[];a.forEach((function(t){return s.push({text:t.storeName,value:t.wpsStoreId})})),t.storeOption=s;var i=a[0].pdParentStackList;t.sumMes=e.data.data[0].stackCount,t.sumPd=e.data.data[0].stackOver,t.process=parseInt(t.sumPd/t.sumMes*100).toString()+"%",t.afterSearch(i),t.stackList=i}))},onBlur:function(){this.search()},afterSearch:function(t){t.forEach((function(t){t.pdStackVoList.forEach((function(t){0===t["wpsStatus"]?t["backgroundColor"]="":1===t["wpsStatus"]?t["backgroundColor"]="rgba(251, 205, 5, 0.39)":t["backgroundColor"]="rgba(97, 64, 140, 0.39)"}))}))},search:function(t){var e=this;this.$ajax("/wms/wmsPdOrder/getpdorderbyid","",{id:this.wpsOrderId},(function(t){t&&t.data&&t.data.data&&(e.status=t.data.data.wpoStaus)})),this.stackList.splice(0),this.searchJson={wpoStoreId:this.wpsStoreId,wpsOrderId:this.wpsOrderId,stackName:this.stackName,wpoStoreType:8},this.$ajax("/wms/wmsPdStack/getcheckingprocess","",this.searchJson,(function(a){var s=a.data.data[0].pdParentStackList;e.sumMes=a.data.data[0].stackCount,e.sumPd=a.data.data[0].stackOver,e.process=parseInt(e.sumPd/e.sumMes*100).toString()+"%",e.afterSearch(s),e.stackList=s,e.$refs.stackList.finished=!0,e.$refs.stackList.$refs.list.check(),"undefined"!=typeof t&&t()}))}},created:function(){this.init()},mounted:function(){this.$refs.stackList.loading=!1,this.$refs.stackList.finished=!1},watch:{stackList:{handler:function(){var t=this;this.$nextTick((function(){t.$refs.blankPage&&(t.listheight=t.$refs.blankPage.bodyheight-t.$refs.storebox.offsetHeight-t.$refs.headInfo.$el.offsetHeight)}))},immediate:!0}}},jt=Ht,Ut=(a("e019"),Object(m["a"])(jt,z,Z,!1,null,"ec149b80",null)),Qt=Ut.exports,Rt={name:"remInventory",components:{bodyList:b,addOrEdit:G,remEnterInventory:Qt},data:function(){return{numberCol:{},cardField:[],sumNum:0,sumYNum:0,sumKNum:0,wpsOrderId:"",selectData:{},title:"余料盘点",xsView:"view",showQueryConditions:!1,showAddOrEdit:!1,showRawEnterInventory:!1,onePage:!1,addOrEdit:1,tableCondition:[],fixedQueryConditions:[],defualtConditions:[{key:"wpoStoreType",exp:"=",value:"8"}],extRecords:{},extParams:{},datas:[],current:1,size:8,pages:0,total:0,selectItems:{wpoPdType:[{id:"0",name:"按全库"},{id:"1",name:"按库房"},{id:"2",name:"按库位"}],wpoStaus:[{id:"0",name:"盘点中"},{id:"1",name:"已更新"}],wpsResult:[{id:"0",name:"无盈亏"},{id:"1",name:"有盈亏"},{id:"2",name:"盘盈"},{id:"3",name:"盘亏"}]},btnMethod:{querymethod:"/wms/wmsPdOrder/qrycheckinvorder"},imagetop:0,top:0,bodyheight:0,imageheight:0,active:1,showDetail:!1,detaildata:{}}},methods:{rightClick:function(){this.showQueryConditions=!0},closeQueryConditions:function(){this.showQueryConditions=!1},closeAddOrEdit:function(t){this.wpsOrderId="",this.showAddOrEdit=!1,t&&this.search()},closeRawEnterInventory:function(){this.wpsOrderId="",this.showRawEnterInventory=!1,this.search()},getsearchJson:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.$refs.baseQueryConditions.cons,s=this.$refs.baseQueryConditions.conVals,i={},n={},c={},o=this.defualtConditions;o.forEach((function(t){"slaves"!==t.key?(n[t.key]=t.value,c[t.key]=t.exp):i=t.value})),Object.keys(s).forEach((function(t){return a.forEach((function(e){e.conkey===t&&(1===e.conismaster?(n[t]=s[t],c[t]=e.conexp):"undefined"!==typeof i[e.conparam]?(i[e.conparam]["value"][t]=s[t],i[e.conparam]["exp"][t]=e.conexp):(i[e.conparam]={},i[e.conparam]["value"]={},i[e.conparam]["exp"]={},i[e.conparam]["value"][t]=s[t],i[e.conparam]["exp"][t]=e.conexp))}))}));var r=this.fixedQueryConditions;r.forEach((function(t){"slaves"!==t.key?(n[t.key]=t.value,c[t.key]=t.exp):i=t.value})),n["wpoStaus"]||(n["wpoStaus"]="0,1",c["wpoStaus"]="in");var d={current:t,rows:!0===e?9999:this.size,value:n,exp:c,slaves:i,order:this.order};return d},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};1===e&&(this.current=1,this.datas.splice(0));var s=this.getsearchJson(e,this.onePage);this.$ajax(this.btnMethod.querymethod,"",s,(function(e){setTimeout((function(){return n["a"].clear()}),1e3);var s=e.data.data;s.records||(s.records=[]),t.afterquery(s),1===s.current?t.$nextTick((function(){t.datas=s.records})):t.datas=t.datas.concat(s.records),t.extRecords=s.extRecords?s.extRecords[0]:{},t.extParams=s.extParams?s.extParams:{},t.current=s.current,t.size=s.size,t.pages=s.pages,t.total=s.total,0===s.total?t.isEmpty=!0:t.isEmpty=!1,s.current>=s.pages?t.$refs.bodyList.finished=!0:t.$refs.bodyList.finished&&(t.$refs.bodyList.finished=!1),"undefined"!=typeof a&&a(s.current,s.pages)})),this.$ajax("/wms/wmsPdOrder/qrycheckinvordersum","",s,(function(e){var a=e.data.data;t.sumNum=a.wpoPdCount,t.sumYNum=a.wpsPyNum,t.sumKNum=a.wpsPkNum}))},openDetail:function(t){this.showDetail=!0,this.detaildata=t},closeDetail:function(){this.showDetail=!1},afterquery:function(t){t.records.forEach((function(t){t.wpoProgress=t["overStackNum"]+"/"+t["allStackNum"]}))},tabbarClick:function(t){var e=this;if(0===t)this.addOrEdit=1,this.showAddOrEdit=!0;else if(1===t){var a=this.$refs.bodyList.getselected();a&&0!==Object.keys(a).length?2===a.wpoPdType&&0===a.wpoStaus?(this.selectData=a,this.addOrEdit=2,this.showAddOrEdit=!0):1===a.wpoStaus?n["a"].fail({message:"该单据已更新数据，不允许编辑数据"}):n["a"].fail({message:"非按库位盘点策略，不可编辑，请结束盘点后，重新发起"}):n["a"].fail({message:"未选中数据"})}else if(2===t){var s=this.$refs.bodyList.getselected();0!==Object.keys(s).length?0==s.wpoStaus?c["a"].confirm({width:"90%",message:"是否确定中途结束您辛苦发起的盘点单，结束盘点后，将解放锁定的库位"}).then((function(){e.wpsOrderId=s.wpsOrderId,e.$ajax("/wms/wmsPdOrder/endOrder","",{id:e.wpsOrderId},(function(t){e.$toast.success("成功"),e.search()}))})):1==s.wpoStaus&&c["a"].confirm({width:"90%",message:"您即将结束盘点，结束盘点后，将解放锁定的库位"}).then((function(){e.wpsOrderId=s.wpsOrderId,e.$ajax("/wms/wmsPdOrder/endOrder","",{id:e.wpsOrderId},(function(t){e.$toast.success("成功"),e.search()}))})):n["a"].fail({message:"未选中数据"})}else if(3===t){var i=this.$refs.bodyList.getselected();0!==Object.keys(i).length?(this.wpsOrderId=i.wpsOrderId,this.addOrEdit=2,this.showRawEnterInventory=!0):n["a"].fail({message:"未选中数据"})}},initSelect:function(){var t=this;this.$ajax("/wms/wmsstore/list","",{storeType:8},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.storeName};a.push(e)})),t.selectItems.wpoStoreId=a})),this.$ajax("/wms/wmsstore/stacksByType","",[1],(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.stackPathName};a.push(e)})),t.selectItems.wpsStackId=a})),this.selectItems.wpoStoreType=u["a"].getDict("STORE_TYPE")}},created:function(){var t=this;this.initSelect();var e=localStorage.getItem("moduleid"),a=localStorage.getItem("xsModuleId");this.$ajax("/auth/mres/getcardcol","",{moduleid:e,pcmoduleid:a},(function(e){var a=e.data.data,s=[];a.forEach((function(t){0===t.position&&s.push(t)})),t.cardField=s}))},mounted:function(){var t=this.$refs.baseNavigation.$el.offsetHeight,e=window.innerHeight;this.imageheight=this.$refs.image.$el.offsetHeight;var a=this.$refs.over.offsetHeight,s=this.$refs.footer.$el.offsetHeight;this.top=t+a,this.bodyheight=e-t-a-s,this.imagetop=t+this.bodyheight+a-this.imageheight-20,this.search()},watch:{}},Kt=Rt,Vt=(a("a7ac"),Object(m["a"])(Kt,s,i,!1,null,"ca6651a2",null));e["default"]=Vt.exports},e291:function(t,e,a){"use strict";var s=a("7daf"),i=a.n(s);i.a}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d9fcdc2"],{"1e87":function(t,e,a){"use strict";var o=a("236f"),s=a.n(o);s.a},"236f":function(t,e,a){},3769:function(t,e,a){},"695d":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("basePage",{ref:"basePage",attrs:{numberCol:t.numberCol,footerText:t.footerText,btnMethod:t.btnMethod,selectItems:t.selectItems,cascadeItems:t.cascadeItems,btnmenus:t.btnmenus,title:t.$t("rawMaterialsOutOfWarehouse.title"),cardbuttons:t.cardbuttons,addcon:t.addcon,fixedQueryConditions:t.fixedQueryConditions,contitle:t.$t("rawMaterialsOutOfWarehouse.contitle")},on:{buttonsClick:t.buttonsClick,afterquery:t.afterquery,aftercheckall:t.aftercheck,aftercheck:t.aftercheck,cardbtnclick:t.cardbtnclick,btnmenusEvent:t.btnmenusEvent},scopedSlots:t._u([{key:"over",fn:function(){return[a("van-row",{staticStyle:{"text-align":"center","vertical-align":"middle","align-items":"center","justify-content":"center",display:"flex"}},[a("van-col",{attrs:{span:"4"}},[a("span",{staticClass:"smallfont"},[t._v(t._s(t.$t("rawMaterialStorage.store")))])]),a("van-col",{attrs:{span:"14"}},[a("menuselect",{staticStyle:{width:"100%"},attrs:{options:t.options,showFirstItem:""},model:{value:t.storeId,callback:function(e){t.storeId=e},expression:"storeId"}})],1),a("van-col",{attrs:{span:"6"}},[a("span",{staticClass:"smallfont",staticStyle:{float:"right","margin-right":"10px"}},[t._v("\n            "+t._s(t.$t("rawMaterialStorage.total")+":"+t.total)+"\n          ")])])],1)]},proxy:!0}])}),a("outboundRecommendation",{attrs:{storeId:t.storeId,ovdId:t.ovdId,data:t.data,type:t.recommendedType,show:t.materialSelectionShow},on:{closeOBR:t.closeOBR,outStore:t.outStore}})],1)},s=[],i=(a("5df3"),a("ac6a"),a("386d"),a("d399")),n=a("2241"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#f7f7f7"},attrs:{position:"right"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t.show?a("base-page",{ref:"basePage",attrs:{moduleid:"storage_0005",pcmoduleid:"storage_1001","right-icon":"",extIcon:"more","one-page":t.onePage,numberCol:t.numberCol,selectItems:t.selectItems,title:t.$t("outboundRecommendation.title"),buttons:t.buttons,btnMethod:t.btnMethod,footerText:t.footerText,checkallable:!1,fixedQueryConditions:t.fixedQueryConditions},on:{buttonsClick:t.buttonsClick,onClickLeft:t.close,beforequery:t.beforequery,afterquery:t.afterquery,extClick:t.extClick,aftercheck:t.aftercheck},scopedSlots:t._u([{key:"over",fn:function(){return[a("van-row",{staticClass:"overrow"},[a("van-col",{directives:[{name:"show",rawName:"v-show",value:t.matStackPathname,expression:"matStackPathname"}],attrs:{span:"20"}},[a("span",{staticClass:"smallfont title-left"},[t._v(t._s(t.$t("outboundRecommendation.stack")+":"+t.matStackPathname))])]),a("van-col",{attrs:{span:"4"}},[a("span",{staticClass:"smallfont title-right"},[t._v("\n            "+t._s(t.recommendSerialNo)+"\n          ")])])],1)]},proxy:!0}],null,!1,3596965794)}):t._e(),a("stackSelect",{ref:"stockSelect",attrs:{storeId:t.storeId,api:"/wms/wmsmat/stackRecommendationList",show:t.showStackSelect,chooseType:"click"},on:{closeSelect:t.closeSelect,beforesearch:t.beforesearch,aftersearch:t.aftersearch,onchecked:t.onchecked}}),a("stackSelect",{ref:"transfer",attrs:{show:t.showTransfer},on:{closeSelect:t.closeSelect,sure:t.sure,aftersearch:t.afterTransfersearch}}),a("stackSelect",{ref:"outOfStock",attrs:{api:"/wms/wmsOutboundUse/getrootstack",show:t.showOutOfStock,storeType:5},on:{closeSelect:t.closeSelect,sure:t.sureOutOfStock}})],1)],1)},r=[],d=a("02df"),u={name:"outboundRecommendation",props:{data:{type:Object,default:function(){return{}}},show:{type:Boolean,default:function(){return!1}},storeId:{type:String,default:function(){return""}},ovdId:{type:String,default:function(){return""}},type:{type:String,default:function(){return""}}},data:function(){return{onePage:!1,fixedQueryConditions:[],selectItems:{matPurchStatus:[{id:0,name:"正常"},{id:1,name:"取消"}]},numberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},stackid:"",recommendSerialNo:"",matStackPathname:"",showStackSelect:!1,showTransfer:!1,showOutOfStock:!1,btnMethod:{querymethod:"/wms/wmsmat/stackRecommendation"},buttons:[{key:"transfer",name:this.$t("outboundRecommendation.transfer")},{key:"outOfStock",name:this.$t("outboundRecommendation.outOfStock")}],footerText:[{key:"num",display:this.$t("outboundRecommendation.num"),value:0},{key:"weight",display:this.$t("outboundRecommendation.weight"),value:0}]}},computed:{},methods:{buttonsClick:function(t){if("transfer"===t){var e=this.$refs.basePage.getselected(),a=e.map((function(t){return t.matStackId})),o=this.$asyncajax("/wms/wmsstack/checkbyids","",a);if(1==o.data)return void this.$toast.fail(this.$t("oriStock.pdLock"));if(0===e.length)return this.$toast.fail(this.$t("base.noselect")),!1;this.$refs.basePage.total===e[0].matSerialno&&Math.abs(e[e.length-1].matSerialno-e[0].matSerialno)===e.length-1?this.showTransfer=!0:this.$toast.fail(this.$t("oriStock.notFromTop"))}else if("outOfStock"===t){var s=this.$refs.basePage.getselected(),i=s.map((function(t){return t.matStackId})),n=this.$asyncajax("/wms/wmsstack/checkbyids","",i);if(1==n.data)return void this.$toast.fail(this.$t("oriStock.ckstackPdLock"));if(0===s.length)return this.$toast.fail(this.$t("base.noselect")),!1;var c=s.filter((function(t){return"0"===t.recommendFlag||"1"===t.recommendFlag}));0===c.length?this.$toast.fail(this.$t("outboundRecommendation.notSatisfied")):this.showOutOfStock=!0}},close:function(t){this.$emit("closeOBR",t)},closeSelect:function(t){t&&(t.flag=!1),this.showStackSelect=!1,this.showTransfer=!1,this.showOutOfStock=!1},sure:function(t){var e=this;if(t.stackId===this.stackid)return this.$toast.fail(this.$t("base.noselect")),!1;this.$toast.loading({forbidClick:!0,duration:0});var a=this.$refs.basePage.getselected(),o=this,s=[];this.showTransfer=!1,a.forEach((function(a){var i=[{crMatid:a.id,ovdId:a.matOvdId,crFromStoreid:e.storeId,crFromStackid:e.stackid,crToStoreid:t.storeId,crToStackid:t.stackId,crDeviceid:""}],n=new Promise((function(t,e){o.$ajax("/wms/wmsmat/batchcollapse","",i,(function(e){t(!0)}))}));s.push(n)})),Promise.all(s).then((function(t){o.$refs.basePage.search(),e.showTransfer=!1}))},sureOutOfStock:function(t){var e=this,a=this.$asyncajax("/wms/wmsstack/checkbyids","",[this.stackid]);if(1!=a.data){if(t.stackId===this.stackid)return this.$toast.fail(this.$t("base.noselect")),!1;this.$toast.loading({forbidClick:!0,duration:0});var o,s=this.$refs.basePage.getselected(),i=s.filter((function(t){return"0"===t.recommendFlag})),n=s.filter((function(t){return"1"===t.recommendFlag}));o=i&&i.length>0?i[0]:n[0];var c=this,r={obuObdId:this.data.id,obuOboCode:this.data.obdOboCode,obuMatId:o.id,obuPlatform:"PAD",obuMatQty:o.matBasicQuantity,obuStatu:"2",obuToStoreid:t.storeId,obuToStockid:t.stackId,obuOutStockid:this.stackid,obuDeviceid:""};this.$ajax("/wms/wmsOutboundUse/insertOutStore","",r,(function(){e.$toast.success(c.$t("outboundRecommendation.osuccess")),c.$refs.basePage.search(),e.showOutOfStock=!1,e.$emit("outStore")}))}else this.$toast.fail(this.$t("oriStock.ckstackPdLock"))},onchecked:function(t){if(this.stackid===t.id)return!1;this.stackid=t.id,this.showStackSelect=!1,this.$refs.basePage.search()},beforesearch:function(t){var e=[{storeId:this.storeId,ovdId:this.ovdId}];t.value.list=e,t.value.type=this.type},aftersearch:function(t){var e=this;t.records.forEach((function(t){t.wmsStackList.forEach((function(t){t.matFitSumNum>0&&(t.headtitle=e.$t("outboundRecommendation.inStock")+"("+t.matFitSumNum+")",t.headtitleFontColor="rgb(255,255,255)",t.headtitleColor="rgb(97,64,141)"),t.id===e.stackid&&(t.color="rgb(192, 179, 209)")}))}))},afterTransfersearch:function(t){var e=this,a=t.records;a.forEach((function(t){t.wmsStackList.forEach((function(t){t.id===e.stackid&&(t.color="rgb(192, 179, 209)",t.isCurrentItem=!0)}))}))},extClick:function(){this.showStackSelect=!0},beforequery:function(t,e){var a=[{storeId:this.storeId,ovdId:this.ovdId}];e.value.list=a,e.value.type=this.type,e.value.stackId=this.stackid},afterquery:function(t){this.stackid=t.extParams.stackId,t.records.forEach((function(t){"0"===t.recommendFlag?t["color"]="rgb(208,198,221)":"2"===t.recommendFlag&&(t["color"]="#DCDCDC")})),this.matStackPathname=t.extParams.stackPathName?t.extParams.stackPathName:"",this.recommendSerialNo=t.extParams.recommendSerialNo},aftercheck:function(){this.footerText[0].value=this.$refs.basePage.getselected().length;var t=0,e="";this.$refs.basePage.getselected().forEach((function(a){t+=a.matAuxQuantity,e=a.matAuxUnit})),this.footerText[1].value=d["a"].numberFormat("3",t)+e},initSelect:function(){this.selectItems.matPublicStatus=d["a"].getDict("TRB_PUBLIC_STATUS"),this.selectItems.matSheetType=d["a"].getDict("NEST_MAT_TYPE"),this.selectItems.matStorageStatus=d["a"].getDict("STORAGE_STATUS"),this.selectItems.matInvStatus=d["a"].getDict("MAT_STATUS")}},created:function(){var t=localStorage.getItem("chooseSheet");t||(t="ONLYUSEFUL"),this.onePage="ONLYUSEFUL"===t,this.fixedQueryConditions=[{key:"showType",exp:"=",value:t}],this.initSelect()},mounted:function(){},watch:{show:{handler:function(t){this.stackid=""},immediate:!0}}},l=u,h=(a("1e87"),a("2877")),m=Object(h["a"])(l,c,r,!1,null,"f20dd74c",null),f=m.exports,b={name:"storage0001",components:{outboundRecommendation:f},data:function(){return{numberCol:{0:["matPrice"],2:["ovdThickness"],3:["odbMatQty"]},data:{},ovdId:"",materialSelectionShow:!1,recommendedType:"0",btnmenus:[{key:"minimumFlip",name:this.$t("rawMaterialsOutOfWarehouse.minimumFlip"),type:"radio",default:!0},{key:"firstInFirstOut",name:this.$t("rawMaterialsOutOfWarehouse.firstInFirstOut"),type:"radio"}],storeId:"",options:[],total:0,footerText:[{key:"num",display:this.$t("rawMaterialsOutOfWarehouse.num"),value:0}],btnMethod:{querymethod:"/wms/wmsoutboundorderdetail/autopage"},selectItems:{},cascadeItems:{},cardbuttons:[{key:"materialSelection",color:"rgb(251, 205, 5)",name:this.$t("rawMaterialsOutOfWarehouse.materialSelection")}],addcon:[],fixedQueryConditions:[{key:"odbMatSheettype",exp:"=",value:0}]}},methods:{outStore:function(){this.materialSelectionShow=!1,this.$refs.basePage.search()},closeOBR:function(t){this.materialSelectionShow=!1,t.flag=!1},cascadehandler:function(t){var e=this,a=[];return t.forEach((function(t){var o={checkable:t.check,id:t.matCatSyspath,code:t.matCatSyscode,name:t.matCatName};o.children=e.cascadehandler(t.children),a.push(o)})),a},aftercheck:function(){!0===this.$refs.basePage.checkAll?this.footerText[0].value=this.$refs.basePage.total:this.footerText[0].value=this.$refs.basePage.getselected().length},afterquery:function(t){var e=this;this.total=t.total,this.$nextTick((function(){e.aftercheck()}))},releaseAll:function(){var t=this.$refs.basePage.getsearchJson(),e=this;this.$ajax("/wms/wmsmat/noautopageidlist","",t,(function(t){var a=t.data.data;i["a"].loading({forbidClick:!0,duration:0});var o=[];a.forEach((function(t){var a=new Promise((function(a,o){e.$ajax("/wms/wmsmat/matpublic","",[{id:t}],(function(t){a(!0)}))}));o.push(a)})),Promise.all(o).then((function(t){i["a"].success(e.$t("rawMaterialArrival.releasetoast")),e.$refs.basePage.search()}))}))},buttonsClick:function(t){},cardbtnclick:function(t,e){var a=this;if("materialSelection"===t){if(2==e.odbStatu)return void i["a"].fail("已出库的不可以选料");var o={current:1,rows:1,value:{},exp:{},order:{}},s=[{storeId:this.storeId,ovdId:e.odbMatOvdid}];o.value.list=s,o.value.type=this.recommendedType,this.$ajax("/wms/wmsmat/stackRecommendation","",o,(function(t){t.data.data.extParams.errorMsg?n["a"].alert({message:t.data.data.extParams.errorMsg,overlay:!0}):(a.ovdId=e.odbMatOvdid,a.data=e,a.materialSelectionShow=!0)}))}},btnmenusEvent:function(t,e){"firstInFirstOut"===e.radio?this.recommendedType="1":this.recommendedType="0"},initselect:function(){var t=this;this.$ajax("/wms/wmsstore/list","",{storeType:1},(function(e){var a=[],o=[];e.data.data.forEach((function(t){var e={text:t.storeName,value:t.id},s={id:t.id,name:t.storeName};a.push(e),o.push(s)})),t.options=a,t.selectItems.obuOutStoreid=o})),this.$ajax("/wms/wmsstack/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={name:t.stackName,id:t.id};a.push(e)})),t.selectItems.obuOutStockid=a})),this.$ajax("/auth/dep/listdep","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.depName};a.push(e)})),t.selectItems.oboDepId=a})),this.$ajax("/wms/wmsstack/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.stackName};a.push(e)})),t.selectItems.matStackId=a})),this.$ajax("/common/comteam/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.teamName};a.push(e)})),t.selectItems.oboTeamId=a})),this.$ajax("/wms/wmsoutboundorderdetail/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.odbOboOvacode,name:t.odbOboOvacode};a.push(e)})),t.selectItems.oboOvacode=a})),this.$ajax("/wms/wmsoutboundorder/listCode","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.oboCode,name:t.oboCode};a.push(e)})),t.selectItems.oboCode=a})),this.selectItems.oboBusscode=d["a"].getDict("ODB_BUSS_CODE"),this.selectItems.odbMatSheettype=d["a"].getDict("SHEET_TYPE"),this.selectItems.odbStatu=d["a"].getDict("ODB_STATU"),this.selectItems.obuPlatform=d["a"].getDict("OBU_PLATFORM")}},activated:function(){},created:function(){this.initselect()}},k=b,S=(a("f967"),Object(h["a"])(k,o,s,!1,null,"072288bc",null));e["default"]=S.exports},f967:function(t,e,a){"use strict";var o=a("3769"),s=a.n(o);s.a}}]);
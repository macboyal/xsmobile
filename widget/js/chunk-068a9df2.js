(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-068a9df2"],{2305:function(t,e,a){},"277a":function(t,e,a){},"4da2":function(t,e,a){},"5e9a":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"stackBlock"}},[a("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[a("van-list",{ref:"list",attrs:{finished:t.finished,"finished-text":t.$t("base.nomore")},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.stackList,(function(e){return a("van-row",{key:e.pathCode,staticClass:"stackBlockBody"},[a("van-sidebar",[a("van-sidebar-item",{attrs:{title:e.pathName}})],1),a("van-row",[a("van-grid",{staticClass:"iconCenter",attrs:{clickable:"","column-num":4,border:!1}},t._l(e.wmsStackList,(function(s){return a("van-grid-item",{key:s.id,attrs:{text:s.stackName}},[a("xsstack",{attrs:{stackEntity:s,fixedField:t.fixedField},nativeOn:{click:function(a){return t.openDetail(e.pathName,s)}}})],1)})),1)],1)],1)})),1)],1)],1)},n=[],o=(a("c5f6"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"stack"},[s("div",{staticClass:"stackBody",style:{"background-image":t.backgroundUrl,"background-position":"center","background-position-y":"0.75rem","background-size":"1.5rem","background-repeat":"no-repeat"},attrs:{id:"stack"}},[s("span",{staticClass:"mat-instock-title",style:{background:t.stackEntity.matFitSumNum>0?"#61408c":"#fff"}},[t._v(t._s(t.matInStockTitle))]),1==t.stackEntity.stackPdStatus?s("van-image",{staticClass:"lock",attrs:{src:a("4f99")}}):t._e(),s("div",{staticClass:"stack-message"},t._l(t.fixedField,(function(e){return s("span",{key:e},[t._v(t._s(t.stackEntity[e]))])})),0),s("div",{staticClass:"progress-location"},[s("van-progress",{attrs:{percentage:t.matPercentage,color:"#61408c","stroke-width":"12","show-pivot":!0,"pivot-text":t.percentageText}})],1)],1),s("span",{staticClass:"mat-instock-title mat-instock-name "},[t._v(t._s(t.stackEntity.stackName))])])}),i=[],r={name:"stack",components:{},props:{stackEntity:{type:Object},fixedField:{type:Array},maxHeight:{type:Number,default:function(){return 2e3}}},data:function(){return{messageOne:"",messageTwo:"",backgroundUrl:""}},computed:{matInStockTitle:function(){var t=this.stackEntity.matFitSumNum>0?this.$t("oriStock.matInStock")+"("+this.stackEntity.matFitSumNum+")":"";return t},oriPercentage:function(){return this.stackEntity.matSumThickness?this.stackEntity.matSumThickness/this.maxHeight*100:0},matPercentage:function(){var t=this.oriPercentage;return t>100&&(t=100),t?t.toFixed(1):0},percentageText:function(){var t=this.oriPercentage;return t?"".concat(t.toFixed(1),"%"):"0%"}},watch:{},methods:{calculatePer:function(){}},created:function(){},mounted:function(){var t=a("2f30");"SHEET"===this.stackEntity.stackmodelMaterialclass?(t=a("2f30"),this.backgroundUrl="url("+t+")"):"PROFILE"===this.stackEntity.stackmodelMaterialclass&&(t=a("d955")),this.backgroundUrl="url("+t+")"},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},c=r,u=(a("9107"),a("2877")),l=Object(u["a"])(c,o,i,!1,null,"41c04dbf",null),d=l.exports,h={name:"stackBlock",components:{xsstack:d},data:function(){return{refreshing:!1,loading:!1,finished:!1}},props:{storeId:{type:String,default:function(){return""}},total:{type:Number,default:function(){return 0}},size:{type:Number,default:function(){return 0}},current:{type:Number,default:function(){return 0}},pages:{type:Number,default:function(){return 0}},fixedField:{type:Array,default:function(){return[]}},stackList:{type:Array,default:function(){return[]}}},computed:{},watch:{},methods:{onRefresh:function(){this.finished=!1,this.loading=!0,this.onLoad(0)},onLoad:function(t){var e=this,a=0;a=0===t?t:this.current+1,this.$emit("search",a,(function(t,a){e.refreshing&&(e.refreshing=!1),e.loading=!1}))},openDetail:function(t,e){this.$emit("openDetail",t,e)}},created:function(){},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},m=h,f=(a("eb88"),Object(u["a"])(m,s,n,!1,null,"baf4043e",null));e["a"]=f.exports},7046:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("baseNavigation",{attrs:{rightIcon:t.rightIcon,title:t.$t("remStock.title"),id:"remSockNav"},on:{rightClick:t.rightClick}}),a("div",{staticClass:"storebox",attrs:{id:"storebox"}},[a("van-dropdown-menu",{staticClass:"van-dropdown-menu-xs",attrs:{"active-color":"#61408d"}},[a("van-dropdown-item",{attrs:{options:t.storeOption},on:{change:t.changeStore,open:t.openStore},model:{value:t.storeId,callback:function(e){t.storeId=e},expression:"storeId"}})],1),a("van-search",{staticClass:"van-search-xs",attrs:{placeholder:t.$t("base.searchplaceholder")},on:{blur:t.onBlur},model:{value:t.stackName,callback:function(e){t.stackName=e},expression:"stackName"}})],1),a("div",{staticClass:"box",attrs:{id:"box"}},[a("li",[a("label",[t._v(t._s(t.$t("remStock.stackTitle")))]),a("span",[t._v(t._s(t.matStackQty)+"/"+t._s(t.total))])]),a("li",[a("label",[t._v(t._s(t.$t("remStock.matNum")))]),a("span",[t._v(t._s(t.tool.numberFormat("3",t.matSumQty)))])]),a("li",[a("label",[t._v(t._s(t.$t("remStock.matWeight")))]),a("span",{staticStyle:{overflow:"visible"}},[t._v(t._s(t.tool.numberFormat("4",t.matSumWeight))+t._s(t.$t("remStock.KG")))])])]),a("div",{staticClass:"stackBlockBody",style:{height:t.height+"PX"}},[a("stackBlock",{ref:"stackBlock",attrs:{fixedField:t.fixedField,stackList:t.stackList,total:t.total,size:t.size,current:t.current,pages:t.pages},on:{search:t.search,openDetail:t.openDetail}})],1),a("baseQueryConditions",{ref:"baseQueryConditions",attrs:{show:t.showQueryConditions,addcon:t.addcon,xsView:"view",selectItems:t.selectItems,title:t.contitle,tableCondition:t.tableCondition,cascadeItems:t.cascadeItems},on:{close:t.closeQueryConditions,search:t.search}}),a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#F7F7F7"},attrs:{position:"right"},model:{value:t.popupshow,callback:function(e){t.popupshow=e},expression:"popupshow"}},[t.popupshow?a("remStockDetail",{attrs:{numberCol:t.numberCol,fixedQueryConditions:t.fixedQueryConditions,pathName:t.pathName,storeId:t.storeId,options:t.storeOption,selectItems:t.selectItems},on:{closeStockDetail:t.closeStockDetail}}):t._e()],1)],1)},n=[],o=(a("456d"),a("386d"),a("ac6a"),a("5e9a")),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[a("basePage",{ref:"basePage",attrs:{rightIcon:"",detailtitle:"余料库存详情",numberCol:t.numberCol,title:t.$t("oriStock.stockDetail"),btnMethod:t.btnMethod,fixedQueryConditions:t.fixedQueryConditions,footerText:t.footerText,btnmenus:t.btnmenus,buttons:t.buttons,selectItems:t.selectItems},on:{onClickLeft:t.onClickLeft,afterquery:t.afterquery,aftercheck:t.aftercheck,aftercheckall:t.aftercheckall,btnmenusEvent:t.btnmenusEvent,buttonsClick:t.buttonsClick,beforequery:t.beforequery},scopedSlots:t._u([{key:"over",fn:function(){return[a("div",{staticClass:"title-stack"},[a("div",{staticClass:"title-stack-name"},[t._v(t._s(t.$t("remStock.stackTitle"))+t._s(t.pathName)+">")]),a("div",{staticClass:"title-stack-count"},[a("span",[t._v(t._s(t.$t("remStock.matNum")))]),a("span",[t._v(t._s(t.matFitCount)+"/"+t._s(t.total))])])])]},proxy:!0}])}),a("stackSelect",{ref:"stockSelect",attrs:{show:t.showStackSelect,options:t.options},on:{closeSelect:t.closeSelect,sure:t.sure,aftersearch:t.aftersearch}})],1)},r=[],c=(a("7f7f"),a("55dd"),a("7514"),a("02df")),u={name:"remStockDetail",components:{},props:{numberCol:{type:Object},footerText:{type:Array,default:function(){return[{key:"num",display:this.$t("remStock.matNumName"),value:0},{key:"weight",display:this.$t("remStock.matWeightName"),value:"0KG"}]}},fixedQueryConditions:{type:Array,default:function(){return[]}},pathName:{type:String,default:function(){return""}},storeId:{type:String,default:function(){return""}},options:{type:Array,default:function(){return[]}},selectItems:{type:Object,default:function(){return{}}}},data:function(){return{btnMethod:{querymethod:"/wms/wmsmat/getFitRemMatInStack"},total:0,matFitCount:0,buttons:[],showAllData:!1,showStackSelect:!1,storeName:"",btnmenus:[{key:"showAll",name:this.$t("remStock.showAll"),icon:"more-o"},{key:"transfer",name:this.$t("remStock.transfer"),icon:"exchange"}]}},computed:{},watch:{},methods:{beforequery:function(t,e){this.showAllData?e.value.matFit=0:e.value.matFit=1},aftersearch:function(t){var e=t.records,a=this.fixedQueryConditions.find((function(t){return"matStackId"===t["key"]&&t["value"]})).value;e.forEach((function(t){t.wmsStackList.forEach((function(t){t.id===a&&(t.color="rgb(192, 179, 209)",t.isCurrentItem=!0)}))}))},btnmenusEvent:function(t){switch(t){case"showAll":this.showAllData=!this.showAllData,this.$refs.basePage.search(),this.showAllData?this.btnmenus=[{key:"showAll",name:this.$t("remStock.showPart"),icon:"more-o"},{key:"transfer",name:this.$t("remStock.transfer"),icon:"exchange"}]:this.btnmenus=[{key:"showAll",name:this.$t("remStock.showAll"),icon:"more-o"},{key:"transfer",name:this.$t("remStock.transfer"),icon:"exchange"}];break;case"transfer":this.buttons.some((function(t){return"transfer"===t.key}))||(this.buttons.push({key:"transfer",name:this.$t("remStock.transfer")}),this.showAllData=!0,this.$refs.basePage.search());break}},buttonsClick:function(t){if("transfer"===t){var e=this.$refs.basePage.ischeckall();if(e)this.showStackSelect=!0;else{var a=this.$refs.basePage.getselected();if(a&&a.length>0)if(a=a.sort((function(t,e){return e.matSerialno-t.matSerialno})),a[0].matSerialno<this.$refs.basePage.total)this.$toast.fail(this.$t("remStock.notFromTop"));else{for(var s=!1,n=0;n<a.length;n++)if(n<a.length-1&&a[n].matSerialno-a[n+1].matSerialno!==1){s=!0;break}s?this.$toast.fail(this.$t("remStock.discontinuous")):this.showStackSelect=!0}else this.$toast.fail(this.$t("base.noselect"))}}},sure:function(t){var e=this.$refs.basePage.getselected();e&&e.length>0?this.collapse(t):this.$toast.fail(this.$t("base.noselect")),this.showStackSelect=!1},collapse:function(t){var e=this,a=this,s=this.$refs.basePage.getselected();this.$toast.loading({forbidClick:!0,duration:0});var n=[];if(this.$refs.basePage.checkAll){var o=s[0].matStoreId,i=s[0].stackId,r=this.$asyncajax("/wms/wmsmat/getallidsinstack","",{id:i}).data;n=r.map((function(e){return{ovdId:e.ovdId,crMatid:e.matId,crFromStoreid:o,crFromStackid:i,crFromSerialno:e.serialno,crToStoreid:t.storeId,crToStackid:t.stackId}}))}else s.forEach((function(e){var a={ovdId:e.matOvdId,crMatid:e.id,crFromStoreid:e.matStoreId,crFromStackid:e.stackId,crFromSerialno:e.matSerialno,crToStoreid:t.storeId,crToStackid:t.stackId};n.push(a)}));this.$ajax("/wms/wmsmat/transwarehouse","",n,(function(t){e.$toast.success(a.$t("remStock.transferSuccess")),a.$refs.basePage.search(),a.$refs.basePage.checkAll=!1,e.aftercheckall()}))},closeSelect:function(t){t&&(t.flag=!1),this.showStackSelect=!1},onClickLeft:function(t){this.$emit("closeStockDetail",t)},afterquery:function(t){var e=this;this.total=t.total;var a=t.extRecords;a.length>=1?this.matFitCount=a[0].matSumQty:this.matFitCount=0;var s=t.records;s.forEach((function(t){t.color=0===t.matFit?"#dcdcdc":"",t.stackId=t.matStackId,t.matStackId=e.selectItems.matStackId.find((function(e){return e.id===t.matStackId})).name;var a=c["a"].numberFormat(4,t.matLength?t.matLength:0),s=c["a"].numberFormat(4,t.matWidth?t.matWidth:0);t["lengthAndWidth"]=a+"*"+s}))},aftercheck:function(){var t=this.$refs.basePage.getselected();this.footerText[0].value=t.length;var e=0;Object.keys(t).forEach((function(a){e+=parseFloat(t[a].matAuxQuantity)})),this.footerText[1].value=c["a"].numberFormat(4,e)+this.$t("remStock.KG")},aftercheckall:function(){!0===this.$refs.basePage.checkAll&&this.$refs.basePage.extRecords?(this.footerText[0].value=this.$refs.basePage.total,this.footerText[1].value=c["a"].numberFormat(4,this.$refs.basePage.extRecords.matSumWeight)+this.$t("remStock.KG")):(this.footerText[0].value=0,this.footerText[1].value=0+this.$t("remStock.KG"))}},created:function(){},mounted:function(){this.total=this.$refs.basePage.total;var t=this.$refs.basePage.datas;t>1&&(this.matFitCount=t[0].matFitCount)},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},l=u,d=(a("adee"),a("2877")),h=Object(d["a"])(l,i,r,!1,null,"49463a73",null),m=h.exports,f={components:{stackBlock:o["a"],remStockDetail:m},name:"remStock",props:{btnMethod:{type:Object,default:function(){return{}}},addcon:{type:Array,default:function(){return[]}},tableCondition:{type:Array,default:function(){return[]}},cascadeItems:{type:Object,default:function(){return{}}}},data:function(){return{numberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},tool:c["a"],accuracy:JSON.parse(localStorage.getItem("accuracy")),height:0,storeId:"",stackName:"",matStackQty:0,matSumQty:0,matSumWeight:0,storeOption:[],stackList:[],total:0,size:1,current:0,pages:0,searchJson:{},showQueryConditions:!1,fixedField:["matSumQty","matSumThickness"],btnmenus:[{key:"showAll",name:this.$t("remStock.showAll"),icon:"more-o"},{key:"transfer",name:this.$t("remStock.transfer"),icon:"exchange"}],contitle:this.$t("base.conditions"),rightIcon:"search",popupshow:!1,fixedQueryConditions:[],pathName:"",selectItems:{}}},computed:{},watch:{},methods:{init:function(){var t=this,e=this.$asyncajax("/wms/wmsstore/list","",{storeType:8,storeClassify:"ORI"}).data;this.storeOption.splice(0,this.storeOption.length),e.forEach((function(e){t.storeOption.push({text:e.storeName,value:e.id})})),e.length>0&&(this.storeId=e[0].id),this.selectItems.wmsPicStatus=[{id:"0",name:"未检查",icon:"ios-image",color:"#666"},{id:"1",name:"有图"},{id:"2",name:"缺图"}],this.selectItems.wmsDataSource=[{id:"0",name:"套料提取"},{id:"1",name:"Excel导入"},{id:"2",name:"新增"},{id:"3",name:"盘盈"}],this.selectItems.matInvStatus=c["a"].getDict("MAT_STATUS"),this.selectItems.matSheetType=c["a"].getDict("SHEET_TYPE"),this.selectItems.matStorageStatus=c["a"].getDict("STORAGE_STATUS"),this.$ajax("/wms/wmsstore/list","",{storeType:"8"},(function(e){var a=[],s=e.data.data;s.forEach((function(t){a.push({id:t.id,name:t.storeName})})),t.selectItems.matStoreId=a})),this.$ajax("/wms/wmsstore/ylstacklist","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={name:t.stackName,id:t.id};a.push(e)})),t.selectItems.matStackId=a})),this.$ajax("/auth/user/listuser","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.userRealname};a.push(e)})),t.selectItems.matInstoreUserid=a}))},openDetail:function(t,e){this.fixedQueryConditions=[],this.popupshow=!0;var a=this.searchJson.value,s=this.searchJson.exp;for(var n in a){var o={key:n,exp:s[n],value:a[n]};this.fixedQueryConditions.push(o)}var i={key:"matStackId",exp:"=",value:e.id};this.fixedQueryConditions.push(i),this.fixedQueryConditions.push({key:"matFit",exp:"=",value:0}),this.pathName=t+" "+e.stackName},closeStockDetail:function(t){this.popupshow=!1,t.flag=!1,this.search()},rightClick:function(){this.showQueryConditions=!0},closeQueryConditions:function(){this.showQueryConditions=!1},onBlur:function(){this.search()},openStore:function(){},changeStore:function(){var t=this.$toast.loading({message:"加载中...",overlay:!0,forbidClick:!0}),e=this,a=function(){e.$nextTick((function(){t.clear()}))};this.search(1,a)},getstacksumbycon:function(){var t=this;this.$ajax("/wms/wmsstack/getstacksumbycon","",this.searchJson,(function(e){var a=e.data.data;a&&(t.matSumQty=a.matSumQty,t.matSumWeight=(a.matSumWeight/1e3).toFixed(3),t.matStackQty=a.matStackQty)}))},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0;if(""!==this.storeId){var s=this.$refs.baseQueryConditions.cons,n=this.$refs.baseQueryConditions.conVals,o={};Object.keys(n).forEach((function(t){s.forEach((function(e){e.conkey===t&&(o[t]=e.conexp)}))})),n["stackName"]=this.stackName,o["stackName"]="like",n["storeId"]=this.storeId,o["storeId"]="=",this.searchJson={current:e,rows:24,value:n,exp:o,order:{}},1===e&&this.getstacksumbycon(),this.$ajax("/wms/wmsstack/getrootstack","",this.searchJson,(function(e){var s=e.data.data;if(1===s.current)t.stackList=[],t.stackList=s.records;else{var n=s.records;for(var o in n){var i=n[o].pathCode,r=!1;for(var c in t.stackList)if(i===t.stackList[c].pathCode){t.stackList[c].wmsStackList=t.stackList[c].wmsStackList.concat(n[o].wmsStackList),r=!0;break}r||(t.stackList=t.stackList.concat(n[o]))}}t.current=s.current,t.size=s.size,t.pages=s.pages,t.total=s.total,s.current>=s.pages?t.$refs.stackBlock.finished=!0:t.$refs.stackBlock.finished&&(t.$refs.stackBlock.finished=!1),t.$refs.stackBlock.$refs.list.check(),"undefined"!=typeof a&&a(s.current,s.pages)}))}else this.$toast(this.$t("remStock.choiceStore"))}},created:function(){this.init()},mounted:function(){this.height=window.innerHeight-document.getElementById("remSockNav").offsetHeight-5-document.getElementById("storebox").offsetHeight-document.getElementById("box").offsetHeight}},k=f,p=(a("dccb"),Object(d["a"])(k,s,n,!1,null,"d57559fc",null));e["default"]=p.exports},9107:function(t,e,a){"use strict";var s=a("277a"),n=a.n(s);n.a},ab34:function(t,e,a){},adee:function(t,e,a){"use strict";var s=a("ab34"),n=a.n(s);n.a},dccb:function(t,e,a){"use strict";var s=a("4da2"),n=a.n(s);n.a},eb88:function(t,e,a){"use strict";var s=a("2305"),n=a.n(s);n.a}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f0290f2"],{"262a":function(e,t,a){},9573:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("XsStackBlock",{ref:"XsStackBlock",attrs:{storeClassify:"INPROCESS",stackKey:"wlpStackId",detailQuerymethod:e.detailQuerymethod,storeType:e.storeType,title:e.title,api:e.api,btnmenus:e.btnmenus,bottomButtons:e.bottomButtons,detailParamKey:e.detailParamKey,tableCondition:e.tableCondition,selectItems:e.selectItems,customFixedField3:!0,showPivot:!1,footerText:e.footerText,fixedField:e.fixedField},on:{openDetail:e.openDetail,beforesearch:e.beforesearch,beforeDetailQuery:e.beforeDetailQuery,aftersearch:e.aftersearch,btnmenusEvent:e.btnmenusEvent,bottomButtonsClick:e.bottomButtonsClick,beforesearchSelect:e.beforesearchSelect},scopedSlots:e._u([{key:"totalInfo",fn:function(){return[a("van-row",{attrs:{type:"flex"}},[a("van-col",{staticStyle:{"white-space":"nowrap"},attrs:{span:"8"}},[a("label",[e._v(e._s(e.$t("oriStock.stackTitle")))]),a("span",[e._v(e._s(e.WmsStackMatSum.matStackQty+"/"+e.total))])]),a("van-col",{staticStyle:{"white-space":"nowrap"},attrs:{span:"8"}},[a("label",[e._v(e._s(e.$t("oriStock.matNum")))]),a("span",[e._v(e._s(e.WmsStackMatSum.matSumQty))])]),a("van-col",{staticStyle:{"white-space":"nowrap"},attrs:{span:"8"}},[a("label",[e._v(e._s(e.$t("oriStock.matWeight")))]),a("span",[e._v(e._s(e.tool.numberFormat("3",e.WmsStackMatSum.matSumWeight)+e.$t("oriStock.KG")))])])],1)]},proxy:!0}])}),a("update",{attrs:{title:e.$t("WIPLinesideLibrary.update"),show:e.showUpdate,fields:e.updateFields,"select-items":e.updateSelectItems,datas:e.updateDatas},on:{close:e.closeUpdate,afterSave:e.afterSave}}),a("stackSelect",{ref:"transfer",attrs:{storeClassify:"INPROCESS",api:e.api,show:e.showTransfer,showPivot:!1,storeType:e.storeType},on:{closeSelect:e.closeSelect,sure:e.sure,beforesearch:e.beforesearch,aftersearch:e.afterTransfersearch}})],1)},i=[],r=(a("7514"),a("456d"),a("386d"),a("ac6a"),a("02df")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#F7F7F7"},attrs:{position:"right"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("blankPage",{attrs:{title:e.title},on:{onClickLeft:e.close},scopedSlots:e._u([{key:"body",fn:function(){return[a("div",{staticStyle:{height:"100%"}},[a("div",{staticStyle:{height:"100%",overflow:"auto"}},[a("van-cell-group",e._l(e.fields,(function(t){return a("div",{key:t.key},["select"==t.type?a("singleSelect",{attrs:{title:t.display,selectItems:e.selectItems[t.key],placeholder:e.$t("base.selectplaceholder")+t.display,inputAlign:"left"},model:{value:e.values[t.key],callback:function(a){e.$set(e.values,t.key,a)},expression:"values[item.key]"}}):e._e(),"date"==t.type?a("singleDatetimePicker",{attrs:{title:t.display,conexp:t.exp,default:e.datedefault,placeholder:e.$t("base.selectplaceholder")+t.display,inputAlign:"left"},model:{value:e.values[t.key],callback:function(a){e.$set(e.values,t.key,a)},expression:"values[item.key]"}}):e._e(),"datetime"==t.type?a("singleDatetimePicker",{attrs:{title:t.display,conexp:t.exp,default:e.datedefault,type:"datetime",placeholder:e.$t("base.selectplaceholder")+t.display,inputAlign:"left"},model:{value:e.values[t.key],callback:function(a){e.$set(e.values,t.key,a)},expression:"values[item.key]"}}):e._e(),"cascade"==t.type?a("cascade",{attrs:{title:t.display,cascadeItems:e.cascadeItems[t.key],placeholder:e.$t("base.selectplaceholder")+t.display,inputAlign:"left"},model:{value:e.values[t.key],callback:function(a){e.$set(e.values,t.key,a)},expression:"values[item.key]"}}):e._e(),"input"==t.type?a("van-field",{attrs:{label:t.display,placeholder:e.$t("base.placeholder")+t.display},model:{value:e.values[t.key],callback:function(a){e.$set(e.values,t.key,a)},expression:"values[item.key]"}}):e._e(),"number"==t.type?a("van-field",{attrs:{type:"number",label:t.display,placeholder:e.$t("base.placeholder")+t.display},model:{value:e.values[t.key],callback:function(a){e.$set(e.values,t.key,a)},expression:"values[item.key]"}}):e._e()],1)})),0)],1)])]},proxy:!0},{key:"foot",fn:function(){return[a("van-button",{staticClass:"saveBtn",attrs:{type:"primary",block:"",color:"rgb(251, 205, 5)"},on:{click:e.save}},[e._v("\n          "+e._s(e.$t("modalFooter.ok"))+"\n        ")])]},proxy:!0}])})],1)],1)},n=[],l=(a("5df3"),a("4f7f"),a("7f7f"),a("75fc")),c={name:"update",props:{selectItems:{type:Object,default:function(){return{}}},cascadeItems:{type:Object,default:function(){return{}}},fields:{type:Array,default:function(){return[]}},datas:{type:Array,default:function(){return[]}},show:{type:Boolean,default:function(){return!1}},title:{type:String}},data:function(){return{datedefault:{value:this.$t("base.multiple"),display:this.$t("base.multiple")},localSelectItems:{},moduleid:"",pcmoduleid:"",values:{}}},methods:{close:function(e){e.flag=!1,this.$emit("close")},save:function(){var e=this;this.$toast.loading({forbidClick:!0,duration:0});var t=this.datas.map((function(e){return e.wlpReportId})),a=[];t.forEach((function(t){var s={};Object.keys(e.values).map((function(t){e.values[t]!=e.$t("base.multiple")&&e.values[t]&&""!=e.values[t].trim&&("partsReportUserId"===t&&(s["partsReportUserName"]=e.selectItems["partsReportUserId"].find((function(a){return a.id===e.values[t]})).name),s[t]=e.values[t])})),s["id"]=t,a.push(s)})),this.$ajax("/nest/nestpartsreport/batchupdate","",a,(function(t){return e.$toast.fail(e.$t("WIPLinesideLibrary.updateSuccess")),e.$emit("afterSave"),!1}))}},watch:{datas:{handler:function(e){var t=this;this.values={},this.localSelectItems=this.selectItems,e.length>1?(Object.keys(this.localSelectItems).forEach((function(e){t.localSelectItems[e]&&t.localSelectItems[e].length>0&&t.localSelectItems[e][0].id!==t.$t("base.multiple")&&t.localSelectItems[e].unshift({id:t.$t("base.multiple"),name:t.$t("base.multiple")})})),this.fields.forEach((function(a){var s=a.key,i=e.map((function(e){return e[s]}));i=Object(l["a"])(new Set(i)),i.length>1?t.$set(t.values,s,t.$t("base.multiple")):1===i.length?t.$set(t.values,s,i[0]):t.$set(t.values,s,"")}))):1===e.length&&(Object.keys(this.localSelectItems).forEach((function(e){t.localSelectItems[e]&&t.localSelectItems[e].length>0&&t.localSelectItems[e][0].id===t.$t("base.multiple")&&t.localSelectItems[e].splice(0,1)})),this.fields.forEach((function(a){t.$set(t.values,a.key,e[0][a.key])})))},immediate:!0}},created:function(){this.localSelectItems=this.selectItems}},u=c,p=(a("b169"),a("2877")),d=Object(p["a"])(u,o,n,!1,null,"666dbfd4",null),f=d.exports,h=a("2241"),m={name:"WIPLinesideLibrary",props:{tableCondition:{type:Array,default:function(){return[]}}},components:{update:f},data:function(){return{tool:r["a"],fixedField:["matSumQty","matSumWeight"],footerText:[{key:"wlpQuatity",display:this.$t("pretreatment.matNumName"),fix:0,value:0},{key:"totalWeight",display:this.$t("pretreatment.matWeightName"),fix:r["a"].getAccuracy("4"),value:"0",unit:this.$t("oriStock.KG")}],showTransfer:!1,detailQuerymethod:"/nest/nestwiplineparts/getfitpartsinstack",WmsStackMatSum:{matStackQty:0,matSumCount:0,matSumQty:0,matSumThickness:0,matSumWeight:0},total:0,updateDatas:[],updateSelectItems:{},updateFields:[{display:this.$t("WIPLinesideLibrary.partsReportCuttingType"),key:"partsReportCuttingType",type:"input"},{display:this.$t("WIPLinesideLibrary.partsReportWorkshop"),key:"partsReportWorkshop",type:"select"},{display:this.$t("WIPLinesideLibrary.partsReportTeamId"),key:"partsReportTeamId",type:"select"},{display:this.$t("WIPLinesideLibrary.partsReportEquipment"),key:"partsReportEquipment",type:"select"},{display:this.$t("WIPLinesideLibrary.partsReportUserId"),key:"partsReportUserId",type:"select"},{display:this.$t("WIPLinesideLibrary.partsReportDate"),key:"partsReportDate",exp:"=",type:"datetime"},{display:this.$t("WIPLinesideLibrary.partsReportNextProcedure"),key:"partsReportNextProcedure",type:"input"},{display:this.$t("WIPLinesideLibrary.partsReportProcessRoute"),key:"partsReportProcessRoute",type:"input"}],showUpdate:!1,title:this.$t("WIPLinesideLibrary.title"),storeType:7,api:"/nest/nestwiplineparts/getpartsrootstack",btnmenus:[{key:"transfer",name:this.$t("WIPLinesideLibrary.transfer"),icon:"exchange"},{key:"transferToWarehouse",name:this.$t("WIPLinesideLibrary.transferToWarehouse"),icon:"exchange"},{key:"update",name:this.$t("WIPLinesideLibrary.update"),icon:"replay"}],bottomButtons:[],detailParamKey:"ptmtInStockid",selectItems:{}}},methods:{afterTransfersearch:function(e){var t=this,a=e.records;a.forEach((function(e){e.wmsStackList.forEach((function(e){e.stackmodelMaterialclass="WIP",e.id===t.$refs.XsStackBlock.selectedStackId&&(e.color="rgb(192, 179, 209)",e.isCurrentItem=!0)}))}))},closeSelect:function(e){e&&(e.flag=!1),this.showStackSelect=!1,this.showTransfer=!1,this.showOutOfStock=!1},openDetail:function(e,t){this.bottomButtons=[]},initSelect:function(){var e=this;this.$ajax("/common/comteam/list","",{},(function(t){var a=[];t.data.data.forEach((function(e){var t={id:e.id,name:e.teamName};a.push(t)})),e.selectItems.partsReportTeamId=a})),this.$ajax("/auth/dep/listdep","",{},(function(t){var a=[];t.data.data.forEach((function(e){var t={id:e.id,name:e.depName};a.push(t)})),e.selectItems.partsReportWorkshop=a})),this.$ajax("/common/comequipment/list","",{},(function(t){var a=[];t.data.data.forEach((function(e){var t={id:e.id,name:e.equipmentName};a.push(t)})),e.selectItems.partsReportEquipment=a})),this.$ajax("/wms/wmsstack/list","",{},(function(t){var a=[];t.data.data.forEach((function(e){var t={name:e.stackName,id:e.id};a.push(t)})),e.selectItems.wlpStackId=a})),this.$ajax("/wms/wmsstore/list","",{storeType:7},(function(t){var a=[];t.data.data.forEach((function(e){var t={id:e.id,name:e.storeName};a.push(t)})),e.selectItems.wlpStoreId=a})),this.$ajax("/auth/user/listuser","",{},(function(t){var a=[];t.data.data.forEach((function(e){var t={id:e.id,name:e.userRealname};a.push(t)})),e.selectItems.partsReportUserId=a})),this.selectItems["partsReportCuttingType"]=r["a"].getDict("CUTTING_TYPE"),this.selectItems["partsReportFeedback"]=r["a"].getDict("NEST_FEEDBACK_STATUS")},closeUpdate:function(){this.showUpdate=!1},afterSave:function(){this.showUpdate=!1,this.$refs.XsStackBlock.$refs.XsStackDetail.$refs.basePage.search()},sure:function(e){var t=this;if(this.$refs.XsStackBlock.selectedStackId===e.stackId)return!1;var a=this.$refs.XsStackBlock.$refs.XsStackDetail.$refs.basePage.getselected(),s=[];a.forEach((function(t){var a={wlrWlpId:t.id,wlrFromStoreid:t.wlpStoreId,wlrFromStackid:t.wlpStackId,wlrQuatity:t.wlpQuatity,wlrToStoreid:e.storeId,wlrToStackid:e.stackId,wlrBussType:"5",wlrDeviceid:"",wlrRemark:"在制品移库"};s.push(a)})),this.$ajax("/nest/nestwiplineparts/batchcollapse","",s,(function(){t.$toast.success(t.$t("oriStock.transferSuccess")),t.showTransfer=!1,t.$refs.XsStackBlock.$refs.XsStackDetail.$refs.basePage.search()}))},btnmenusEvent:function(e){this.bottomButtons=[],"transfer"===e?this.bottomButtons.some((function(e){return"transfer"===e.key}))||this.bottomButtons.push({key:"transfer",name:this.$t("WIPLinesideLibrary.transfer")}):"transferToWarehouse"===e?this.bottomButtons.some((function(e){return"transferToWarehouse"===e.key}))||this.bottomButtons.push({key:"transferToWarehouse",name:this.$t("WIPLinesideLibrary.transferToWarehouse")}):"update"===e&&(this.bottomButtons.some((function(e){return"update"===e.key}))||this.bottomButtons.push({key:"update",name:this.$t("WIPLinesideLibrary.update")}))},beforesearchSelect:function(e){e.slaves=this.slaves},beforesearch:function(e){},beforeDetailQuery:function(e,t){var a=this.$refs.XsStackBlock.$refs.baseQueryConditions.cons,s=this.$refs.XsStackBlock.$refs.baseQueryConditions.conVals,i=t.exp,r=t.value;Object.keys(s).forEach((function(e){i[e]=a.find((function(t){return t.conkey===e})).conexp,r[e]=s[e]}))},aftersearch:function(e){this.WmsStackMatSum=e.extParams.WmsStackMatSum,this.total=e.total,e.records.forEach((function(e){e.wmsStackList.forEach((function(e){e.stackmodelMaterialclass="WIP"}))}))},bottomButtonsClick:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];arguments.length>2&&void 0!==arguments[2]&&arguments[2];"transfer"===e?this.transfer():"transferToWarehouse"===e?this.transferToWarehouse(t):"update"===e&&this.update(t)},transfer:function(){var e=this.$refs.XsStackBlock.$refs.XsStackDetail.$refs.basePage.getselected();if(0===e.length)return this.$toast.fail(this.$t("base.noselect")),!1;this.showTransfer=!0},transferToWarehouse:function(e){var t=this,a=this,s=a.$refs.XsStackBlock.$refs.XsStackDetail.$refs.basePage.getselected();0!==s.length?h["a"].confirm({lazyRender:!1,width:"90%",cancelButtonColor:"#ff4c4c",confirmButtonColor:"#63428e",getContainer:".stackDetail",message:a.$t("WIPLinesideLibrary.cofirm1")+this.footerText[0].value+a.$t("WIPLinesideLibrary.cofirm2")+this.footerText[1].value+a.$t("WIPLinesideLibrary.cofirm3")}).then((function(){var s=e.map((function(e){return{id:e.id,name:e.wlpReportId}}));a.$ajax("/nest/nestwiplineparts/wipout","",s,(function(e){t.$toast.success(t.$t("WIPLinesideLibrary.transferToWarehouseSuccess")),a.$refs.XsStackBlock.$refs.XsStackDetail.$refs.basePage.search()}))})).catch((function(){})):this.$toast.fail(this.$t("base.noselect"))},update:function(e){var t=this;if(0==e.length)return this.$toast.fail(this.$t("base.noselect")),!1;this.updateDatas=e,this.updateFields.forEach((function(e){Object.keys(t.selectItems).forEach((function(a){a===e.key&&t.$set(t.updateSelectItems,a,t.selectItems[a])}))})),this.showUpdate=!0}},created:function(){this.initSelect()}},y=m,k=Object(p["a"])(y,s,i,!1,null,null,null);t["default"]=k.exports},b169:function(e,t,a){"use strict";var s=a("262a"),i=a.n(s);i.a}}]);
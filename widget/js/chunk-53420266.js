(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-53420266"],{"1d85":function(t,e,s){"use strict";var a=s("fc86"),n=s.n(a);n.a},"1fdf":function(t,e,s){"use strict";var a=s("d3af"),n=s.n(a);n.a},"4b8f":function(t,e,s){},"4ecc":function(t,e,s){"use strict";var a=s("cc5d"),n=s.n(a);n.a},cc5d:function(t,e,s){},d3af:function(t,e,s){},d73e:function(t,e,s){"use strict";var a=s("4b8f"),n=s.n(a);n.a},f398:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("baseNavigation",{attrs:{rightIcon:t.rightIcon,title:t.$t("pretreatment.title"),id:"pretreatmentNav",extIcon:t.extIcon},on:{extClick:t.extClick,rightClick:t.rightClick}}),s("div",{staticClass:"storebox",attrs:{id:"storebox"}},[s("van-dropdown-menu",{staticClass:"van-dropdown-menu-xs",attrs:{"active-color":"#61408d"}},[s("van-dropdown-item",{attrs:{options:t.storeOption},on:{change:t.changeStore},model:{value:t.storeId,callback:function(e){t.storeId=e},expression:"storeId"}})],1),s("van-search",{staticClass:"van-search-xs",attrs:{placeholder:t.$t("base.searchplaceholder")},on:{blur:t.onBlur},model:{value:t.stackName,callback:function(e){t.stackName=e},expression:"stackName"}})],1),s("div",{staticClass:"box",attrs:{id:"box"}},[s("van-row",[s("van-col",{staticStyle:{"text-align":"left"},attrs:{span:"8"}},[s("label",[t._v(t._s(t.$t("oriStock.stackTitle")))]),s("span",[t._v(t._s(t.matStackQty))])]),s("van-col",{staticStyle:{"text-align":"center"},attrs:{span:"8"}},[s("label",[t._v(t._s(t.$t("oriStock.matNum")))]),s("span",[t._v(t._s(t.matSumQty))])]),s("van-col",{staticStyle:{"text-align":"right"},attrs:{span:"8"}},[s("label",[t._v(t._s(t.$t("oriStock.matWeight")))]),s("span",[t._v(t._s(t.tool.numberFormat("4",t.matSumWeight))+t._s(t.$t("oriStock.KG")))])])],1)],1),s("div",{staticClass:"stackBlockBody",style:{height:t.height+"PX"}},[s("stackBlock",{ref:"stackBlock",attrs:{fixedField:t.fixedField,stackList:t.stackList,total:t.total,size:t.size,current:t.current,pages:t.pages},on:{search:t.search,openDetail:t.openDetail}})],1),s("baseQueryConditions",{ref:"baseQueryConditions",attrs:{show:t.showQueryConditions,addcon:t.addcon,selectItems:t.selectItems,title:t.contitle,tableCondition:t.tableCondition,cascadeItems:t.cascadeItems},on:{close:t.closeQueryConditions,search:t.search}}),s("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#F7F7F7"},attrs:{position:"right"},model:{value:t.popupshow,callback:function(e){t.popupshow=e},expression:"popupshow"}},[t.popupshow?s("stackDetail",{attrs:{numberCol:t.numberCol,fixedQueryConditions:t.fixedQueryConditions,pathName:t.pathName,storeId:t.storeId,options:t.storeOption,extIcon:t.extIcon,selectItems:t.selectItems},on:{closeStockDetail:t.closeStockDetail,extClick:t.extClick}}):t._e()],1)],1)},n=[],o=(s("456d"),s("386d"),s("ac6a"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"stackBlock"}},[s("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[s("van-list",{ref:"list",attrs:{finished:t.finished,"finished-text":t.$t("base.nomore")},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.stackList,(function(e){return s("van-row",{key:e.pathCode,staticClass:"stackBlockBody"},[s("van-sidebar",[s("van-sidebar-item",{attrs:{title:e.pathName}})],1),s("van-row",[s("van-grid",{staticClass:"iconCenter",attrs:{clickable:"","column-num":4,border:!1}},t._l(e.wmsStackList,(function(a){return s("van-grid-item",{key:a.id,attrs:{text:a.stackName}},[s("stackItem",{attrs:{stackEntity:a,fixedField:t.fixedField},nativeOn:{click:function(s){return t.openDetail(e.pathName,a)}}})],1)})),1)],1)],1)})),1)],1)],1)}),i=[],r=(s("c5f6"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"stack"},[s("div",{staticClass:"stackBody",style:{"background-image":t.backgroundUrl,"background-position":"center","background-position-y":"0.75rem","background-size":"1.5rem","background-repeat":"no-repeat"},attrs:{id:"stack"}},[s("span",{staticClass:"mat-instock-title",style:{background:t.stackEntity.matFitSumNum>0?"#61408c":"#fff"}},[t._v("\n\t\t\t\t"+t._s(t.matInStockTitle)+"\n\t\t\t")]),s("div",{staticClass:"stack-message"},t._l(t.fixedField,(function(e){return s("span",{key:e},[t._v(t._s(t.stackEntity[e]))])})),0),s("div",{staticClass:"progress-location"},[s("van-progress",{attrs:{percentage:t.matPercentage,color:"#61408c","stroke-width":"12","show-pivot":!0}})],1)]),s("span",{staticClass:"mat-instock-title mat-instock-name"},[t._v(t._s(t.stackEntity.stackName))])])}),c=[],u={name:"stackItem",components:{},props:{stackEntity:{type:Object},fixedField:{type:Array},maxHeight:{type:Number,default:function(){return 2e3}}},data:function(){return{messageOne:"",messageTwo:"",backgroundUrl:""}},computed:{matInStockTitle:function(){var t=this.stackEntity.matFitSumNum>0?this.$t("oriStock.matInStock")+"("+this.stackEntity.matFitSumNum+")":"";return t},matPercentage:function(){return(this.stackEntity.matSumThickness?(this.stackEntity.matSumThickness/this.maxHeight*100).toFixed(1):0)>100?100:this.stackEntity.matSumThickness?(this.stackEntity.matSumThickness/this.maxHeight*100).toFixed(1):0}},watch:{},methods:{},created:function(){},mounted:function(){var t=s("2f30");"SHEET"===this.stackEntity.stackmodelMaterialclass?(t=s("2f30"),this.backgroundUrl="url("+t+")"):"PROFILE"===this.stackEntity.stackmodelMaterialclass&&(t=s("d955")),this.backgroundUrl="url("+t+")"},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},l=u,d=(s("d73e"),s("2877")),f=Object(d["a"])(l,r,c,!1,null,"7cc80a5e",null),h=f.exports,m={name:"stackBlock",components:{stackItem:h},data:function(){return{refreshing:!1,loading:!1,finished:!1}},props:{total:{type:Number,default:function(){return 0}},size:{type:Number,default:function(){return 0}},current:{type:Number,default:function(){return 0}},pages:{type:Number,default:function(){return 0}},fixedField:{type:Array,default:function(){return[]}},stackList:{type:Array,default:function(){return[]}}},computed:{},watch:{},methods:{onRefresh:function(){this.finished=!1,this.loading=!0,this.onLoad(0)},onLoad:function(t){var e=this,s=0;s=0===t?t:this.current+1,this.$emit("search",s,(function(t,s){e.refreshing&&(e.refreshing=!1),e.loading=!1}))},openDetail:function(t,e){this.$emit("openDetail",t,e)}},created:function(){},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},p=m,k=(s("4ecc"),Object(d["a"])(p,o,i,!1,null,"4108ef02",null)),b=k.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{},[s("basePage",{ref:"basePage",attrs:{rightIcon:"",numberCol:t.numberCol,title:t.$t("pretreatment.stackDetail"),btnMethod:t.btnMethod,fixedQueryConditions:t.fixedQueryConditions,footerText:t.footerText,buttons:t.buttons,checkallable:!0,extIcon:t.extIcon,selectItems:t.selectItems},on:{extClick:t.extClick,onClickLeft:t.onClickLeft,afterquery:t.afterquery,aftercheck:t.aftercheck,btnmenusEvent:t.btnmenusEvent,buttonsClick:t.buttonsClick},scopedSlots:t._u([{key:"over",fn:function(){return[s("div",{staticClass:"title-stack"},[s("div",{staticClass:"title-stack-name"},[t._v(t._s(t.$t("oriStock.stackTitle"))+t._s(t.pathName)+">")]),s("div",{staticClass:"title-stack-count"},[s("span",[t._v(t._s(t.$t("oriStock.matNum")))]),s("span",[t._v(t._s(t.validCount)+"/"+t._s(t.total))])])])]},proxy:!0}])}),s("stackSelect",{ref:"stockSelect",attrs:{show:t.showStackSelect,options:t.options,api:t.api},on:{closeSelect:t.closeSelect,sure:t.sure,aftersearch:t.aftersearch}})],1)},g=[],y=(s("5df3"),s("55dd"),s("02df")),S={rollout:"1",initiatePreprocessing:"0"},x={name:"oriStockDetail",components:{},props:{numberCol:{type:Object},btnmenus:{type:Array,default:function(){return[]}},footerText:{type:Array,default:function(){return[{key:"num",display:this.$t("pretreatment.matNumName"),value:0},{key:"weight",display:this.$t("pretreatment.matWeightName"),value:"0"+this.$t("oriStock.KG")}]}},fixedQueryConditions:{type:Array,default:function(){return[]}},pathName:{type:String,default:function(){return""}},storeId:{type:String,default:function(){return""}},options:{type:Array,default:function(){return[]}},extIcon:{type:String,default:function(){return""}},selectItems:{type:Object,default:function(){return{}}}},data:function(){return{btnMethod:{querymethod:"/wms/wmsOutboundUse/pretreatmentList"},total:0,validCount:0,buttons:[{key:"transfer",name:this.$t("pretreatment.transfer")},{key:"rollout",name:this.$t("pretreatment.rollout")},{key:"initiatePreprocessing",name:this.$t("pretreatment.initiatePreprocessing")}],showAllData:!1,showStackSelect:!1,storeName:"",api:"/wms/wmsOutboundUse/getrootstack"}},computed:{},watch:{},methods:{aftersearch:function(t){var e=t.records,s=this.fixedQueryConditions.length,a=this.fixedQueryConditions[s-1];e.forEach((function(t){t.wmsStackList.forEach((function(t){t.id===a.value&&(t.color="rgb(192, 179, 209)",t.isCurrentItem=!0)}))}))},btnmenusEvent:function(t){},buttonsClick:function(t){var e=this.$refs.basePage.ischeckall(),s=this.$refs.basePage.getselected();if("transfer"===t)if(e)this.showStackSelect=!0;else if(s&&s.length>0)if(s=s.sort((function(t,e){return Number(e.obuToSerialno)-Number(t.obuToSerialno)})),Number(s[0].obuToSerialno)<this.$refs.basePage.total)this.$toast.fail(this.$t("pretreatment.notFromTop"));else{for(var a=!1,n=0;n<s.length;n++)if(n<s.length-1&&Number(s[n].obuToSerialno)-Number(s[n+1].obuToSerialno)!==1){a=!0;break}a?this.$toast.fail(this.$t("pretreatment.discontinuous")):this.showStackSelect=!0}else this.$toast.fail(this.$t("base.noselect"));else"rollout"!==t&&"initiatePreprocessing"!==t||s&&s.length>0&&("1"===s[0].validFlag?this.$toast.fail(this.$t("pretreatment.invalid")):this.preProcess(S[t]))},sure:function(t){var e=this.$refs.basePage.getselected();e&&e.length>0?this.collapse(t):this.$toast.fail(this.$t("base.noselect")),this.showStackSelect=!1},collapse:function(t){var e=this,s=this,a=this.$refs.basePage.getselected();this.$toast.loading({forbidClick:!0,duration:0});var n=[];a.forEach((function(e){var s={id:e.id,obuToSerialno:e.obuToSerialno,targetStoreid:t.storeId,targetStockid:t.stackId,obuToStoreid:e.obuToStoreid,obuToStockid:e.obuToStockid};n.push(s)})),this.$ajax("/wms/wmsOutboundUse/changePreprocessingStore","",n,(function(t){e.$toast.success(s.$t("pretreatment.transferSuccess")),s.$refs.basePage.search()}))},preProcess:function(t){var e=this,s=this;s.$toast.loading({forbidClick:!0,duration:0});var a=this.$refs.basePage.ischeckall();if(a)this.$refs.basePage.searchAll((function(s){e.preFunc(s,t)}));else{var n=this.$refs.basePage.getselected();this.preFunc(n,t)}},preFunc:function(t,e){var s=this,a=[];t.forEach((function(t){var n=new Promise((function(a,n){var o={actionId:e,id:t.id,teamTeamstoreid:t.teamTeamstoreid,teamTeamstackid:t.teamTeamstackid,obuToStoreid:t.obuToStoreid,obuToStockid:t.obuToStockid,obuToSerialno:t.obuToSerialno};s.$ajax("/wms/wmspretreatmenttask/initiatePreprocessing","",o,(function(t){return a(!0)}),(function(t){return n(t)}))}));a.push(n)})),Promise.all(a).then((function(){"0"===e?s.$toast.success(s.$t("pretreatment.iniateSuccess")):"1"===e&&s.$toast.success(s.$t("pretreatment.rolloutSuccess")),s.$refs.basePage.search()})).catch((function(){return s.$toast.clear()}))},closeSelect:function(t){t&&(t.flag=!1),this.showStackSelect=!1},onClickLeft:function(t){this.$emit("closeStockDetail",t)},afterquery:function(t){var e=this;this.total=t.total;var s=t.extParams;s&&s.validCount&&(this.validCount=s.validCount);var a=t.records;a.forEach((function(t){t.color=1===Number(t.validFlag)?"#dcdcdc":""})),this.$nextTick((function(){e.aftercheck()}))},aftercheck:function(){var t=this.$refs.basePage.getselected();this.footerText[0].value=t.length;var e=0;Object.keys(t).forEach((function(s){e+=parseFloat(t[s].matAuxQuantity)})),this.footerText[1].value=y["a"].numberFormat("4",e)+this.$t("oriStock.KG")},extClick:function(){this.$emit("extClick")}},created:function(){},mounted:function(){this.total=this.$refs.basePage.total},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},C=x,$=(s("1d85"),Object(d["a"])(C,v,g,!1,null,"cb7e03a2",null)),w=$.exports,I={props:{btnMethod:{type:Object,default:function(){return{}}},addcon:{type:Array,default:function(){return[]}},tableCondition:{type:Array,default:function(){return[]}},cascadeItems:{type:Object,default:function(){return{}}}},components:{stackBlock:b,stackDetail:w},name:"pretreatment",data:function(){return{numberCol:{2:["ovdThickness"]},tool:y["a"],storeId:"",stackName:"",matStackQty:0,matSumQty:0,matSumWeight:0,storeOption:[],rightIcon:"search",height:0,searchJson:{},fixedField:["matSumQty","matSumThickness"],stackList:[],total:0,size:1,current:0,pages:0,showQueryConditions:!1,contitle:this.$t("base.conditions"),popupshow:!1,fixedQueryConditions:[],pathName:"",extIcon:"wap-nav",selectItems:{oboBusscode:[{id:"0",name:this.$t("pretreatment.plateCutting")}]}}},computed:{},methods:{init:function(){var t=this,e=this;this.$ajax("/wms/wmsstore/list","",{storeType:7,storeClassify:"ORI"},(function(t){e.selectItems.teamMachineroomstoreid=t.data.data.map((function(t){return{id:t.id,name:t.storeName}}))})),this.$ajax("/wms/wmsstack/list","",{},(function(e){var s=[];e.data.data.forEach((function(t){var e={name:t.stackName,id:t.id};s.push(e)})),t.selectItems.obuToStockid=s,t.selectItems.teamMachineroomstackid=s})),this.$ajax("/auth/dep/listdep","",{},(function(e){var s=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.depName};s.push(e)})),t.selectItems.oboDepId=s})),this.$ajax("/common/comteam/list","",{},(function(e){var s=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.teamName};s.push(e)})),t.selectItems.oboTeamId=s}));var s=this.$asyncajax("/wms/wmsstore/list","",{storeType:5}).data;this.storeId=s.length>0?s[0].id:"";var a=[];s.forEach((function(e){var s={text:e.storeName,value:e.id},n={id:e.id,name:e.storeName};a.push(n),t.storeOption.push(s)})),this.selectItems.obuToStoreid=a,this.selectItems.ovdSheettype=y["a"].getDict("NEST_MAT_TYPE")},closeQueryConditions:function(){this.showQueryConditions=!1},onBlur:function(){this.search()},openDetail:function(t,e){this.fixedQueryConditions=[],this.popupshow=!0;var s=this.searchJson.value,a=this.searchJson.exp;for(var n in s){var o={key:n,exp:a[n],value:s[n]};this.fixedQueryConditions.push(o)}var i={key:"stackId",exp:"=",value:e.id};this.fixedQueryConditions.push(i),this.pathName=t+" "+e.stackName},closeStockDetail:function(t){this.popupshow=!1,t.flag=!1,this.search()},getstacksumbycon:function(){var t=this;this.$ajax("/wms/wmsOutboundUse/getstacksumbycon","",this.searchJson,(function(e){var s=e.data.data;s&&(t.matSumQty=s.matSumQty,t.matSumWeight=(s.matSumWeight/1e3).toFixed(3),t.matStackQty=s.matStackQty)}))},search:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1?arguments[1]:void 0;if(""!==this.storeId){var a=this.$refs.baseQueryConditions.cons,n=this.$refs.baseQueryConditions.conVals,o={};Object.keys(n).forEach((function(t){a.forEach((function(e){e.conkey===t&&(o[t]=e.conexp)}))})),n["stackName"]=this.stackName,o["stackName"]="like",n["storeId"]=this.storeId,o["storeId"]="=",this.searchJson={current:e,rows:15,value:n,exp:o,order:{}},this.$ajax("/wms/wmsOutboundUse/getrootstack","",this.searchJson,(function(a){1===e&&t.getstacksumbycon();var n=a.data.data;if(1===n.current)t.stackList=[],t.stackList=n.records;else{var o=n.records;for(var i in o){var r=o[i].pathCode,c=!1;for(var u in t.stackList)if(r===t.stackList[u].pathCode){t.stackList[u].wmsStackList=t.stackList[u].wmsStackList.concat(o[i].wmsStackList),c=!0;break}c||(t.stackList=t.stackList.concat(o[i]))}}t.current=n.current,t.size=n.size,t.pages=n.pages,t.total=n.total,n.current>=n.pages?t.$refs.stackBlock.finished=!0:t.$refs.stackBlock.finished&&(t.$refs.stackBlock.finished=!1),t.$refs.stackBlock.$refs.list.check(),"undefined"!=typeof s&&s(n.current,n.pages)}))}else this.$toast(this.$t("oriStock.choiceStore"))},changeStore:function(){var t=this.$toast.loading({message:"加载中...",overlay:!0,forbidClick:!0}),e=this,s=function(){e.$nextTick((function(){t.clear()}))};this.search(1,s)},rightClick:function(){this.showQueryConditions=!0},extClick:function(){this.$router.push({path:"/pretreatTask"})}},created:function(){this.init()},mounted:function(){this.height=window.innerHeight-document.getElementById("pretreatmentNav").offsetHeight-5-document.getElementById("storebox").offsetHeight-document.getElementById("box").offsetHeight}},T=I,N=(s("1fdf"),Object(d["a"])(T,a,n,!1,null,"359929b1",null));e["default"]=N.exports},fc86:function(t,e,s){}}]);
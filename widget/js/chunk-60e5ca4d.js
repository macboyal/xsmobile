(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60e5ca4d"],{"6c20":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("basePage",{ref:"basePage",attrs:{numberCol:e.numberCol,buttons:e.buttons,draggable:!0,footerText:e.footerText,btnMethod:e.btnMethod,selectItems:e.selectItems,defualtConditions:e.defualtConditions,fixedQueryConditions:e.fixedQueryConditions,cascadeItems:e.cascadeItems,order:{matBarcode:"asc"},title:"余料入库",fixed1Tip:"请扫码或输入条形码",contitle:e.$t("base.contitle")},on:{buttonsClick:e.buttonsClick,aftercheck:e.aftercheck,afterquery:e.afterquery,aftercheckall:e.aftercheckall,fclick:e.fclick,fblur:e.fblur},scopedSlots:e._u([{key:"over",fn:function(){return[a("van-row",{staticStyle:{"text-align":"center","vertical-align":"middle","align-items":"center","justify-content":"center",display:"flex"}},[a("van-col",{attrs:{span:"4"}},[a("span",{staticClass:"smallfont"},[e._v(e._s(e.$t("rawMaterialStorage.store")))])]),a("van-col",{attrs:{span:"14"}},[a("menuselect",{staticStyle:{width:"100%"},attrs:{showFirstItem:"",options:e.options},model:{value:e.storeId,callback:function(t){e.storeId=t},expression:"storeId"}})],1),a("van-col",{attrs:{span:"6"}},[a("span",{staticClass:"smallfont",staticStyle:{float:"right","margin-right":"10px"}},[e._v(e._s(e.$t("rawMaterialStorage.total")+":"+e.total))])])],1)]},proxy:!0}])}),a("stackSelect",{ref:"stockSelect",attrs:{storeId:e.storeId,options:e.options,show:e.show},on:{closeSelect:e.closeSelect,beforesearch:e.beforesearch,sure:e.sure}})],1)},i=[],r=(a("1c4c"),a("386d"),a("20d6"),a("7514"),a("ac6a"),a("5df3"),a("4f7f"),a("d399")),n=a("02df"),o={name:"remWarehousing",data:function(){return{flag:!1,numberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},editBarCode:!1,editObj:{},barCodes:new Set,buttons:[{key:"warehouse",name:this.$t("rawMaterialStorage.warehousing")}],selectobjs:[],show:!1,storeId:"",total:0,options:[],footerText:[{key:"quantity",display:this.$t("rawMaterialStorage.quantity"),value:0},{key:"weight",display:this.$t("rawMaterialStorage.weight"),value:0}],btnMethod:{querymethod:"/wms/wmsmat/remainautopage"},selectItems:{matStorageStatus:[],matInvStatus:[],matSheetType:[]},cascadeItems:{},boindnum:0,unboindnum:0,addcon:[],defualtConditions:[{key:"matInvStatus",exp:"=",value:"0"}],fixedQueryConditions:[{key:"matPublicStatus",exp:"=",value:"1"},{key:"matSheetType",exp:"=",value:"1"}]}},created:function(){this.initselect(),sc.initScan(this.scanning)},destroyed:function(){sc.initScan(void 0)},activated:function(){},methods:{getIndex:function(){var e=this,t=!1,a=0;return this.$refs.basePage.datas.forEach((function(s,i){if(!t){var r=e.$refs.basePage.$refs.baseList.$refs.cards.find((function(e){return e.data.matBarcode===s.matBarcode}));!1===r.checked&&(a=i,t=!0)}})),a},scanning:function(e,t){var a=this;if(r["a"].loading({forbidClick:!0,duration:0}),!1===this.editBarCode){var s=e.data;if(s){var i={current:1,rows:1,value:{matBarcode:s},exp:{matBarcode:"="},slaves:{},order:{}};this.fixedQueryConditions.forEach((function(e){"slaves"!==e.key?(i.value[e.key]=e.value,i.exp[e.key]=e.exp):i.slaves=e.value})),this.$ajax(this.btnMethod.querymethod,"",i,(function(e){var t=a;if(e&&e.data&&e.data.data&&e.data.data.records){var s=e.data.data.records;s.length>0?(s.forEach((function(e){var s=a.$refs.basePage.datas.findIndex((function(t){return t.matBarcode===e.matBarcode}));s>=0&&a.$refs.basePage.datas.splice(s,1);var i=a.getIndex();a.$refs.basePage.datas.splice(i,0,e),a.$nextTick((function(){t.$refs.basePage.$refs.baseList.$refs.cards.forEach((function(t){t.data.matBarcode===e.matBarcode&&(t.$refs.checkbox.toggle(!0),a.aftercheck())}))})),a.barCodes.add(e.matBarcode)})),r["a"].clear()):r["a"].fail(a.$t("rawMaterialArrival.scanFail"))}}))}}else{var n=JSON.parse(JSON.stringify(this.editObj));n.matBarcode=e.data,this.$ajax("/wms/wmsmat/update","",n,(function(e){a.flag=!1;var t=a.$refs.basePage.datas.findIndex((function(e){return e.id===n.id}));t>=0&&a.$refs.basePage.datas.splice(t,1,n),r["a"].clear()}))}},buttonsClick:function(e){if("warehouse"===e){var t=this.$refs.basePage.ischeckall();if(t)this.show=!0;else{var a=this.$refs.basePage.getselected();a&&a.length>0?this.show=!0:this.$toast.fail(this.$t("base.noselect"))}}},warehouseAll:function(e){var t=this.$refs.basePage.getsearchJson(),a=this;this.$ajax("/wms/wmsmat/noautopageidlist","",t,(function(t){var s=t.data.data;r["a"].loading({forbidClick:!0,duration:0});var i=[];s.forEach((function(t){var s={id:t,matInvStatus:1,matStoreId:a.storeId,matStackId:e},r=new Promise((function(e,t){a.$ajax("/wms/wmsmat/batchinstoreRemain","",[s],(function(t){e(!0)}))}));i.push(r)})),Promise.all(i).then((function(e){a.show=!1,r["a"].success(a.$t("rawMaterialStorage.success")),a.$refs.basePage.search()})).catch((function(){return r["a"].clear()}))}))},warehouse:function(e){var t=this,a=this,s=this.$refs.basePage.getselected(),i=[];r["a"].loading({forbidClick:!0,duration:0}),s.forEach((function(s){var r={id:s.id,matInvStatus:1,matStoreId:t.storeId,matStackId:e},n=new Promise((function(e,t){a.$ajax("/wms/wmsmat/batchinstoreRemain","",[r],(function(t){e(!0)}))}));i.push(n)})),Promise.all(i).then((function(e){a.show=!1,r["a"].success(a.$t("rawMaterialStorage.success")),a.$refs.basePage.search()})).catch((function(){return r["a"].clear()}))},beforesearch:function(e){var t=this.$refs.basePage.getselected(),a=new Set;t.forEach((function(e){a.add(e.matCatFathcode)})),e.exp["matMatCatCode"]="=",e.value["matMatCatCode"]=Array.from(a).join(",")},sure:function(e){var t=this.$refs.basePage.ischeckall();if(t)this.warehouseAll(e.stackId);else{var a=this.$refs.basePage.getselected();a&&a.length>0?this.warehouse(e.stackId):this.$toast.fail(this.$t("base.noselect"))}},aftercheck:function(e){if(!1===this.$refs.basePage.checkAll){var t=this.$refs.basePage.getselected(),a=0,s=0;t.forEach((function(e){a+=e.matAuxQuantity,s+=e.matBasicQuantity})),this.footerText[0].value=s,this.footerText[1].value=n["a"].numberFormat(4,a)+"KG"}},aftercheckall:function(){!0===this.$refs.basePage.checkAll&&this.$refs.basePage.extRecords?(this.footerText[0].value=this.$refs.basePage.extRecords.MAT_BASIC_QUANTITY,this.footerText[1].value=n["a"].numberFormat(4,this.$refs.basePage.extRecords.MAT_AUX_QUANTITY)+"KG"):(this.footerText[0].value=0,this.footerText[1].value=0)},fclick:function(e,t,a,s,i){e.flag=!1,this.flag=!0,this.$set(i,"fixed1",!0),this.editBarCode=!0,this.editObj=s},fblur:function(e,t,a){var s=this;if(this.editBarCode=!1,this.$set(a,"fixed1",!1),this.flag){var i=t;r["a"].loading({forbidClick:!0,duration:0}),this.$ajax("/wms/wmsmat/update","",i,(function(e){var t=s.$refs.basePage.datas.findIndex((function(e){return e.id===i.id}));t>=0&&s.$refs.basePage.datas.splice(t,1,i),r["a"].clear()}))}},afterquery:function(e){var t=this;1===e.current&&(this.barCodes=new Set),this.barCodes.forEach((function(t){var a=e.records.findIndex((function(e){return e.matBarcode===t}));a>0&&e.records.splice(a,1)})),e.records.forEach((function(e){var t=n["a"].numberFormat(4,e.matLength?e.matLength:0),a=n["a"].numberFormat(4,e.matWidth?e.matWidth:0);e["lengthAndWidth"]=t+"*"+a})),this.total=e.total;var a=this.$refs.basePage.checkAll;this.$nextTick((function(){a?t.aftercheckall():t.aftercheck()}))},cascadehandler:function(e){var t=this,a=[];return e.forEach((function(e){var s={checkable:e.check,id:e.matCatSyspath,code:e.matCatSyscode,name:e.matCatName};s.children=t.cascadehandler(e.children),a.push(s)})),a},closeSelect:function(e){e&&(e.flag=!1),this.show=!1},initselect:function(){var e=this;this.selectItems.matSheetType=n["a"].getDict("SHEET_TYPE"),this.selectItems.matStorageStatus=n["a"].getDict("STORAGE_STATUS"),this.selectItems.matInvStatus=n["a"].getDict("MAT_STATUS"),this.$ajax("/wms/wmsstore/list","",{storeType:8},(function(t){var a=[];t.data.data.forEach((function(e){var t={text:e.storeName,value:e.id};a.push(t)})),e.options=a})),this.selectItems.wmsPicStatus=[{id:"0",name:"未检查",icon:"ios-image",color:"#666"},{id:"1",name:"有图",icon:"md-images",color:"#42CE6C"},{id:"2",name:"缺图",icon:"md-image",color:"#F7434D"}],this.selectItems.ifHasPar=[{id:"1",name:"已匹配",icon:"tag",color:"#42CE6C"},{id:"0",name:"未匹配",icon:"tag",color:"#F7434D"}],this.selectItems.wmsDataSource=[{id:"0",name:"套料提取"},{id:"1",name:"Excel导入"},{id:"2",name:"新增"},{id:"3",name:"盘盈"}],this.$ajax("/auth/user/listuser","",{},(function(t){var a=[];t.data.data.forEach((function(e){var t={id:e.id,name:e.userRealname};a.push(t)})),e.selectItems.matInstoreUserid=a}))}}},c=o,d=(a("978f"),a("2877")),l=Object(d["a"])(c,s,i,!1,null,"ea81958e",null);t["default"]=l.exports},"978f":function(e,t,a){"use strict";var s=a("a936"),i=a.n(s);i.a},a936:function(e,t,a){}}]);
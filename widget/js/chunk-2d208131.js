(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d208131"],{a2f0:function(a,t,e){"use strict";e.r(t);var r=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("basePage",{ref:"basePage",attrs:{numberCol:a.numberCol,order:a.order,footerText:a.footerText,btnMethod:a.btnMethod,selectItems:a.selectItems,cascadeItems:a.cascadeItems,title:a.$t("rawMaterialArrival.title"),buttons:a.buttons,fixedQueryConditions:a.fixedQueryConditions,tableCondition:a.tableCondition,contitle:a.$t("rawMaterialArrival.contitle"),fixed1Tip:"请扫码或输入条形码"},on:{buttonsClick:a.buttonsClick,afterquery:a.afterquery,beforequery:a.beforequery,aftercheckall:a.aftercheck,aftercheck:a.aftercheck,fclick:a.fclick,fblur:a.fblur},scopedSlots:a._u([{key:"over",fn:function(){return[e("van-tabs",{attrs:{color:"#61408c","line-width":"50%"},on:{change:a.tabchange},model:{value:a.tabs,callback:function(t){a.tabs=t},expression:"tabs"}},[e("van-tab",{attrs:{title:a.$t("rawMaterialArrival.bound")+"("+a.boindnum+")",name:"1"}}),e("van-tab",{attrs:{title:a.$t("rawMaterialArrival.unbound")+"("+a.unboindnum+")",name:"0"}})],1)]},proxy:!0}])})],1)},s=[],i=(e("386d"),e("20d6"),e("7514"),e("ac6a"),e("5df3"),e("4f7f"),e("96cf"),e("3b8d")),n=e("d399"),c=e("2241"),o=e("02df"),d={name:"storage0001",data:function(){return{flag:!1,order:{matBarTimestamp:"desc",matImportDate:"desc",matImportSort:"asc"},numberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},editBarCode:!1,editObj:{},barCodes:new Set,footerText:[{key:"num",display:this.$t("base.checknum"),value:0}],btnMethod:{querymethod:"/wms/wmsmat/autopage"},selectItems:{matPurchStatus:[{id:0,name:"正常"},{id:1,name:"取消"}],matCheck:[{id:"0",name:"未检查",icon:"tag",color:"#666666"},{id:"1",name:"合格",icon:"tag",color:"success"},{id:"2",name:"不合格",icon:"tag",color:"error"}]},cascadeItems:{},boindnum:0,unboindnum:0,buttons:[{key:"release",name:this.$t("rawMaterialArrival.release")}],fixedQueryConditions:[{key:"matBarcodeIsnull",exp:"=",value:1},{key:"matSheetType",exp:"=",value:"0"}],tableCondition:[{col:"matPublicStatus",value:"0"}],tabs:"1"}},methods:{getIndex:function(){var a=this,t=!1,e=0;return this.$refs.basePage.datas.forEach((function(r,s){if(!t){var i=a.$refs.basePage.$refs.baseList.$refs.cards.find((function(a){return a.data.matBarcode===r.matBarcode}));!1===i.checked&&(e=s,t=!0)}})),e},scanning:function(a,t){var e=this;if(n["a"].loading({forbidClick:!0,duration:0}),!1===this.editBarCode){var r=a.data;if(r){var s={current:1,rows:1,value:{matBarcode:r},exp:{matBarcode:"="},slaves:{},order:{}};this.fixedQueryConditions.forEach((function(a){"slaves"!==a.key?(s.value[a.key]=a.value,s.exp[a.key]=a.exp):s.slaves=a.value})),this.$ajax(this.btnMethod.querymethod,"",s,(function(a){var t=e;if(a&&a.data&&a.data.data&&a.data.data.records){var r=a.data.data.records;r.length>0?(r.forEach((function(a){var r=e.$refs.basePage.datas.findIndex((function(t){return t.matBarcode===a.matBarcode}));r>=0&&e.$refs.basePage.datas.splice(r,1);var s=e.getIndex();e.$refs.basePage.datas.splice(s,0,a),e.$nextTick((function(){t.$refs.basePage.$refs.baseList.$refs.cards.forEach((function(t){t.data.matBarcode===a.matBarcode&&(t.$refs.checkbox.toggle(!0),e.aftercheck())}))})),e.barCodes.add(a.matBarcode)})),n["a"].clear()):n["a"].fail(e.$t("rawMaterialArrival.scanFail"))}}))}}else{var i=JSON.parse(JSON.stringify(this.editObj));i.matBarcode=a.data,this.$ajax("/wms/wmsmat/updatebarcode","",i,(function(a){var t=e.$refs.basePage.datas.findIndex((function(a){return a.id===i.id}));t>=0&&e.$refs.basePage.datas.splice(t,1,i),e.flag=!1,n["a"].clear()}))}},fclick:function(a,t,e,r,s){a.flag=!1,this.flag=!0,this.$set(s,"fixed1",!0),this.editBarCode=!0,this.editObj=r},fblur:function(a,t,e){var r=this;if(this.editBarCode=!1,this.$set(e,"fixed1",!1),!1!==this.flag){var s=t;delete s["matStackId"],delete s["matStoreId"],n["a"].loading({forbidClick:!0,duration:0}),this.$ajax("/wms/wmsmat/updatebarcode","",s,(function(a){var t=r.$refs.basePage.datas.findIndex((function(a){return a.id===s.id}));t>=0&&r.$refs.basePage.datas.splice(t,1,s),n["a"].clear()}))}},tabchange:function(a){this.fixedQueryConditions.splice(0),this.tableCondition.splice(0);var t={col:"matPublicStatus",value:"0"},e={key:"matBarcodeIsnull",exp:"=",value:a},r={key:"matSheetType",exp:"=",value:"0"};this.tableCondition.push(t),this.fixedQueryConditions.push(e),this.fixedQueryConditions.push(r),this.$refs.basePage.checkAll=!1,this.$refs.basePage.search()},cascadehandler:function(a){var t=this,e=[];return a.forEach((function(a){var r={checkable:a.check,id:a.matCatSyspath,code:a.matCatSyscode,name:a.matCatName};r.children=t.cascadehandler(a.children),e.push(r)})),e},aftercheck:function(a,t,e){!0===this.$refs.basePage.checkAll?this.footerText[0].value=this.$refs.basePage.total:this.footerText[0].value=this.$refs.basePage.getselected().length},beforequery:function(a,t){"0"===t.value.matPublicStatus?this.buttons=[{key:"release",name:this.$t("rawMaterialArrival.release")}]:this.buttons=[]},afterquery:function(a){var t=this;1===a.current&&(this.barCodes=new Set),this.barCodes.forEach((function(t){var e=a.records.findIndex((function(a){return a.matBarcode===t}));e>0&&a.records.splice(e,1)})),this.boindnum=a.extRecords[0]["1"],this.unboindnum=a.extRecords[0]["0"],this.$nextTick((function(){t.aftercheck()}))},releaseAll:function(){var a=this,t=this.$refs.basePage.getsearchJson();n["a"].loading({forbidClick:!0,duration:0}),this.$ajax("/wms/wmsmat/checkbarcode","",t,(function(e){var r=e.data.data;r-0>0?a.$ajax("/wms/wmsmat/noautopageidlist","",t,(function(t){var e=t.data.data;e.reverse(),n["a"].clear(),c["a"].confirm({title:"提示",message:"数据中存在未绑定条码的物资，是否确认发布？"}).then((function(){a.releaseBatch(e)})).catch((function(){}))})):a.$ajax("/wms/wmsmat/noautopageidlist","",t,(function(t){var e=t.data.data;e.reverse(),a.releaseBatch(e)}))}))},releaseBatch:function(){var a=Object(i["a"])(regeneratorRuntime.mark((function a(t){var e,r,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e=this,r=n["a"].loading({forbidClick:!0,duration:0}),s=regeneratorRuntime.mark((function a(s){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t[s],n={id:i},r.message="".concat(s," / ").concat(t.length),a.next=5,new Promise((function(a){e.$ajax("/wms/wmsmat/matpublic","",[n],(function(){a(!0)}))}));case 5:case"end":return a.stop()}}),a)})),a.t0=regeneratorRuntime.keys(t);case 4:if((a.t1=a.t0()).done){a.next=9;break}return i=a.t1.value,a.delegateYield(s(i),"t2",7);case 7:a.next=4;break;case 9:n["a"].success(e.$t("rawMaterialArrival.releasetoast")),e.$refs.basePage.search();case 11:case"end":return a.stop()}}),a,this)})));function t(t){return a.apply(this,arguments)}return t}(),buttonsClick:function(a){var t=this;if("release"===a){var e=this.$refs.basePage.ischeckall(),r=this;if(0===this.footerText[0].value)return!1;c["a"].confirm({width:"90%",message:r.$t("rawMaterialArrival.cofirm1")+this.footerText[0].value+r.$t("rawMaterialArrival.cofirm2")}).then((function(){if(e)r.releaseAll();else{var a=r.$refs.basePage.getselected();if(0===a.length)return;n["a"].loading({forbidClick:!0,duration:0});var s=[];a.forEach((function(a){var t={id:a.id};s.push(t)}));var i=a.map((function(a){return a.id}));r.$ajax("/wms/wmsmat/checkbarcodebyids","",i,(function(a){var e=a.data.data;e-0>0?(n["a"].clear(),c["a"].confirm({title:"提示",message:"数据中存在未绑定条码的物资，是否确认发布？"}).then((function(){n["a"].loading({forbidClick:!0,duration:0}),r.$ajax("/wms/wmsmat/matpublic","",s,(function(a){n["a"].success(t.$t("rawMaterialArrival.releasetoast")),r.$refs.basePage.search()}))})).catch((function(){}))):r.$ajax("/wms/wmsmat/matpublic","",s,(function(a){n["a"].success(t.$t("rawMaterialArrival.releasetoast")),r.$refs.basePage.search()}))}))}})).catch((function(){}))}},initselect:function(){var a=this;this.$ajax("/wms/wmsmatcat/matlisttree","",{matInvStatus:"0",matPublicStatus:"0"},(function(t){a.cascadeItems.matCatSyspath=a.cascadehandler(t.data.data)})),this.$ajax("/wms/wmsmat/getdistinctparams","",{type:"matCarshipno",matInvStatus:"0",matPublicStatus:"0"},(function(t){var e=t.data.data,r=[];e.forEach((function(a){var t={id:a,name:a};r.push(t)})),a.selectItems.matCarshipno=r})),this.$ajax("/wms/wmsmat/getdistinctparams","",{type:"matProjno",matInvStatus:"0",matPublicStatus:"0"},(function(t){var e=t.data.data,r=[];e.forEach((function(a){var t={id:a,name:a};r.push(t)})),a.selectItems.matProjNo=r})),this.$ajax("/wms/wmstrb/list","",{trbPublicStatus:"0"},(function(t){var e=t.data.data,r=[];e.forEach((function(a){var t={id:a.trbNo,name:a.trbNo};r.push(t)})),a.selectItems.trbNo=r})),this.selectItems.matSheetType=o["a"].getDict("SHEET_TYPE"),this.selectItems.matStorageStatus=o["a"].getDict("STORAGE_STATUS"),this.selectItems.matInvStatus=o["a"].getDict("MAT_STATUS"),this.selectItems.matPublicStatus=o["a"].getDict("TRB_PUBLIC_STATUS")}},activated:function(){},created:function(){this.initselect();var a=this.$route.query.showUnbound;!0===a&&(this.tabs="0",this.tabchange("0"));var t=localStorage.getItem("equipmentType");t&&"XUESI2"==t?sc.initUTScan(this.scanning):sc.initScan(this.scanning)},destroyed:function(){var a=localStorage.getItem("equipmentType");a&&"XUESI2"==a?sc.initUTScan(void 0):sc.initScan(void 0)}},u=d,l=e("2877"),f=Object(l["a"])(u,r,s,!1,null,"2272e988",null);t["default"]=f.exports}}]);
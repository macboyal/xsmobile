(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d208131"],{a2f0:function(a,t,e){"use strict";e.r(t);var i=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("basePage",{ref:"basePage",attrs:{numberCol:a.numberCol,order:{id:"asc"},footerText:a.footerText,btnMethod:a.btnMethod,selectItems:a.selectItems,cascadeItems:a.cascadeItems,title:a.$t("rawMaterialArrival.title"),buttons:a.buttons,fixedQueryConditions:a.fixedQueryConditions,tableCondition:a.tableCondition,contitle:a.$t("rawMaterialArrival.contitle"),fixed1Tip:"请扫码或输入条形码"},on:{buttonsClick:a.buttonsClick,afterquery:a.afterquery,beforequery:a.beforequery,aftercheckall:a.aftercheck,aftercheck:a.aftercheck,fclick:a.fclick,fblur:a.fblur},scopedSlots:a._u([{key:"over",fn:function(){return[e("van-tabs",{attrs:{color:"#61408c","line-width":"50%"},on:{change:a.tabchange},model:{value:a.tabs,callback:function(t){a.tabs=t},expression:"tabs"}},[e("van-tab",{attrs:{title:a.$t("rawMaterialArrival.bound")+"("+a.boindnum+")",name:"1"}}),e("van-tab",{attrs:{title:a.$t("rawMaterialArrival.unbound")+"("+a.unboindnum+")",name:"0"}})],1)]},proxy:!0}])})],1)},s=[],r=(e("386d"),e("20d6"),e("7514"),e("ac6a"),e("5df3"),e("4f7f"),e("d399")),n=e("2241"),c=e("02df"),o={name:"storage0001",data:function(){return{flag:!1,numberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},editBarCode:!1,editObj:{},barCodes:new Set,footerText:[{key:"num",display:this.$t("base.checknum"),value:0}],btnMethod:{querymethod:"/wms/wmsmat/autopage"},selectItems:{matPurchStatus:[{id:0,name:"正常"},{id:1,name:"取消"}],matCheck:[{id:"0",name:"未检查",icon:"tag",color:"#666666"},{id:"1",name:"合格",icon:"tag",color:"success"},{id:"2",name:"不合格",icon:"tag",color:"error"}]},cascadeItems:{},boindnum:0,unboindnum:0,buttons:[{key:"release",name:this.$t("rawMaterialArrival.release")}],fixedQueryConditions:[{key:"matBarcodeIsnull",exp:"=",value:1},{key:"matSheetType",exp:"=",value:"0"}],tableCondition:[{col:"matPublicStatus",value:"0"}],tabs:0}},methods:{getIndex:function(){var a=this,t=!1,e=0;return this.$refs.basePage.datas.forEach((function(i,s){if(!t){var r=a.$refs.basePage.$refs.baseList.$refs.cards.find((function(a){return a.data.matBarcode===i.matBarcode}));!1===r.checked&&(e=s,t=!0)}})),e},scanning:function(a,t){var e=this;if(r["a"].loading({forbidClick:!0,duration:0}),!1===this.editBarCode){var i=a.data;if(i){var s={current:1,rows:1,value:{matBarcode:i},exp:{matBarcode:"="},slaves:{},order:{}};this.fixedQueryConditions.forEach((function(a){"slaves"!==a.key?(s.value[a.key]=a.value,s.exp[a.key]=a.exp):s.slaves=a.value})),this.$ajax(this.btnMethod.querymethod,"",s,(function(a){var t=e;if(a&&a.data&&a.data.data&&a.data.data.records){var i=a.data.data.records;i.length>0?(i.forEach((function(a){var i=e.$refs.basePage.datas.findIndex((function(t){return t.matBarcode===a.matBarcode}));i>=0&&e.$refs.basePage.datas.splice(i,1);var s=e.getIndex();e.$refs.basePage.datas.splice(s,0,a),e.$nextTick((function(){t.$refs.basePage.$refs.baseList.$refs.cards.forEach((function(t){t.data.matBarcode===a.matBarcode&&(t.$refs.checkbox.toggle(!0),e.aftercheck())}))})),e.barCodes.add(a.matBarcode)})),r["a"].clear()):r["a"].fail(e.$t("rawMaterialArrival.scanFail"))}}))}}else{var n=JSON.parse(JSON.stringify(this.editObj));n.matBarcode=a.data,this.$ajax("/wms/wmsmat/updatebarcode","",n,(function(a){var t=e.$refs.basePage.datas.findIndex((function(a){return a.id===n.id}));t>=0&&e.$refs.basePage.datas.splice(t,1,n),e.flag=!1,r["a"].clear()}))}},fclick:function(a,t,e,i,s){a.flag=!1,this.flag=!0,this.$set(s,"fixed1",!0),this.editBarCode=!0,this.editObj=i},fblur:function(a,t,e){var i=this;if(this.editBarCode=!1,this.$set(e,"fixed1",!1),!1!==this.flag){var s=t;delete s["matStackId"],delete s["matStoreId"],r["a"].loading({forbidClick:!0,duration:0}),this.$ajax("/wms/wmsmat/updatebarcode","",s,(function(a){var t=i.$refs.basePage.datas.findIndex((function(a){return a.id===s.id}));t>=0&&i.$refs.basePage.datas.splice(t,1,s),r["a"].clear()}))}},tabchange:function(a){this.fixedQueryConditions.splice(0),this.tableCondition.splice(0);var t={col:"matPublicStatus",value:"0"},e={key:"matBarcodeIsnull",exp:"=",value:a},i={key:"matSheetType",exp:"=",value:"0"};this.tableCondition.push(t),this.fixedQueryConditions.push(e),this.fixedQueryConditions.push(i),this.$refs.basePage.checkAll=!1,this.$refs.basePage.search()},cascadehandler:function(a){var t=this,e=[];return a.forEach((function(a){var i={checkable:a.check,id:a.matCatSyspath,code:a.matCatSyscode,name:a.matCatName};i.children=t.cascadehandler(a.children),e.push(i)})),e},aftercheck:function(a,t,e){!0===this.$refs.basePage.checkAll?this.footerText[0].value=this.$refs.basePage.total:this.footerText[0].value=this.$refs.basePage.getselected().length},beforequery:function(a,t){"0"===t.value.matPublicStatus?this.buttons=[{key:"release",name:this.$t("rawMaterialArrival.release")}]:this.buttons=[]},afterquery:function(a){var t=this;1===a.current&&(this.barCodes=new Set),this.barCodes.forEach((function(t){var e=a.records.findIndex((function(a){return a.matBarcode===t}));e>0&&a.records.splice(e,1)})),this.boindnum=a.extRecords[0]["1"],this.unboindnum=a.extRecords[0]["0"],this.$nextTick((function(){t.aftercheck()}))},releaseAll:function(){var a=this,t=this.$refs.basePage.getsearchJson(),e=this;r["a"].loading({forbidClick:!0,duration:0}),this.$ajax("/wms/wmsmat/checkbarcode","",t,(function(i){var s=i.data.data;s-0>0?a.$ajax("/wms/wmsmat/noautopageidlist","",t,(function(a){var t=a.data.data;r["a"].clear(),n["a"].confirm({title:"提示",message:"数据中存在未绑定条码的物资，是否确认发布？"}).then((function(){r["a"].loading({forbidClick:!0,duration:0});var a=[];t.forEach((function(t){var i=new Promise((function(a,i){e.$ajax("/wms/wmsmat/matpublic","",[{id:t}],(function(t){a(!0)}))}));a.push(i)})),Promise.all(a).then((function(a){r["a"].success(e.$t("rawMaterialArrival.releasetoast")),e.$refs.basePage.search()}))})).catch((function(){}))})):a.$ajax("/wms/wmsmat/noautopageidlist","",t,(function(a){var t=a.data.data;r["a"].loading({forbidClick:!0,duration:0});var i=[];t.forEach((function(a){var t=new Promise((function(t,i){e.$ajax("/wms/wmsmat/matpublic","",[{id:a}],(function(a){t(!0)}))}));i.push(t)})),Promise.all(i).then((function(a){r["a"].success(e.$t("rawMaterialArrival.releasetoast")),e.$refs.basePage.search()}))}))}))},buttonsClick:function(a){var t=this;if("release"===a){var e=this.$refs.basePage.ischeckall(),i=this;if(0===this.footerText[0].value)return!1;n["a"].confirm({width:"90%",message:i.$t("rawMaterialArrival.cofirm1")+this.footerText[0].value+i.$t("rawMaterialArrival.cofirm2")}).then((function(){if(e)i.releaseAll();else{var a=i.$refs.basePage.getselected();if(0===a.length)return;r["a"].loading({forbidClick:!0,duration:0});var s=[];a.forEach((function(a){var t={id:a.id};s.push(t)}));var c=a.map((function(a){return a.id}));i.$ajax("/wms/wmsmat/checkbarcodebyids","",c,(function(a){var e=a.data.data;e-0>0?(r["a"].clear(),n["a"].confirm({title:"提示",message:"数据中存在未绑定条码的物资，是否确认发布？"}).then((function(){r["a"].loading({forbidClick:!0,duration:0}),i.$ajax("/wms/wmsmat/matpublic","",s,(function(a){r["a"].success(t.$t("rawMaterialArrival.releasetoast")),i.$refs.basePage.search()}))})).catch((function(){}))):i.$ajax("/wms/wmsmat/matpublic","",s,(function(a){r["a"].success(t.$t("rawMaterialArrival.releasetoast")),i.$refs.basePage.search()}))}))}})).catch((function(){}))}},initselect:function(){var a=this;this.$ajax("/wms/wmsmatcat/matlisttree","",{matInvStatus:"0",matPublicStatus:"0"},(function(t){a.cascadeItems.matCatSyspath=a.cascadehandler(t.data.data)})),this.$ajax("/wms/wmsmat/getdistinctparams","",{type:"matCarshipno",matInvStatus:"0",matPublicStatus:"0"},(function(t){var e=t.data.data,i=[];e.forEach((function(a){var t={id:a,name:a};i.push(t)})),a.selectItems.matCarshipno=i})),this.$ajax("/wms/wmsmat/getdistinctparams","",{type:"matProjno",matInvStatus:"0",matPublicStatus:"0"},(function(t){var e=t.data.data,i=[];e.forEach((function(a){var t={id:a,name:a};i.push(t)})),a.selectItems.matProjNo=i})),this.$ajax("/wms/wmstrb/list","",{trbPublicStatus:"0"},(function(t){var e=t.data.data,i=[];e.forEach((function(a){var t={id:a.trbNo,name:a.trbNo};i.push(t)})),a.selectItems.trbNo=i})),this.selectItems.matSheetType=c["a"].getDict("SHEET_TYPE"),this.selectItems.matStorageStatus=c["a"].getDict("STORAGE_STATUS"),this.selectItems.matInvStatus=c["a"].getDict("MAT_STATUS"),this.selectItems.matPublicStatus=c["a"].getDict("TRB_PUBLIC_STATUS")}},activated:function(){},created:function(){this.initselect();var a=localStorage.getItem("equipmentType");a&&"XUESI2"==a?sc.initUTScan(this.scanning):sc.initScan(this.scanning)},destroyed:function(){var a=localStorage.getItem("equipmentType");a&&"XUESI2"==a?sc.initUTScan(void 0):sc.initScan(void 0)}},d=o,u=e("2877"),l=Object(u["a"])(d,i,s,!1,null,"647cf1a6",null);t["default"]=l.exports}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d7a63e10"],{"14f1":function(t,e,a){},"333d":function(t,e,a){},"78f9":function(t,e,a){"use strict";var s=a("333d"),o=a.n(s);o.a},"9bd4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("basePage",{ref:"basePage",attrs:{numberCol:t.numberCol,footerText:t.footerText,btnMethod:t.btnMethod,selectItems:t.selectItems,cascadeItems:t.cascadeItems,title:"余料出库",cardbuttons:t.cardbuttons,addcon:t.addcon,buttons:t.buttons,fixedQueryConditions:t.fixedQueryConditions,contitle:t.$t("rawMaterialsOutOfWarehouse.contitle"),showDetailTitle:"查看出库单"},on:{buttonsClick:t.buttonsClick,afterquery:t.afterquery,aftercheckall:t.aftercheck,aftercheck:t.aftercheck,cardbtnclick:t.cardbtnclick},scopedSlots:t._u([{key:"over",fn:function(){return[a("van-row",{staticStyle:{"text-align":"center","vertical-align":"middle","align-items":"center","justify-content":"center",display:"flex"}},[a("van-col",{attrs:{span:"24"}},[a("span",{staticClass:"smallfont",staticStyle:{float:"right","margin-right":"10px"}},[t._v("\n            "+t._s(t.$t("rawMaterialStorage.total")+":"+t.total)+"\n          ")])])],1)]},proxy:!0}])}),a("baseDetail",{attrs:{show:t.showRemOutDetail,baseUrl:t.baseUrl,mdid:"storage_7002",data:t.detaildata,detailtitle:"余料详情",selectItems:t.selectItems,numberCol:t.localNumberCol},on:{close:t.closeDetail}}),a("van-popup",{style:{width:"100%",height:"100%",backgroundColor:"#F7F7F7"},attrs:{position:"right"},model:{value:t.showTransfer,callback:function(e){t.showTransfer=e},expression:"showTransfer"}},[t.showTransfer?a("remTransfer",{attrs:{numberCol:t.numberCol1,fixedQueryConditions:t.fixedQueryConditionsDetail,pathName:t.currentPathName,storeId:t.storeId,currentMatId:t.currentMatId,options:t.options,selectItems:t.selectItems},on:{closeStockDetail:t.closeStockDetail}}):t._e()],1),a("stackSelect",{ref:"outOfStock",attrs:{api:"/wms/wmsOutboundUse/getrootstack",show:t.showOutOfStock,storeType:5},on:{closeSelect:t.closeSelect,sure:t.sureOutOfStock}})],1)},o=[],i=(a("5df3"),a("7514"),a("ac6a"),a("386d"),a("02df")),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[a("basePage",{ref:"basePage",attrs:{rightIcon:"",detailtitle:"余料出库移库",numberCol:t.numberCol,title:t.$t("oriStock.stockDetail"),btnMethod:t.btnMethod,fixedQueryConditions:t.fixedQueryConditions,footerText:t.footerText,buttons:t.buttons,selectItems:t.selectItems,moduleid:"storage_0012",pcmoduleid:"storage_7002"},on:{onClickLeft:t.onClickLeft,afterquery:t.afterquery,aftercheck:t.aftercheck,aftercheckall:t.aftercheckall,buttonsClick:t.buttonsClick,beforequery:t.beforequery},scopedSlots:t._u([{key:"over",fn:function(){return[a("div",{staticClass:"title-stack"},[a("div",{staticClass:"title-stack-name"},[t._v(t._s(t.$t("remStock.stackTitle"))+t._s(t.pathName)+">")]),a("div",{staticClass:"title-stack-count"},[a("span",[t._v(t._s(t.$t("remStock.matNum")))]),a("span",[t._v("1/"+t._s(t.total))])])])]},proxy:!0}])}),a("stackSelect",{ref:"stockSelect",attrs:{show:t.showStackSelect,options:t.options,defStoreId:t.storeId},on:{closeSelect:t.closeSelect,sure:t.sure,aftersearch:t.aftersearch}})],1)},c=[],n=(a("456d"),a("7f7f"),a("55dd"),{name:"remTransfer",components:{},props:{storeId:{type:String},numberCol:{type:Object},footerText:{type:Array,default:function(){return[{key:"num",display:this.$t("remStock.matNumName"),value:0},{key:"weight",display:this.$t("remStock.matWeightName"),value:"0KG"}]}},fixedQueryConditions:{type:Array,default:function(){return[]}},pathName:{type:String,default:function(){return""}},currentMatId:{type:String,default:function(){return""}},options:{type:Array,default:function(){return[]}},selectItems:{type:Object,default:function(){return{}}}},data:function(){return{btnMethod:{querymethod:"/wms/wmsmat/getFitRemMatInStack"},total:0,buttons:[{key:"transfer",name:" 移库"}],showAllData:!1,showStackSelect:!1,storeName:""}},computed:{},watch:{},methods:{beforequery:function(t,e){e.value.matFit=0},aftersearch:function(t){var e=t.records,a=this.fixedQueryConditions.find((function(t){return"matStackId"===t["key"]&&t["value"]})).value;e.forEach((function(t){t.wmsStackList.forEach((function(t){t.id===a&&(t.color="rgb(192, 179, 209)",t.isCurrentItem=!0)}))}))},buttonsClick:function(t){if("transfer"===t){var e=this.$refs.basePage.ischeckall();if(e)this.showStackSelect=!0;else{var a=this.$refs.basePage.getselected();if(a&&a.length>0)if(a=a.sort((function(t,e){return e.matSerialno-t.matSerialno})),a[0].matSerialno<this.$refs.basePage.total)this.$toast.fail(this.$t("remStock.notFromTop"));else{for(var s=!1,o=0;o<a.length;o++)if(o<a.length-1&&a[o].matSerialno-a[o+1].matSerialno!==1){s=!0;break}s?this.$toast.fail(this.$t("remStock.discontinuous")):this.showStackSelect=!0}else this.$toast.fail(this.$t("base.noselect"))}}},sure:function(t){var e=this.$refs.basePage.getselected();e&&e.length>0?this.collapse(t):this.$toast.fail(this.$t("base.noselect")),this.showStackSelect=!1},collapse:function(t){var e=this,a=this,s=this.$refs.basePage.getselected();this.$toast.loading({forbidClick:!0,duration:0});var o=[];if(this.$refs.basePage.checkAll){var i=s[0].matStoreId,r=s[0].stackId,c=this.$asyncajax("/wms/wmsmat/getallidsinstack","",{id:r}).data;o=c.map((function(e){return{ovdId:e.ovdId,crMatid:e.matId,crFromStoreid:i,crFromStackid:r,crFromSerialno:e.serialno,crToStoreid:t.storeId,crToStackid:t.stackId}}))}else s.forEach((function(e){var a={ovdId:e.matOvdId,crMatid:e.id,crFromStoreid:e.matStoreId,crFromStackid:e.stackId,crFromSerialno:e.matSerialno,crToStoreid:t.storeId,crToStackid:t.stackId};o.push(a)}));this.$ajax("/wms/wmsmat/transwarehouse","",o,(function(t){e.$toast.success(a.$t("remStock.transferSuccess")),a.$refs.basePage.search(),a.$refs.basePage.checkAll=!1,e.aftercheckall()}))},closeSelect:function(t){t&&(t.flag=!1),this.showStackSelect=!1},onClickLeft:function(t){this.$emit("closeStockDetail",t)},afterquery:function(t){var e=this;this.total=t.total;var a=t.records;a.forEach((function(t){t.id===e.currentMatId&&(t.color="rgb(208, 198, 221)"),t.stackId=t.matStackId,t.matStackId=e.selectItems.matStackId.find((function(e){return e.id===t.matStackId})).name;var a=i["a"].numberFormat(4,t.matLength?t.matLength:0),s=i["a"].numberFormat(4,t.matWidth?t.matWidth:0);t["lengthAndWidth"]=a+"*"+s}))},aftercheck:function(){var t=this.$refs.basePage.getselected();this.footerText[0].value=t.length;var e=0;Object.keys(t).forEach((function(a){e+=parseFloat(t[a].matAuxQuantity)})),this.footerText[1].value=i["a"].numberFormat(4,e)+this.$t("remStock.KG")},aftercheckall:function(){!0===this.$refs.basePage.checkAll&&this.$refs.basePage.extRecords?(this.footerText[0].value=this.$refs.basePage.total,this.footerText[1].value=i["a"].numberFormat(4,this.$refs.basePage.extRecords.matSumWeight)+this.$t("remStock.KG")):(this.footerText[0].value=0,this.footerText[1].value=0+this.$t("remStock.KG"))}},created:function(){},mounted:function(){this.total=this.$refs.basePage.total}}),u=n,l=(a("a04e"),a("2877")),d=Object(l["a"])(u,r,c,!1,null,"30a451a6",null),h=d.exports,m=a("2241"),f={name:"remOutOfStock",components:{remTransfer:h},data:function(){return{storeId:"",showOutOfStock:!1,currentMatId:"",fixedQueryConditionsDetail:[],currentPathName:"",numberCol1:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},showTransfer:!1,baseUrl:"",localNumberCol:{0:["matPrice"],2:["matThickness"],3:["matBasicQuantity","matAuxQuantity"]},detaildata:{},showRemOutDetail:!1,numberCol:{0:["matPrice"],2:["ovdThickness"],3:["odbMatQty"]},data:{},ovdId:"",options:[],total:0,footerText:[{key:"num",display:this.$t("rawMaterialsOutOfWarehouse.num"),value:0}],btnMethod:{querymethod:"/wms/wmsoutboundorderdetail/remautopage"},selectItems:{},cascadeItems:{},cardbuttons:[{key:"showRemDetail",name:"查看余料详情"}],buttons:[{key:"transfer",name:" 移库"},{key:"outStore",name:"出库"}],addcon:[],fixedQueryConditions:[{key:"odbMatSheettype",exp:"=",value:1}]}},methods:{closeStockDetail:function(t){this.showTransfer=!1,t.flag=!1,this.$refs.basePage.search()},closeDetail:function(){this.showRemOutDetail=!1},cascadehandler:function(t){var e=this,a=[];return t.forEach((function(t){var s={checkable:t.check,id:t.matCatSyspath,code:t.matCatSyscode,name:t.matCatName};s.children=e.cascadehandler(t.children),a.push(s)})),a},aftercheck:function(){!0===this.$refs.basePage.checkAll?this.footerText[0].value=this.$refs.basePage.total:this.footerText[0].value=this.$refs.basePage.getselected().length},afterquery:function(t){var e=this;this.total=t.total;var a=t.records;a.forEach((function(t){var a=i["a"].numberFormat(4,t.ovdLength?t.ovdLength:0),s=i["a"].numberFormat(4,t.ovdWidth?t.ovdWidth:0);t["lengthAndWidth"]=a+"*"+s;var o=t.matStoreId,r=e.options.find((function(t){return t.value===o}));if(r){var c=r.text;t["matStackPathname"]=c+"-"+t["matStackPathname"]}})),this.$nextTick((function(){e.aftercheck()}))},buttonsClick:function(t){var e=this,a=this.$refs.basePage.getselected();if("transfer"===t){if(0===a.length)return void this.$toast.fail(this.$t("base.noselect"));if(a.length>1)return void this.$toast.fail("请单选后，再点移库");this.fixedQueryConditionsDetail=[];var s=a[0];this.showTransfer=!0;var o={key:"matStackId",exp:"=",value:s.matStackId};this.fixedQueryConditionsDetail.push(o),this.currentPathName=s.matStackPathname,this.currentMatId=s.obuMatId,this.storeId=s.matStoreId}else if("outStore"===t)if(!0===this.$refs.basePage.checkAll)this.$ajax("/wms/wmsoutboundorderdetail/remOutStockCheckWithQuery","",this.$refs.basePage.getsearchJson(),(function(t){var a=t.data.data;!0!==a?m["a"].confirm({title:"提示",message:"所选的余料存在不是最顶层，确认无需移库直接出库？"}).then((function(){e.showOutOfStock=!0})).catch((function(){})):e.showOutOfStock=!0}));else{if(0===a.length)return void this.$toast.fail(this.$t("base.noselect"));var i=[];a.forEach((function(t){var e={};e["matStackId"]=t.matStackId,e["matSerialno"]=t.matSerialno,i.push(e)})),this.$ajax("/wms/wmsoutboundorderdetail/remOutStockCheck","",i,(function(t){var a=t.data.data;!0!==a?m["a"].confirm({title:"提示",message:"所选的余料存在不是最顶层，确认无需移库直接出库？"}).then((function(){e.showOutOfStock=!0})).catch((function(){})):e.showOutOfStock=!0}))}},closeSelect:function(t){t&&(t.flag=!1),this.showOutOfStock=!1,this.$refs.basePage.search()},sureOutOfStock:function(t){if(t.stackId===this.stackid)return this.$toast.fail(this.$t("base.noselect")),!1;this.$toast.loading({forbidClick:!0,duration:0});var e=this.$refs.basePage.getselected(),a=this,s=[];e.forEach((function(e){var o=new Promise((function(s,o){var i={obuObdId:e.id,obuOboCode:e.obdOboCode,obuMatId:e.obuMatId,obuPlatform:"PAD",obuMatQty:1,obuStatu:"2",obuToStoreid:t.storeId,obuToStockid:t.stackId,obuOutStockid:e.matStackId,obuDeviceid:""};a.$ajax("/wms/wmsOutboundUse/insertOutStore","",i,(function(t){s(!0)}))}));s.push(o)})),Promise.all(s).then((function(t){a.$toast.success(a.$t("outboundRecommendation.osuccess")),a.$refs.basePage.search(),a.showOutOfStock=!1}))},cardbtnclick:function(t,e){var a=this;"showRemDetail"===t&&this.$ajax("/wms/wmsmat/queryRemMat","",{matOvdId:e.odbMatOvdid},(function(t){var e=t.data.data,s=i["a"].numberFormat(4,e.matLength?e.matLength:0),o=i["a"].numberFormat(4,e.matWidth?e.matWidth:0);e["lengthAndWidth"]=s+"*"+o,a.detaildata=e,a.showRemOutDetail=!0}))},initselect:function(){var t=this;this.$ajax("/wms/wmsstore/list","",{storeType:8},(function(e){var a=[],s=[];e.data.data.forEach((function(t){var e={text:t.storeName,value:t.id},o={id:t.id,name:t.storeName};a.push(e),s.push(o)})),t.options=a,t.selectItems.obuOutStoreid=s})),this.$ajax("/wms/wmsstack/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={name:t.stackName,id:t.id};a.push(e)})),t.selectItems.obuOutStockid=a})),this.$ajax("/auth/dep/listdep","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.depName};a.push(e)})),t.selectItems.oboDepId=a})),this.$ajax("/wms/wmsstack/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.stackName};a.push(e)})),t.selectItems.matStackId=a})),this.$ajax("/common/comteam/list","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.teamName};a.push(e)})),t.selectItems.oboTeamId=a})),this.selectItems.oboBusscode=i["a"].getDict("ODB_BUSS_CODE"),this.selectItems.odbMatSheettype=i["a"].getDict("SHEET_TYPE"),this.selectItems.obuStatu=i["a"].getDict("OBU_STATU"),this.selectItems.obuPlatform=i["a"].getDict("OBU_PLATFORM"),this.selectItems.wmsPicStatus=[{id:"0",name:"未检查",icon:"ios-image",color:"#666"},{id:"1",name:"有图"},{id:"2",name:"缺图"}],this.selectItems.wmsDataSource=[{id:"0",name:"套料提取"},{id:"1",name:"Excel导入"},{id:"2",name:"新增"},{id:"3",name:"盘盈"}],this.selectItems.matInvStatus=i["a"].getDict("MAT_STATUS"),this.selectItems.matSheetType=i["a"].getDict("SHEET_TYPE"),this.selectItems.matStorageStatus=i["a"].getDict("STORAGE_STATUS"),this.$ajax("/wms/wmsstore/list","",{storeType:"8"},(function(e){var a=[],s=e.data.data;s.forEach((function(t){a.push({id:t.id,name:t.storeName})})),t.selectItems.matStoreId=a,t.selectItems.obuToStoreid=a})),this.$ajax("/wms/wmsstore/ylstacklist","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={name:t.stackName,id:t.id};a.push(e)})),t.selectItems.matStackId=a,t.selectItems.obuToStockid=a})),this.$ajax("/auth/user/listuser","",{},(function(e){var a=[];e.data.data.forEach((function(t){var e={id:t.id,name:t.userRealname};a.push(e)})),t.selectItems.matInstoreUserid=a}))}},activated:function(){},created:function(){this.initselect();var t=localStorage.getItem("serviceCfg");if(t){var e=JSON.parse(t),a=e.facObj;e.cloudObj;!0===a.isDefault&&(this.baseUrl="http://"+a.ip+":"+a.port)}}},k=f,b=(a("78f9"),Object(l["a"])(k,s,o,!1,null,"0359a41e",null));e["default"]=b.exports},a04e:function(t,e,a){"use strict";var s=a("14f1"),o=a.n(s);o.a}}]);